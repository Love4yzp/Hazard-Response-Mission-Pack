[
  {
    "id": "0659cda55a05f740",
    "type": "tab",
    "label": "Hazard Response Command Center",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "83ddd822c5c4b267",
    "type": "tab",
    "label": "AI Camera",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "f11a6acbc82d2c5c",
    "type": "subflow",
    "name": "7in1 weather station",
    "info": "",
    "category": "※sensecap-weather-station",
    "in": [],
    "out": [
      {
        "x": 1220,
        "y": 200,
        "wires": [
          {
            "id": "9c84a20fd70247b6",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "Title - Select data to output",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "Select data to output:",
            "en-US": "Select data to output:"
          },
          "type": "none"
        }
      },
      {
        "name": "temperature",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Temperature",
            "en-US": "Temperature"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "humidity",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Humidity",
            "en-US": "Humidity"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "windSpeed",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Wind Speed",
            "en-US": "Wind Speed"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "precipitation",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Precipitation",
            "en-US": "Precipitation"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "vegetationDensity",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Vegetation Density",
            "en-US": "Vegetation Density"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "fuelMoisture",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Fuel Moisture",
            "en-US": "Fuel Moisture"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "soilMoisture",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Soil Moisture",
            "en-US": "Soil Moisture"
          },
          "type": "checkbox"
        }
      },
      {
        "name": "fireRisk",
        "type": "bool",
        "value": "true",
        "ui": {
          "label": {
            "zh-CN": "Fire Risk",
            "en-US": "Fire Risk"
          },
          "type": "checkbox"
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "status": {
      "x": 1220,
      "y": 360,
      "wires": []
    }
  },
  {
    "id": "c64ffede4f1f69bd",
    "type": "subflow",
    "name": "Digital Twin Background",
    "info": "",
    "category": "※digital-twins",
    "in": [],
    "out": [],
    "env": [
      {
        "name": "↓ Dashboard UI",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "Group",
        "type": "ui-group",
        "value": "",
        "ui": {
          "type": "conf-types"
        }
      },
      {
        "name": "Width",
        "type": "num",
        "value": "1"
      },
      {
        "name": "Height",
        "type": "num",
        "value": "1"
      },
      {
        "name": "↓ Background Image",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "imageSelector",
        "type": "str",
        "value": "url",
        "ui": {
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Web image links",
                  "en-US": "Web image links"
                },
                "v": "url"
              },
              {
                "l": {
                  "zh-CN": "Local image filename",
                  "en-US": "Local image filename"
                },
                "v": "file"
              }
            ]
          }
        }
      },
      {
        "name": "imagePath",
        "type": "str",
        "value": "http://192.168.100.10:8092/default_background.jpg",
        "ui": {
          "label": {
            "zh-CN": "url or filename",
            "en-US": "url or filename"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed"
    },
    "color": "#9FE6EC",
    "icon": "font-awesome/fa-building-o",
    "status": {
      "x": 1060,
      "y": 440,
      "wires": []
    }
  },
  {
    "id": "c25ee8e3cadf74f6",
    "type": "subflow",
    "name": "Digital Twin Data Card",
    "info": "",
    "category": "※digital-twins",
    "in": [
      {
        "x": 220,
        "y": 620,
        "wires": [
          {
            "id": "81111372d49074cf"
          },
          {
            "id": "270964d67cd7e5ca"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "↓ Dashboard UI",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "Group",
        "type": "ui-group",
        "value": "",
        "ui": {
          "type": "conf-types"
        }
      },
      {
        "name": "↓ Card",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "card_name",
        "type": "str",
        "value": "Ultrasonic",
        "ui": {
          "icon": "font-awesome/fa-vcard-o",
          "label": {
            "zh-CN": "Name",
            "en-US": "Name"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "card_font_size",
        "type": "num",
        "value": "14",
        "ui": {
          "icon": "font-awesome/fa-sort-numeric-asc",
          "label": {
            "zh-CN": "Font size",
            "en-US": "Font size"
          },
          "type": "input",
          "opts": {
            "types": [
              "num"
            ]
          }
        }
      },
      {
        "name": "card_unit",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "Value Unit",
            "en-US": "Value Unit"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "↓ Position",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "card_position_y",
        "type": "str",
        "value": "0%",
        "ui": {
          "icon": "font-awesome/fa-percent",
          "label": {
            "zh-CN": "Top Position(%)",
            "en-US": "Top Position(%)"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "card_position_x",
        "type": "str",
        "value": "0%",
        "ui": {
          "icon": "font-awesome/fa-percent",
          "label": {
            "zh-CN": "Left Position(%)",
            "en-US": "Left Position(%)"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#9FE6EC",
    "icon": "font-awesome/fa-building-o",
    "status": {
      "x": 740,
      "y": 680,
      "wires": [
        {
          "id": "270964d67cd7e5ca",
          "port": 0
        },
        {
          "id": "ed8749cbb76eaff3",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "1766c4cb75850c2c",
    "type": "subflow",
    "name": "Grove Vision AI V2 - Get Camera",
    "info": "",
    "category": "※camera-grove-vision-ai-v2",
    "in": [
      {
        "x": 40,
        "y": 360,
        "wires": [
          {
            "id": "17bdb18a27c66e11"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1680,
        "y": 740,
        "wires": [
          {
            "id": "7712b011fe04d5e2",
            "port": 0
          }
        ]
      },
      {
        "x": 1680,
        "y": 840,
        "wires": [
          {
            "id": "a3d2cf36d30ad3a8",
            "port": 0
          }
        ]
      },
      {
        "x": 1810,
        "y": 1000,
        "wires": [
          {
            "id": "2a5b878f4609d83d",
            "port": 0
          }
        ]
      },
      {
        "x": 1930,
        "y": 1240,
        "wires": [
          {
            "id": "e4db2d42d0a9aab5",
            "port": 0
          },
          {
            "id": "3d8473d039795dd6",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "----- Camera Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "cameraId",
        "type": "str",
        "value": "",
        "ui": {
          "icon": "font-awesome/fa-camera",
          "label": {
            "zh-CN": "Camera ID",
            "en-US": "Camera ID"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "!note_camera",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "",
            "en-US": "....Note: You can also leave it blank and configure it dynamically through input"
          },
          "type": "none"
        }
      },
      {
        "name": "----- Output 4: Trigger -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "triggerMode",
        "type": "str",
        "value": "yes",
        "ui": {
          "label": {
            "zh-CN": "When ...",
            "en-US": "When ..."
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Detected",
                  "en-US": "Detected"
                },
                "v": "yes"
              },
              {
                "l": {
                  "zh-CN": "Not detected",
                  "en-US": "Not detected"
                },
                "v": "no"
              }
            ]
          }
        }
      }
    ],
    "meta": {
      "module": "Grove Vision AI V2 - Get Camera",
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B8EA4F",
    "outputLabels": [
      "Original Image",
      "Inference Result",
      "Iriginal Data (only can connect to 'tracking analyze' node)",
      "Detection Trigger"
    ],
    "status": {
      "x": 1660,
      "y": 1060,
      "wires": [
        {
          "id": "cc53c77934293557",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "cca203ebc25b2ce6",
    "type": "subflow",
    "name": "IP Camera rtsp",
    "info": "",
    "category": "※camera-general",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "f8c167e299ad5d74"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 420,
        "y": 80,
        "wires": [
          {
            "id": "f8c167e299ad5d74",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "url",
        "type": "str",
        "value": "rtsp://",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "username",
        "type": "str",
        "value": "",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "passowrd",
        "type": "str",
        "value": "",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "frameRate",
        "type": "num",
        "value": "",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "num"
            ]
          }
        }
      },
      {
        "name": "quality",
        "type": "str",
        "value": "",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num"
            ]
          }
        }
      },
      {
        "name": "resolution",
        "type": "str",
        "value": "<width>x<height>",
        "ui": {
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "icon": "font-awesome/fa-camera",
    "status": {
      "x": 420,
      "y": 160,
      "wires": [
        {
          "id": "96a1b615dbe08457",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "fdfd26c77e5e2a42",
    "type": "subflow",
    "name": "SenseCAP Data Logger - Tripwire",
    "info": "",
    "category": "※data-logger-tripwire",
    "in": [],
    "out": [
      {
        "x": 2040,
        "y": 60,
        "wires": [
          {
            "id": "fbb4b0a21824b98f",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Connection ---",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "mqttBroker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "applicationId",
        "type": "str",
        "value": "447ecfe1-6d26-4e82-bf28-d6dba2fb0d36",
        "ui": {
          "icon": "font-awesome/fa-align-justify",
          "label": {
            "zh-CN": "*AppId",
            "en-US": "*AppId"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "deviceId",
        "type": "str",
        "value": "2cf7f1c0434000e3",
        "ui": {
          "icon": "font-awesome/fa-align-justify",
          "label": {
            "zh-CN": "*EUI",
            "en-US": "*EUI"
          },
          "type": "input",
          "opts": {
            "types": [
              "str"
            ]
          }
        }
      },
      {
        "name": "----- Output Filter ---",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "whenFalseOutput",
        "type": "str",
        "value": "0",
        "ui": {
          "label": {
            "zh-CN": "if is 0, output:",
            "en-US": "if is 0, output:"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool"
            ]
          }
        }
      },
      {
        "name": "whenTrueOutput",
        "type": "str",
        "value": "1",
        "ui": {
          "label": {
            "zh-CN": "if is 1, output:",
            "en-US": "if is 1, output:"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "icon": "node-red/node_icon_s2100.png",
    "status": {
      "x": 2040,
      "y": 180,
      "wires": [
        {
          "id": "d6f6d0ab45a73962",
          "port": 0
        },
        {
          "id": "statusNode",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "e0d523198c47fac8",
    "type": "subflow",
    "name": "SenseCAP Data Logger - Ultrasonic",
    "info": "",
    "category": "※data-logger-ultrasonic",
    "in": [],
    "out": [
      {
        "x": 1660,
        "y": 80,
        "wires": [
          {
            "id": "4a6bb66a194ebecb",
            "port": 0
          },
          {
            "id": "e759cd06d6462147",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Connection -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "mqttBroker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "applicationId",
        "type": "str",
        "value": "447ecfe1-6d26-4e82-bf28-d6dba2fb0d36",
        "ui": {
          "icon": "font-awesome/fa-align-justify",
          "label": {
            "zh-CN": "*AppId",
            "en-US": "*AppId"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      },
      {
        "name": "deviceId",
        "type": "str",
        "value": "2cf7f1c0446001bf",
        "ui": {
          "icon": "font-awesome/fa-align-justify",
          "label": {
            "zh-CN": "*EUI",
            "en-US": "*EUI"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "icon": "node-red/node_icon_s2100.png",
    "status": {
      "x": 1660,
      "y": 180,
      "wires": [
        {
          "id": "bf8cf61d9a1c87e9",
          "port": 0
        },
        {
          "id": "b4cae0a3a27b6aa9",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "864d0ea09f268ade",
    "type": "subflow",
    "name": "clear geofence",
    "info": "",
    "category": "※geofence",
    "in": [
      {
        "x": 60,
        "y": 60,
        "wires": [
          {
            "id": "6118cd66d545feee"
          }
        ]
      }
    ],
    "out": [],
    "env": [],
    "meta": {},
    "color": "#B0CBFF",
    "status": {
      "x": 320,
      "y": 160,
      "wires": [
        {
          "id": "b4fa1b291be93bd0",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "3222c245ca4d6f5a",
    "type": "subflow",
    "name": "condition item",
    "info": "",
    "category": "※conditions",
    "in": [
      {
        "x": 480,
        "y": 200,
        "wires": [
          {
            "id": "cdf78b2f3d8e9912"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1120,
        "y": 160,
        "wires": [
          {
            "id": "9abdef358b9063d3",
            "port": 0
          },
          {
            "id": "6feedcb6904fe0b7",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "Title",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "The following conditions are also satisfied:",
            "en-US": "The following conditions are also satisfied:"
          },
          "type": "none"
        }
      },
      {
        "name": "--1:",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "condition1",
        "type": "str",
        "value": "any",
        "ui": {
          "label": {
            "zh-CN": "condition",
            "en-US": "condition"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "any",
                  "en-US": "any"
                },
                "v": "any"
              },
              {
                "l": {
                  "zh-CN": "equal to",
                  "en-US": "equal to"
                },
                "v": "=="
              },
              {
                "l": {
                  "zh-CN": "not equal to",
                  "en-US": "not equal to"
                },
                "v": "!="
              },
              {
                "l": {
                  "zh-CN": "greater than",
                  "en-US": "greater than"
                },
                "v": ">"
              },
              {
                "l": {
                  "zh-CN": "greater than or equal",
                  "en-US": "greater than or equal"
                },
                "v": ">="
              },
              {
                "l": {
                  "zh-CN": "less than",
                  "en-US": "less than"
                },
                "v": "<"
              },
              {
                "l": {
                  "zh-CN": "less than or equal",
                  "en-US": "less than or equal"
                },
                "v": "<="
              }
            ]
          }
        }
      },
      {
        "name": "value1",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "value",
            "en-US": "value"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env",
              "conf-types"
            ]
          }
        }
      },
      {
        "name": "--2:",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "condition2",
        "type": "str",
        "value": "any",
        "ui": {
          "label": {
            "zh-CN": "condition",
            "en-US": "condition"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "any",
                  "en-US": "any"
                },
                "v": "any"
              },
              {
                "l": {
                  "zh-CN": "equal to",
                  "en-US": "equal to"
                },
                "v": "=="
              },
              {
                "l": {
                  "zh-CN": "not equal to",
                  "en-US": "not equal to"
                },
                "v": "!="
              },
              {
                "l": {
                  "zh-CN": "greater than",
                  "en-US": "greater than"
                },
                "v": ">"
              },
              {
                "l": {
                  "zh-CN": "greater than or equal",
                  "en-US": "greater than or equal"
                },
                "v": ">="
              },
              {
                "l": {
                  "zh-CN": "less than",
                  "en-US": "less than"
                },
                "v": "<"
              },
              {
                "l": {
                  "zh-CN": "less than or equal",
                  "en-US": "less than or equal"
                },
                "v": "<="
              }
            ]
          }
        }
      },
      {
        "name": "value2",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "value",
            "en-US": "value"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env",
              "conf-types"
            ]
          }
        }
      },
      {
        "name": "--3:",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "condition3",
        "type": "str",
        "value": "any",
        "ui": {
          "label": {
            "zh-CN": "condition",
            "en-US": "condition"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "any",
                  "en-US": "any"
                },
                "v": "any"
              },
              {
                "l": {
                  "zh-CN": "equal to",
                  "en-US": "equal to"
                },
                "v": "=="
              },
              {
                "l": {
                  "zh-CN": "not equal to",
                  "en-US": "not equal to"
                },
                "v": "!="
              },
              {
                "l": {
                  "zh-CN": "greater than",
                  "en-US": "greater than"
                },
                "v": ">"
              },
              {
                "l": {
                  "zh-CN": "greater than or equal",
                  "en-US": "greater than or equal"
                },
                "v": ">="
              },
              {
                "l": {
                  "zh-CN": "less than",
                  "en-US": "less than"
                },
                "v": "<"
              },
              {
                "l": {
                  "zh-CN": "less than or equal",
                  "en-US": "less than or equal"
                },
                "v": "<="
              }
            ]
          }
        }
      },
      {
        "name": "value3",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "value",
            "en-US": "value"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "num",
              "bool",
              "json",
              "bin",
              "env",
              "conf-types"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#98942B",
    "status": {
      "x": 1120,
      "y": 280,
      "wires": []
    }
  },
  {
    "id": "aa193c820dc14bcf",
    "type": "subflow",
    "name": "condition judgment",
    "info": "",
    "category": "※conditions",
    "in": [
      {
        "x": 100,
        "y": 160,
        "wires": [
          {
            "id": "a1a49100e860fc7f"
          },
          {
            "id": "58a570950dc50edf"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 650,
        "y": 260,
        "wires": [
          {
            "id": "3452e74a6f467e5e",
            "port": 0
          }
        ]
      },
      {
        "x": 650,
        "y": 340,
        "wires": [
          {
            "id": "3452e74a6f467e5e",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "title-judgmentTriggerMode",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "Judgment Trigger mode:",
            "en-US": "Judgment Trigger mode:"
          },
          "type": "none"
        }
      },
      {
        "name": "judgmentTriggerMode",
        "type": "str",
        "value": "any",
        "ui": {
          "label": {
            "zh-CN": "On",
            "en-US": "On"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "All the items have matched the conditions",
                  "en-US": "All the items have matched the conditions"
                },
                "v": "all"
              },
              {
                "l": {
                  "zh-CN": "Any item has match the condition",
                  "en-US": "Any item has match the condition"
                },
                "v": "any"
              }
            ]
          }
        }
      },
      {
        "name": "output",
        "type": "str",
        "value": "yes",
        "ui": {
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "When yes",
                  "en-US": "When yes"
                },
                "v": "yes"
              },
              {
                "l": {
                  "zh-CN": "When no",
                  "en-US": "When no"
                },
                "v": "no"
              }
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#E2D96E",
    "outputLabels": [
      "true",
      "false"
    ],
    "status": {
      "x": 620,
      "y": 440,
      "wires": [
        {
          "id": "ea3247f6fb34b34b",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "cb0af35beb73a330",
    "type": "subflow",
    "name": "condition no",
    "info": "",
    "category": "※conditions",
    "in": [
      {
        "x": 60,
        "y": 100,
        "wires": [
          {
            "id": "9657bcc00fd4b2a5"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 480,
        "y": 100,
        "wires": [
          {
            "id": "9657bcc00fd4b2a5",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {},
    "color": "#E2D96E",
    "status": {
      "x": 480,
      "y": 180,
      "wires": []
    }
  },
  {
    "id": "71fa94fa94dbdf24",
    "type": "subflow",
    "name": "condition yes",
    "info": "",
    "category": "※conditions",
    "in": [],
    "out": [],
    "env": [],
    "meta": {},
    "color": "#E2D96E"
  },
  {
    "id": "e404a21a200ea798",
    "type": "subflow",
    "name": "face recognization - clear faces",
    "info": "",
    "category": "※vision-computing",
    "in": [
      {
        "x": 40,
        "y": 140,
        "wires": [
          {
            "id": "2271c8e79360da12"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1620,
        "y": 120,
        "wires": [
          {
            "id": "99c9b37632c5c033",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {},
    "color": "#B0CBFF",
    "status": {
      "x": 980,
      "y": 280,
      "wires": [
        {
          "id": "27ac2da36edceb77",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "4090eb5792412927",
    "type": "subflow",
    "name": "face recognization - get faces",
    "info": "",
    "category": "※vision-computing",
    "in": [
      {
        "x": 80,
        "y": 100,
        "wires": [
          {
            "id": "16b0d0cdb64d28b3"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 560,
        "y": 100,
        "wires": [
          {
            "id": "a13cca7fb9aa7d7f",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {},
    "color": "#B0CBFF",
    "status": {
      "x": 560,
      "y": 200,
      "wires": [
        {
          "id": "c3a84f1cf9e4f549",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "c5b584eb17fdf706",
    "type": "subflow",
    "name": "face recognization - recognize face",
    "info": "",
    "category": "※vision-computing",
    "in": [
      {
        "x": 80,
        "y": 160,
        "wires": [
          {
            "id": "16819fbb21a27697"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1240,
        "y": 520,
        "wires": [
          {
            "id": "5b94bf340246e2f4",
            "port": 0
          },
          {
            "id": "44d6327fc2130e2d",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "similarity",
        "type": "num",
        "value": "0.5",
        "ui": {
          "label": {
            "zh-CN": "Similarity",
            "en-US": "Similarity"
          },
          "type": "input",
          "opts": {
            "types": [
              "num"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B0CBFF",
    "status": {
      "x": 1240,
      "y": 580,
      "wires": [
        {
          "id": "3d9fa93c082008e6",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "5bb547dce475f866",
    "type": "subflow",
    "name": "face recognization - register a face",
    "info": "",
    "category": "※vision-computing",
    "in": [
      {
        "x": 80,
        "y": 120,
        "wires": [
          {
            "id": "1bd947ef0136bf4a"
          },
          {
            "id": "fb700ec9c87b1f8b"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 2340,
        "y": 400,
        "wires": [
          {
            "id": "09d5c1594e88a074",
            "port": 0
          },
          {
            "id": "a601c4964f762916",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {},
    "color": "#B0CBFF",
    "status": {
      "x": 2340,
      "y": 540,
      "wires": [
        {
          "id": "0b1a4ae0fb685dac",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "8e71ad1d725a1c4b",
    "type": "subflow",
    "name": "geofence check",
    "info": "",
    "category": "※geofence",
    "in": [
      {
        "x": 60,
        "y": 140,
        "wires": [
          {
            "id": "4c66e73173def117"
          },
          {
            "id": "6043d188a20436b2"
          },
          {
            "id": "08675c9954291a36"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 750,
        "y": 140,
        "wires": [
          {
            "id": "60dcdf32abc3caca",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B0CBFF",
    "inputLabels": [
      "input from meshtastic gps position original data"
    ],
    "outputLabels": [
      "true or false"
    ],
    "icon": "font-awesome/fa-map-marker",
    "status": {
      "x": 800,
      "y": 280,
      "wires": [
        {
          "id": "56ab0313b569ca75",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "38e9748a918c1e10",
    "type": "subflow",
    "name": "geological sensor",
    "info": "",
    "category": "※sensecap-weather-station",
    "in": [],
    "out": [
      {
        "x": 1500,
        "y": 180,
        "wires": [
          {
            "id": "1149f0a0b9fd843e",
            "port": 0
          },
          {
            "id": "64a108e017924245",
            "port": 0
          },
          {
            "id": "5f7a3634e1d812be",
            "port": 0
          },
          {
            "id": "54fbd230597f32cc",
            "port": 0
          },
          {
            "id": "f9708d2c3af3b53f",
            "port": 0
          },
          {
            "id": "0693edfe70c78b67",
            "port": 0
          },
          {
            "id": "5edb4c8f76a82f6a",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "rainfall",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "rockType",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "faultActivity",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "slope",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "terrainChange",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "surfaceWaterFlow",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      },
      {
        "name": "total",
        "type": "bool",
        "value": "true",
        "ui": {
          "type": "checkbox"
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "status": {
      "x": 1500,
      "y": 400,
      "wires": []
    }
  },
  {
    "id": "24744a865787dab5",
    "type": "subflow",
    "name": "image preview ui",
    "info": "",
    "category": "※camera-grove-vision-ai-v2",
    "in": [
      {
        "x": 80,
        "y": 140,
        "wires": [
          {
            "id": "6b8f8035357f4902"
          },
          {
            "id": "25ab445582af8af5"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "Group",
        "type": "ui-group",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "Group",
            "en-US": "Group"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "height",
        "type": "num",
        "value": "48",
        "ui": {
          "label": {
            "zh-CN": "Height",
            "en-US": "Height"
          },
          "type": "spinner",
          "opts": {
            "min": 1,
            "max": 1920
          }
        }
      },
      {
        "name": "mirror",
        "type": "bool",
        "value": "false",
        "ui": {
          "label": {
            "zh-CN": "Image mirror",
            "en-US": "Image mirror"
          }
        }
      }
    ],
    "meta": {},
    "color": "#9FE6EC",
    "icon": "font-awesome/fa-video-camera",
    "status": {
      "x": 560,
      "y": 320,
      "wires": [
        {
          "id": "53efe0a905a0143c",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "ff55010600100001",
    "type": "subflow",
    "name": "meshtastic chat - init route state",
    "info": "",
    "category": "※meshtastic_chat",
    "in": [],
    "out": [
      {
        "x": 740,
        "y": 160,
        "wires": [
          {
            "id": "9e8f4a0ffd0eda44",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B8EA4F",
    "icon": "node-red/node_icon_meshtastic.png",
    "status": {
      "x": 740,
      "y": 240,
      "wires": [
        {
          "id": "5b54f9c21e1e18cf",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "c331a93ea0d418b4",
    "type": "subflow",
    "name": "meshtastic chat - receive message",
    "info": "",
    "category": "※meshtastic_chat",
    "in": [],
    "out": [
      {
        "x": 1020,
        "y": 100,
        "wires": [
          {
            "id": "9ebe95fbfa40c393",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B8EA4F",
    "outputLabels": [
      "chat message"
    ],
    "icon": "node-red/node_icon_meshtastic.png",
    "status": {
      "x": 960,
      "y": 200,
      "wires": [
        {
          "id": "cc68c7211e329ee0",
          "port": 0
        },
        {
          "id": "9ebe95fbfa40c393",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "15e3d881bcd13372",
    "type": "subflow",
    "name": "meshtastic chat - send message",
    "info": "",
    "category": "※meshtastic_chat",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "5872a66485b62222"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "firstLineText",
        "type": "str",
        "value": "",
        "ui": {
          "icon": "font-awesome/fa-file-text-o",
          "label": {
            "zh-CN": "First line text",
            "en-US": "First line text"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      },
      {
        "name": "prefixText",
        "type": "str",
        "value": "",
        "ui": {
          "icon": "font-awesome/fa-file-text-o",
          "label": {
            "zh-CN": "Prefix text",
            "en-US": "Prefix text"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      },
      {
        "name": "suffixText",
        "type": "str",
        "value": "",
        "ui": {
          "icon": "font-awesome/fa-file-text-o",
          "label": {
            "zh-CN": "Suffix text",
            "en-US": "Suffix text"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "inputLabels": [
      "chat message"
    ],
    "icon": "node-red/node_icon_meshtastic.png",
    "status": {
      "x": 700,
      "y": 160,
      "wires": [
        {
          "id": "0a4a0cebe01e9bab",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "db0357a026e3fe9d",
    "type": "subflow",
    "name": "object detection",
    "info": "",
    "category": "※vision-computing",
    "in": [
      {
        "x": 80,
        "y": 660,
        "wires": [
          {
            "id": "8a351d2fe6cf41a6"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 2170,
        "y": 620,
        "wires": [
          {
            "id": "5f4428b940c5bf31",
            "port": 0
          }
        ]
      },
      {
        "x": 2160,
        "y": 920,
        "wires": [
          {
            "id": "8df1bae56c96b08c",
            "port": 0
          }
        ]
      },
      {
        "x": 2310,
        "y": 1040,
        "wires": [
          {
            "id": "7b1d5ceaabf82e41",
            "port": 0
          },
          {
            "id": "a1aa1633b40cbc7f",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Inference Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "detectObject",
        "type": "str",
        "value": "person",
        "ui": {
          "icon": "font-awesome/fa-bullseye",
          "label": {
            "zh-CN": "Detect object",
            "en-US": "Detect object"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "person",
                  "en-US": "person"
                },
                "v": "person"
              },
              {
                "l": {
                  "zh-CN": "bicycle",
                  "en-US": "bicycle"
                },
                "v": "bicycle"
              },
              {
                "l": {
                  "zh-CN": "car",
                  "en-US": "car"
                },
                "v": "car"
              },
              {
                "l": {
                  "zh-CN": "motorcycle",
                  "en-US": "motorcycle"
                },
                "v": "motorcycle"
              },
              {
                "l": {
                  "zh-CN": "airplane",
                  "en-US": "airplane"
                },
                "v": "airplane"
              },
              {
                "l": {
                  "zh-CN": "bus",
                  "en-US": "bus"
                },
                "v": "bus"
              },
              {
                "l": {
                  "zh-CN": "train",
                  "en-US": "train"
                },
                "v": "train"
              },
              {
                "l": {
                  "zh-CN": "truck",
                  "en-US": "truck"
                },
                "v": "truck"
              },
              {
                "l": {
                  "zh-CN": "boat",
                  "en-US": "boat"
                },
                "v": "boat"
              },
              {
                "l": {
                  "zh-CN": "traffic light",
                  "en-US": "traffic light"
                },
                "v": "traffic light"
              },
              {
                "l": {
                  "zh-CN": "fire hydrant",
                  "en-US": "fire hydrant"
                },
                "v": "fire hydrant"
              },
              {
                "l": {
                  "zh-CN": "stop sign",
                  "en-US": "stop sign"
                },
                "v": "stop sign"
              },
              {
                "l": {
                  "zh-CN": "parking meter",
                  "en-US": "parking meter"
                },
                "v": "parking meter"
              },
              {
                "l": {
                  "zh-CN": "bench",
                  "en-US": "bench"
                },
                "v": "bench"
              },
              {
                "l": {
                  "zh-CN": "bird",
                  "en-US": "bird"
                },
                "v": "bird"
              },
              {
                "l": {
                  "zh-CN": "cat",
                  "en-US": "cat"
                },
                "v": "cat"
              },
              {
                "l": {
                  "zh-CN": "dog",
                  "en-US": "dog"
                },
                "v": "dog"
              },
              {
                "l": {
                  "zh-CN": "horse",
                  "en-US": "horse"
                },
                "v": "horse"
              },
              {
                "l": {
                  "zh-CN": "sheep",
                  "en-US": "sheep"
                },
                "v": "sheep"
              },
              {
                "l": {
                  "zh-CN": "cow",
                  "en-US": "cow"
                },
                "v": "cow"
              },
              {
                "l": {
                  "zh-CN": "elephant",
                  "en-US": "elephant"
                },
                "v": "elephant"
              },
              {
                "l": {
                  "zh-CN": "bear",
                  "en-US": "bear"
                },
                "v": "bear"
              },
              {
                "l": {
                  "zh-CN": "zebra",
                  "en-US": "zebra"
                },
                "v": "zebra"
              },
              {
                "l": {
                  "zh-CN": "giraffe",
                  "en-US": "giraffe"
                },
                "v": "giraffe"
              },
              {
                "l": {
                  "zh-CN": "backpack",
                  "en-US": "backpack"
                },
                "v": "backpack"
              },
              {
                "l": {
                  "zh-CN": "umbrella",
                  "en-US": "umbrella"
                },
                "v": "umbrella"
              },
              {
                "l": {
                  "zh-CN": "handbag",
                  "en-US": "handbag"
                },
                "v": "handbag"
              },
              {
                "l": {
                  "zh-CN": "tie",
                  "en-US": "tie"
                },
                "v": "tie"
              },
              {
                "l": {
                  "zh-CN": "suitcase",
                  "en-US": "suitcase"
                },
                "v": "suitcase"
              },
              {
                "l": {
                  "zh-CN": "frisbee",
                  "en-US": "frisbee"
                },
                "v": "frisbee"
              },
              {
                "l": {
                  "zh-CN": "skis",
                  "en-US": "skis"
                },
                "v": "skis"
              },
              {
                "l": {
                  "zh-CN": "snowboard",
                  "en-US": "snowboard"
                },
                "v": "snowboard"
              },
              {
                "l": {
                  "zh-CN": "sports ball",
                  "en-US": "sports ball"
                },
                "v": "sports ball"
              },
              {
                "l": {
                  "zh-CN": "kite",
                  "en-US": "kite"
                },
                "v": "kite"
              },
              {
                "l": {
                  "zh-CN": "baseball bat",
                  "en-US": "baseball bat"
                },
                "v": "baseball bat"
              },
              {
                "l": {
                  "zh-CN": "baseball glove",
                  "en-US": "baseball glove"
                },
                "v": "baseball glove"
              },
              {
                "l": {
                  "zh-CN": "skateboard",
                  "en-US": "skateboard"
                },
                "v": "skateboard"
              },
              {
                "l": {
                  "zh-CN": "surfboard",
                  "en-US": "surfboard"
                },
                "v": "surfboard"
              },
              {
                "l": {
                  "zh-CN": "tennis racket",
                  "en-US": "tennis racket"
                },
                "v": "tennis racket"
              },
              {
                "l": {
                  "zh-CN": "bottle",
                  "en-US": "bottle"
                },
                "v": "bottle"
              },
              {
                "l": {
                  "zh-CN": "wine glass",
                  "en-US": "wine glass"
                },
                "v": "wine glass"
              },
              {
                "l": {
                  "zh-CN": "cup",
                  "en-US": "cup"
                },
                "v": "cup"
              },
              {
                "l": {
                  "zh-CN": "fork",
                  "en-US": "fork"
                },
                "v": "fork"
              },
              {
                "l": {
                  "zh-CN": "knife",
                  "en-US": "knife"
                },
                "v": "knife"
              },
              {
                "l": {
                  "zh-CN": "spoon",
                  "en-US": "spoon"
                },
                "v": "spoon"
              },
              {
                "l": {
                  "zh-CN": "bowl",
                  "en-US": "bowl"
                },
                "v": "bowl"
              },
              {
                "l": {
                  "zh-CN": "banana",
                  "en-US": "banana"
                },
                "v": "banana"
              },
              {
                "l": {
                  "zh-CN": "apple",
                  "en-US": "apple"
                },
                "v": "apple"
              },
              {
                "l": {
                  "zh-CN": "sandwich",
                  "en-US": "sandwich"
                },
                "v": "sandwich"
              },
              {
                "l": {
                  "zh-CN": "orange",
                  "en-US": "orange"
                },
                "v": "orange"
              },
              {
                "l": {
                  "zh-CN": "broccoli",
                  "en-US": "broccoli"
                },
                "v": "broccoli"
              },
              {
                "l": {
                  "zh-CN": "carrot",
                  "en-US": "carrot"
                },
                "v": "carrot"
              },
              {
                "l": {
                  "zh-CN": "hot dog",
                  "en-US": "hot dog"
                },
                "v": "hot dog"
              },
              {
                "l": {
                  "zh-CN": "pizza",
                  "en-US": "pizza"
                },
                "v": "pizza"
              },
              {
                "l": {
                  "zh-CN": "donut",
                  "en-US": "donut"
                },
                "v": "donut"
              },
              {
                "l": {
                  "zh-CN": "cake",
                  "en-US": "cake"
                },
                "v": "cake"
              },
              {
                "l": {
                  "zh-CN": "chair",
                  "en-US": "chair"
                },
                "v": "chair"
              },
              {
                "l": {
                  "zh-CN": "couch",
                  "en-US": "couch"
                },
                "v": "couch"
              },
              {
                "l": {
                  "zh-CN": "potted plant",
                  "en-US": "potted plant"
                },
                "v": "potted plant"
              },
              {
                "l": {
                  "zh-CN": "bed",
                  "en-US": "bed"
                },
                "v": "bed"
              },
              {
                "l": {
                  "zh-CN": "dining table",
                  "en-US": "dining table"
                },
                "v": "dining table"
              },
              {
                "l": {
                  "zh-CN": "toilet",
                  "en-US": "toilet"
                },
                "v": "toilet"
              },
              {
                "l": {
                  "zh-CN": "tv",
                  "en-US": "tv"
                },
                "v": "tv"
              },
              {
                "l": {
                  "zh-CN": "laptop",
                  "en-US": "laptop"
                },
                "v": "laptop"
              },
              {
                "l": {
                  "zh-CN": "mouse",
                  "en-US": "mouse"
                },
                "v": "mouse"
              },
              {
                "l": {
                  "zh-CN": "remote",
                  "en-US": "remote"
                },
                "v": "remote"
              },
              {
                "l": {
                  "zh-CN": "keyboard",
                  "en-US": "keyboard"
                },
                "v": "keyboard"
              },
              {
                "l": {
                  "zh-CN": "cell phone",
                  "en-US": "cell phone"
                },
                "v": "cell phone"
              },
              {
                "l": {
                  "zh-CN": "microwave",
                  "en-US": "microwave"
                },
                "v": "microwave"
              },
              {
                "l": {
                  "zh-CN": "oven",
                  "en-US": "oven"
                },
                "v": "oven"
              },
              {
                "l": {
                  "zh-CN": "toaster",
                  "en-US": "toaster"
                },
                "v": "toaster"
              },
              {
                "l": {
                  "zh-CN": "sink",
                  "en-US": "sink"
                },
                "v": "sink"
              },
              {
                "l": {
                  "zh-CN": "refrigerator",
                  "en-US": "refrigerator"
                },
                "v": "refrigerator"
              },
              {
                "l": {
                  "zh-CN": "book",
                  "en-US": "book"
                },
                "v": "book"
              },
              {
                "l": {
                  "zh-CN": "clock",
                  "en-US": "clock"
                },
                "v": "clock"
              },
              {
                "l": {
                  "zh-CN": "vase",
                  "en-US": "vase"
                },
                "v": "vase"
              },
              {
                "l": {
                  "zh-CN": "scissors",
                  "en-US": "scissors"
                },
                "v": "scissors"
              },
              {
                "l": {
                  "zh-CN": "teddy bear",
                  "en-US": "teddy bear"
                },
                "v": "teddy bear"
              },
              {
                "l": {
                  "zh-CN": "hair drier",
                  "en-US": "hair drier"
                },
                "v": "hair drier"
              },
              {
                "l": {
                  "zh-CN": "toothbrush",
                  "en-US": "toothbrush"
                },
                "v": "toothbrush"
              }
            ]
          }
        }
      },
      {
        "name": "confidence",
        "type": "str",
        "value": "50%",
        "ui": {
          "label": {
            "zh-CN": "Confidence",
            "en-US": "Confidence"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "10%",
                  "en-US": "10%"
                },
                "v": "10%"
              },
              {
                "l": {
                  "zh-CN": "20%",
                  "en-US": "20%"
                },
                "v": "20%"
              },
              {
                "l": {
                  "zh-CN": "30%",
                  "en-US": "30%"
                },
                "v": "30%"
              },
              {
                "l": {
                  "zh-CN": "40%",
                  "en-US": "40%"
                },
                "v": "40%"
              },
              {
                "l": {
                  "zh-CN": "50%",
                  "en-US": "50%"
                },
                "v": "50%"
              },
              {
                "l": {
                  "zh-CN": "60%",
                  "en-US": "60%"
                },
                "v": "60%"
              },
              {
                "l": {
                  "zh-CN": "70%",
                  "en-US": "70%"
                },
                "v": "70%"
              },
              {
                "l": {
                  "zh-CN": "80%",
                  "en-US": "80%"
                },
                "v": "80%"
              },
              {
                "l": {
                  "zh-CN": "90%",
                  "en-US": "90%"
                },
                "v": "90%"
              }
            ]
          }
        }
      },
      {
        "name": "accuracy",
        "type": "str",
        "value": "low",
        "ui": {
          "label": {
            "zh-CN": "Accuracy",
            "en-US": "Accuracy"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "(Takes 2 seconds) Low",
                  "en-US": "(Takes 2 seconds) Low"
                },
                "v": "low"
              },
              {
                "l": {
                  "zh-CN": "(Takes 5 seconds) Medium",
                  "en-US": "(Takes 5 seconds) Medium"
                },
                "v": "medium"
              },
              {
                "l": {
                  "zh-CN": "(Takes 10 seconds) High",
                  "en-US": "(Takes 10 seconds) High"
                },
                "v": "high"
              }
            ]
          }
        }
      },
      {
        "name": "----- Output 1: image -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "enabled",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "----- Output 2: inference result -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "enabled",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "----- Output 3: trigger -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "triggerMode",
        "type": "str",
        "value": "yes",
        "ui": {
          "label": {
            "zh-CN": "When ...",
            "en-US": "When ..."
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Detected",
                  "en-US": "Detected"
                },
                "v": "yes"
              },
              {
                "l": {
                  "zh-CN": "Not detected",
                  "en-US": "Not detected"
                },
                "v": "no"
              }
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#B0CBFF",
    "outputLabels": [
      "Annotated Image",
      "Inference Result",
      "Detection Trigger"
    ],
    "status": {
      "x": 2160,
      "y": 1320,
      "wires": [
        {
          "id": "112bd9434fbbd5f1",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "a71c1f4952addcd7",
    "type": "subflow",
    "name": "power system sensor",
    "info": "",
    "category": "※sensecap-weather-station",
    "in": [],
    "out": [
      {
        "x": 910,
        "y": 80,
        "wires": [
          {
            "id": "e00aad24bc1ea0c0",
            "port": 0
          }
        ]
      },
      {
        "x": 920,
        "y": 140,
        "wires": [
          {
            "id": "506c2695b3dcac2a",
            "port": 0
          }
        ]
      },
      {
        "x": 920,
        "y": 200,
        "wires": [
          {
            "id": "899ccd7752f11fc2",
            "port": 0
          }
        ]
      },
      {
        "x": 930,
        "y": 260,
        "wires": [
          {
            "id": "ae2892c04d73113b",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "meta": {},
    "color": "#B8EA4F",
    "outputLabels": [
      "Solar voltage",
      "Power of charge",
      "Battery status",
      "Battery discharge"
    ],
    "status": {
      "x": 860,
      "y": 360,
      "wires": []
    }
  },
  {
    "id": "61d68b31136dfa92",
    "type": "subflow",
    "name": "rs485 light controller - control light",
    "info": "The Light Controller Node is designed to control the state of a light based on two environment variables: `LIGHT_COLOR` and `LIGHT_MODE`. Set the light color to red, green, or yellow and the light mode to blink, flashing, on, or off. The node converts these settings into corresponding decimal values for further processing.\n\n### Environment Variables\n\n- **LIGHT_COLOR**: Defines the color of the light.\n  - Valid options: `red`, `green`, `yellow`\n  \n- **LIGHT_MODE**: Defines the mode of the light.\n  - Valid options: `blink`, `flashing`, `on`, `off`\n\n### Output Values\n\nThe node maps the combinations of `LIGHT_COLOR` and `LIGHT_MODE` to specific hexadecimal values, which are then converted to decimal values and output through the node's message payload.\n\n| LIGHT_COLOR | LIGHT_MODE | Hex Value | Decimal Value |\n|-------------|-------------|-----------|---------------|\n| red         | blink       | 0x21      | 33            |\n| red         | flashing    | 0x31      | 49            |\n| red         | on          | 0x11      | 17            |\n| red         | off         | 0x60      | 96            |\n| green       | blink       | 0x23      | 35            |\n| green       | flashing    | 0x33      | 51            |\n| green       | on          | 0x13      | 19            |\n| green       | off         | 0x60      | 96            |\n| yellow      | blink       | 0x22      | 34            |\n| yellow      | flashing    | 0x32      | 50            |\n| yellow      | on          | 0x12      | 18            |\n| yellow      | off         | 0x60      | 96            |\n\n### How to Use\n\n1. **Set Environment Variables**:\n   - Define `LIGHT_COLOR` and `LIGHT_MODE` in the node properties.\n\n2. **Deploy the Node**:\n   - Ensure the node is deployed and integrated into your main flow.\n\n3. **Trigger the Node**:\n   - Use an Inject node to set and trigger the environment variables.\n\n4. **Check Output**:\n   - The output will be a decimal value corresponding to the light settings, viewable through a Debug node.\n\n### Example Flow\n\n1. **Inject Node**: Use to set and trigger the environment variables.\n2. **Light Controller Node**: Insert the Light Controller Node.\n3. **Debug Node**: Connect to the node output to see the result.\n\nConfigure the Inject node to set `LIGHT_COLOR` and `LIGHT_MODE`. Deploy the flow, trigger the inject node, and view the output in the debug panel.",
    "category": "※rs485-light-controller",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "cc379f45cd70a2bb"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "----- Device Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "modbus-client",
        "type": "modbus-client",
        "value": "ff55020100020001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "productModel",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "*Product model",
            "en-US": "*Product model"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Type A",
                  "en-US": "Type A"
                },
                "v": "typea"
              }
            ]
          }
        }
      },
      {
        "name": "----- Light Mode -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "LIGHT_MODE",
        "type": "str",
        "value": "on",
        "ui": {
          "label": {
            "zh-CN": "*Light mode",
            "en-US": "*Light mode"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "On",
                  "en-US": "On"
                },
                "v": "on"
              },
              {
                "l": {
                  "zh-CN": "Blink",
                  "en-US": "Blink"
                },
                "v": "blink"
              },
              {
                "l": {
                  "zh-CN": "Flashing",
                  "en-US": "Flashing"
                },
                "v": "flashing"
              },
              {
                "l": {
                  "zh-CN": "Off",
                  "en-US": "Off"
                },
                "v": "off"
              }
            ]
          }
        }
      },
      {
        "name": "LIGHT_COLOR",
        "type": "str",
        "value": "red",
        "ui": {
          "label": {
            "zh-CN": "*Light color",
            "en-US": "*Light color"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Red",
                  "en-US": "Red"
                },
                "v": "red"
              },
              {
                "l": {
                  "zh-CN": "Green",
                  "en-US": "Green"
                },
                "v": "green"
              },
              {
                "l": {
                  "zh-CN": "Yellow",
                  "en-US": "Yellow"
                },
                "v": "yellow"
              }
            ]
          }
        }
      }
    ],
    "meta": {
      "module": "lgiht-controller-yx75r-ryg",
      "version": "0.0.1",
      "author": "Peter Pan",
      "desc": "This is a modbus Light Controller for yx75r-ryg light",
      "license": "MIT"
    },
    "color": "#B8EA4F",
    "icon": "node-red/light.svg",
    "status": {
      "x": 960,
      "y": 140,
      "wires": [
        {
          "id": "de52d590953c98c7",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "b8596ac29abcf525",
    "type": "subflow",
    "name": "rs485 light controller - control sound",
    "info": "",
    "category": "※rs485-light-controller",
    "in": [
      {
        "x": 300,
        "y": 460,
        "wires": [
          {
            "id": "f25ba559326dccfb"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "----- Device Connection -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "hide"
        }
      },
      {
        "name": "modbus-client",
        "type": "modbus-client",
        "value": "ff55020100020001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "product-model",
        "type": "str",
        "value": "type_a",
        "ui": {
          "label": {
            "zh-CN": "*Product model",
            "en-US": "*Product model"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Type A",
                  "en-US": "Type A"
                },
                "v": "type_a"
              }
            ]
          }
        }
      },
      {
        "name": "----- Device Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "action",
        "type": "str",
        "value": "play",
        "ui": {
          "label": {
            "zh-CN": "Action",
            "en-US": "Action"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Play",
                  "en-US": "Play"
                },
                "v": "play"
              },
              {
                "l": {
                  "zh-CN": "Stop",
                  "en-US": "Stop"
                },
                "v": "stop"
              }
            ]
          }
        }
      },
      {
        "name": "volume",
        "type": "num",
        "value": "1",
        "ui": {
          "label": {
            "zh-CN": "Volume",
            "en-US": "Volume"
          },
          "type": "spinner",
          "opts": {
            "min": 1,
            "max": 30
          }
        }
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "icon": "font-awesome/fa-volume-up",
    "status": {
      "x": 1220,
      "y": 640,
      "wires": [
        {
          "id": "7f7fc470a59b569f",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "0d921b2cdb2f47a8",
    "type": "subflow",
    "name": "tracking analyze",
    "info": "",
    "category": "※meshtastic_tracker",
    "in": [
      {
        "x": 40,
        "y": 140,
        "wires": [
          {
            "id": "b7006d8725379028"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1530,
        "y": 220,
        "wires": [
          {
            "id": "4dc77c2354f525c8",
            "port": 0
          }
        ]
      },
      {
        "x": 1530,
        "y": 260,
        "wires": [
          {
            "id": "1c0afd68563ff258",
            "port": 0
          }
        ]
      },
      {
        "x": 1530,
        "y": 300,
        "wires": [
          {
            "id": "1c0afd68563ff258",
            "port": 1
          }
        ]
      }
    ],
    "env": [],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B0CBFF",
    "outputLabels": [
      "Annotated Image",
      "Counting (A to B)",
      "Counting (B to A)"
    ],
    "icon": "font-awesome/fa-map-marker",
    "status": {
      "x": 1620,
      "y": 420,
      "wires": [
        {
          "id": "eba60b2edc9f1677",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "a6ec996dc8d4208d",
    "type": "subflow",
    "name": "watcher-stt",
    "info": "",
    "category": "",
    "in": [],
    "out": [
      {
        "x": 1760,
        "y": 400,
        "wires": [
          {
            "id": "4b0eee312fed3a38",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "RSP_TEXT",
        "type": "str",
        "value": "OK!"
      },
      {
        "name": "RSP_AUDIO",
        "type": "str",
        "value": ""
      }
    ],
    "meta": {},
    "color": "#DDAA99"
  },
  {
    "id": "336d4af7487f2429",
    "type": "subflow",
    "name": "watcher-take-pictures",
    "info": "",
    "category": "",
    "in": [],
    "out": [
      {
        "x": 980,
        "y": 840,
        "wires": [
          {
            "id": "5e72fad9417a86ce",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "RSP_TEXT",
        "type": "str",
        "value": "OK!"
      },
      {
        "name": "RSP_AUDIO",
        "type": "str",
        "value": ""
      },
      {
        "name": "PIC_DURATION",
        "type": "str",
        "value": "1"
      }
    ],
    "meta": {},
    "color": "#DDAA99"
  },
  {
    "id": "c1b434e7ff15727e",
    "type": "subflow",
    "name": "whether detect any object",
    "info": "",
    "category": "※camera-grove-vision-ai-v2",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "684df14293772fea"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 760,
        "y": 40,
        "wires": [
          {
            "id": "e5661c67a0e2a2fd",
            "port": 0
          }
        ]
      },
      {
        "x": 750,
        "y": 140,
        "wires": [
          {
            "id": "e5661c67a0e2a2fd",
            "port": 1
          }
        ]
      }
    ],
    "env": [],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#E2D96E",
    "inputLabels": [
      "connect from the inference result output"
    ],
    "outputLabels": [
      "if yes ...",
      "if no ..."
    ]
  },
  {
    "id": "13477c0ac0505b10",
    "type": "subflow",
    "name": "meshtastic tracker - get gps position",
    "info": "## Introduction\n\nThrough the network of meshtastic, the location information of trackers in the network is obtained.\n\n\n---\n\n## input\n\nNo input is required, and when it runs in flow, it automatically listens for gps location messages in the meshtastic network, according to the configuration\n\n---\n\n## output\n\n#### Port 1\n\n#### Port 2\n",
    "category": "※meshtastic_tracker",
    "in": [],
    "out": [
      {
        "x": 840,
        "y": 160,
        "wires": [
          {
            "id": "231cd3facd735ada",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Connection -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B8EA4F",
    "outputLabels": [
      "a mapping point"
    ],
    "icon": "font-awesome/fa-sitemap",
    "status": {
      "x": 780,
      "y": 280,
      "wires": [
        {
          "id": "7470914cd532181c",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "529a178a8fc4fc7a",
    "type": "subflow",
    "name": "meshtastic chat ui",
    "info": "",
    "category": "※meshtastic_chat",
    "in": [
      {
        "x": 60,
        "y": 80,
        "wires": [
          {
            "id": "3c958064b5993cea"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "Group",
        "type": "ui-group",
        "value": "",
        "ui": {
          "type": "conf-types"
        }
      }
    ],
    "meta": {},
    "color": "#9FE6EC",
    "icon": "node-red/node_icon_meshtastic.png",
    "status": {
      "x": 300,
      "y": 180,
      "wires": []
    }
  },
  {
    "id": "951833ec275c67c2",
    "type": "subflow",
    "name": "geofence map ui",
    "info": "",
    "category": "※geofence",
    "in": [
      {
        "x": 100,
        "y": 480,
        "wires": [
          {
            "id": "d1fba09ee796a36a"
          }
        ]
      }
    ],
    "out": [],
    "env": [
      {
        "name": "Group",
        "type": "ui-group",
        "value": "",
        "ui": {
          "type": "conf-types"
        }
      },
      {
        "name": "webPath",
        "type": "str",
        "value": "/w",
        "ui": {
          "label": {
            "zh-CN": "webPath",
            "en-US": "webPath"
          },
          "type": "input",
          "opts": {
            "types": [
              "str",
              "env"
            ]
          }
        }
      },
      {
        "name": "startLatitude",
        "type": "str",
        "value": "22.57"
      },
      {
        "name": "startLongitude",
        "type": "str",
        "value": "113.92"
      },
      {
        "name": "zoom",
        "type": "str",
        "value": "11"
      },
      {
        "name": "----- Offline Map -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "useOfflineMap",
        "type": "bool",
        "value": "false",
        "ui": {
          "label": {
            "zh-CN": "Offline map",
            "en-US": "Offline map"
          },
          "type": "input",
          "opts": {
            "types": [
              "bool"
            ]
          }
        }
      },
      {
        "name": "offlineMapZoom",
        "type": "str",
        "value": "1",
        "ui": {
          "label": {
            "zh-CN": "Offline Map Zoom",
            "en-US": "Offline Map Zoom"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "1 (map-1.pmtiles)",
                  "en-US": "1 (map-1.pmtiles)"
                },
                "v": "1"
              },
              {
                "l": {
                  "zh-CN": "2 (map-2.pmtiles)",
                  "en-US": "2 (map-2.pmtiles)"
                },
                "v": "2"
              },
              {
                "l": {
                  "zh-CN": "3 (map-3.pmtiles)",
                  "en-US": "3 (map-3.pmtiles)"
                },
                "v": "3"
              },
              {
                "l": {
                  "zh-CN": "4 (map-4.pmtiles)",
                  "en-US": "4 (map-4.pmtiles)"
                },
                "v": "4"
              },
              {
                "l": {
                  "zh-CN": "5 (map-5.pmtiles)",
                  "en-US": "5 (map-5.pmtiles)"
                },
                "v": "5"
              },
              {
                "l": {
                  "zh-CN": "6 (map-6.pmtiles)",
                  "en-US": "6 (map-6.pmtiles)"
                },
                "v": "6"
              },
              {
                "l": {
                  "zh-CN": "7 (map-7.pmtiles)",
                  "en-US": "7 (map-7.pmtiles)"
                },
                "v": "7"
              },
              {
                "l": {
                  "zh-CN": "8 (map-8.pmtiles)",
                  "en-US": "8 (map-8.pmtiles)"
                },
                "v": "8"
              },
              {
                "l": {
                  "zh-CN": "9 (map-9.pmtiles)",
                  "en-US": "9 (map-9.pmtiles)"
                },
                "v": "9"
              },
              {
                "l": {
                  "zh-CN": "10 (map-10.pmtiles)",
                  "en-US": "10 (map-10.pmtiles)"
                },
                "v": "10"
              },
              {
                "l": {
                  "zh-CN": "11 (map-11.pmtiles)",
                  "en-US": "11 (map-11.pmtiles)"
                },
                "v": "11"
              },
              {
                "l": {
                  "zh-CN": "12 (map-12.pmtiles)",
                  "en-US": "12 (map-12.pmtiles)"
                },
                "v": "12"
              }
            ]
          }
        }
      }
    ],
    "meta": {},
    "color": "#9FE6EC",
    "status": {
      "x": 640,
      "y": 580,
      "wires": [
        {
          "id": "af4d632bf88b7dfd",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "ff55010600100002",
    "type": "subflow",
    "name": "meshtastic tracker - get device status",
    "info": "## Introduction\n\nThrough the network of meshtastic, the location information of trackers in the network is obtained.\n\n\n---\n\n## input\n\nNo input is required, and when it runs in flow, it automatically listens for gps location messages in the meshtastic network, according to the configuration\n\n---\n\n## output\n\n#### Port 1\n\n#### Port 2\n",
    "category": "※meshtastic_tracker",
    "in": [],
    "out": [
      {
        "x": 840,
        "y": 160,
        "wires": [
          {
            "id": "c751dff9f403c31b",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Connection -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "mqtt-broker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      }
    ],
    "meta": {
      "version": "0.0.1",
      "author": "seeed",
      "license": "Apache-2.0"
    },
    "color": "#B8EA4F",
    "outputLabels": [
      "a mapping point"
    ],
    "icon": "font-awesome/fa-sitemap",
    "status": {
      "x": 780,
      "y": 280,
      "wires": [
        {
          "id": "cb2302df9f3430d8",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "a040f0957f827e96",
    "type": "subflow",
    "name": "rs485 light controller - control light",
    "info": "### Light Controller Node Overview\n\nThe Light Controller Node is designed to control the state of a light based on three environment variables: `Light Color`, `Light Mode`, and `Product model`. The node converts these settings into corresponding Modbus commands for further processing.\n\n### Environment Variables\n\n- **Light Color**: Defines the color of the light.\n  - Valid options: `red`, `green`, `yellow`, `blue`\n- **Light Mode**: Defines the mode of the light.\n  - Valid options: `on`, `blink`, `flashing`, `off`\n- **Product Model**: Defines the type of light product.\n  - Valid options: `3 Color Light with Sound (Round) [User Manual](https://files.seeedstudio.com/wiki/Mission-Pack/peripheral/3-Color-Light-with-Sound-%28Round%29.pdf)`, `4 Color Light Only (Rectangle)[User Manual](https://files.seeedstudio.com/wiki/Mission-Pack/peripheral/4-Color-Light-Only-%28Rectangle%29.pdf)`\n\n### Output Values\n\nThe node maps the combinations of `Light Color`, `Light Mode`, and `Product Model` to specific hexadecimal values, which are then converted to decimal values and output through the node's message payload. These values vary depending on the product model:\n\n#### 3 Color Light with Sound (Round)\n\n| LIGHT_COLOR | LIGHT_MODE | Hex Value | Decimal Value |\n|-------------|-------------|-----------|---------------|\n| red         | blink       | 0x21      | 33            |\n| red         | flashing    | 0x31      | 49            |\n| red         | on          | 0x11      | 17            |\n| red         | off         | 0x60      | 96            |\n| green       | blink       | 0x23      | 35            |\n| green       | flashing    | 0x33      | 51            |\n| green       | on          | 0x13      | 19            |\n| green       | off         | 0x60      | 96            |\n| yellow      | blink       | 0x22      | 34            |\n| yellow      | flashing    | 0x32      | 50            |\n| yellow      | on          | 0x12      | 18            |\n| yellow      | off         | 0x60      | 96            |\n\n#### 4 Color Light Only (Rectangle)\n\n| LIGHT_COLOR | LIGHT_MODE | Address Value |\n|-------------|-------------|---------------|\n| red         | on          | 0             |\n| red         | blink       | 8             |\n| red         | off         | 4             |\n| green       | on          | 1             |\n| green       | blink       | 9             |\n| green       | off         | 4             |\n| blue        | on          | 2             |\n| blue        | blink       | 10            |\n| blue        | off         | 4             |\n\n### How to Use\n\n1. **Set Environment Variables**:\n   - Define `Light Color`, `Light Mode`, and `Product Model` in the node properties.\n\n2. **Deploy the Node**:\n   - Ensure the node is deployed and integrated into your main flow.\n\n3. **Trigger the Node**:\n   - Use an Inject node to set and trigger the environment variables.\n\n4. **Check Output**:\n   - The output will be a Modbus command with the relevant configuration, viewable through a Debug node.\n\n### Example Flow\n\n1. **Inject Node**: Use to set and trigger the environment variables.\n2. **Light Controller Node**: Insert the Light Controller Node.\n3. **Debug Node**: Connect to the node output to see the result.\n\nConfigure the Inject node to set `Light Color`, `Light Mode`, and `Product Model`. Deploy the flow, trigger the inject node, and view the output in the debug panel.\n\n",
    "category": "※rs485-light-controller",
    "in": [
      {
        "x": 180,
        "y": 220,
        "wires": [
          {
            "id": "10a299ef37e21e10"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 920,
        "y": 260,
        "wires": [
          {
            "id": "f54825b3f337b670",
            "port": 1
          }
        ]
      }
    ],
    "env": [
      {
        "name": "----- Device Settings -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "modbus-client",
        "type": "modbus-client",
        "value": "ff55020100020001",
        "ui": {
          "icon": "font-awesome/fa-server",
          "label": {
            "zh-CN": "*Server",
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "PRODUCT_MODEL",
        "type": "str",
        "value": "",
        "ui": {
          "label": {
            "zh-CN": "*Product model",
            "en-US": "*Product model"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "en-US": "4 Color Light Only (Rectangle)"
                },
                "v": "type_b"
              },
              {
                "l": {
                  "zh-CN": "Type A",
                  "en-US": "4 Color Light with Sound (Round)"
                },
                "v": "type_a"
              }
            ]
          }
        }
      },
      {
        "name": "----- Light Mode -----",
        "type": "str",
        "value": "",
        "ui": {
          "type": "none"
        }
      },
      {
        "name": "LIGHT_MODE",
        "type": "str",
        "value": "on",
        "ui": {
          "label": {
            "zh-CN": "*Light mode",
            "en-US": "*Light mode"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "On",
                  "en-US": "On"
                },
                "v": "on"
              },
              {
                "l": {
                  "zh-CN": "Blink",
                  "en-US": "Blink"
                },
                "v": "blink"
              },
              {
                "l": {
                  "zh-CN": "Flashing",
                  "en-US": "Flashing"
                },
                "v": "flashing"
              },
              {
                "l": {
                  "zh-CN": "Off",
                  "en-US": "Off"
                },
                "v": "off"
              }
            ]
          }
        }
      },
      {
        "name": "LIGHT_COLOR",
        "type": "str",
        "value": "red",
        "ui": {
          "label": {
            "zh-CN": "*Light color",
            "en-US": "*Light color"
          },
          "type": "select",
          "opts": {
            "opts": [
              {
                "l": {
                  "zh-CN": "Red",
                  "en-US": "Red"
                },
                "v": "red"
              },
              {
                "l": {
                  "zh-CN": "Green",
                  "en-US": "Green"
                },
                "v": "green"
              },
              {
                "l": {
                  "zh-CN": "Yellow",
                  "en-US": "Yellow"
                },
                "v": "yellow"
              },
              {
                "l": {
                  "zh-CN": "Blue"
                },
                "v": "blue"
              }
            ]
          }
        }
      }
    ],
    "meta": {
      "module": "lgiht-controller-yx75r-ryg",
      "version": "0.0.2",
      "author": "Peter Pan",
      "desc": "This is a modbus Light Controller for light built-in Mission Pack",
      "license": "MIT"
    },
    "color": "#B8EA4F",
    "icon": "node-red/light.svg",
    "status": {
      "x": 530,
      "y": 340,
      "wires": [
        {
          "id": "382d23086ffe0a6b",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "87939573fe60ee41",
    "type": "subflow",
    "name": "SenseCAP S2120",
    "info": "",
    "category": "※sensecap-weather-station",
    "in": [],
    "out": [
      {
        "x": 1880,
        "y": 40,
        "wires": [
          {
            "id": "33eb74c0b4557601",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 100,
        "wires": [
          {
            "id": "a5989be044896ac6",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 160,
        "wires": [
          {
            "id": "49e5994cb011441f",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 220,
        "wires": [
          {
            "id": "6a79458857258288",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 280,
        "wires": [
          {
            "id": "c9e8e69b0e45b601",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 340,
        "wires": [
          {
            "id": "62bafff00d193ccc",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 400,
        "wires": [
          {
            "id": "ceace3ccff89578e",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 460,
        "wires": [
          {
            "id": "1a6345570867ba2d",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 520,
        "wires": [
          {
            "id": "36063877102cf177",
            "port": 0
          }
        ]
      },
      {
        "x": 1880,
        "y": 580,
        "wires": [
          {
            "id": "a5d27fc5ba8e5914",
            "port": 0
          }
        ]
      }
    ],
    "env": [
      {
        "name": "mqttBroker",
        "type": "mqtt-broker",
        "value": "ff55020100010001",
        "ui": {
          "label": {
            "en-US": "*Server"
          },
          "type": "conf-types"
        }
      },
      {
        "name": "applicationId",
        "type": "str",
        "value": ""
      },
      {
        "name": "deviceId",
        "type": "str",
        "value": ""
      }
    ],
    "meta": {},
    "color": "#B8EA4F",
    "icon": "node-red/node_icon_s2100.png",
    "status": {
      "x": 1020,
      "y": 600,
      "wires": []
    }
  },
  {
    "id": "e17956ebf8df1058",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "c0843f7df37d8e49",
      "b64fe8d75146fa69",
      "ca580e1444a51d82"
    ],
    "x": 814,
    "y": 479,
    "w": 312,
    "h": 142
  },
  {
    "id": "4812ceb994ecee47",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "6f49bb85fb1ca9dd",
      "2a5b878f4609d83d",
      "5c869b5a19000f23",
      "a3d2cf36d30ad3a8",
      "7712b011fe04d5e2",
      "1a9a58a193b6a274",
      "86d3046f1847f777"
    ],
    "x": 274,
    "y": 699,
    "w": 1132,
    "h": 142
  },
  {
    "id": "d821d39182a45218",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "195c561cb96ad7cb",
      "8e5fb88de994075b",
      "a8dfe50e821dfd0b"
    ],
    "x": 268,
    "y": 179,
    "w": 1704,
    "h": 268
  },
  {
    "id": "b36553531342820f",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "a78007c93b1c1fe1",
      "46ee7c72c6d678a2",
      "1fec46e9cd347a2a",
      "d1f974398f147b02",
      "1567eeb1bb47fec5"
    ],
    "x": 274,
    "y": 479,
    "w": 532,
    "h": 202
  },
  {
    "id": "977b1c156a278f35",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "82a43b334bf4b932",
      "c6651882a2276fc2",
      "03a1c725d65f15e2",
      "7fff0e065d651496",
      "9abc04b2e7d3257a"
    ],
    "x": 274,
    "y": 19,
    "w": 1312,
    "h": 142
  },
  {
    "id": "99d0e9268f69dc25",
    "type": "group",
    "z": "aa193c820dc14bcf",
    "name": "initial stage, all items report ids",
    "style": {
      "label": true
    },
    "nodes": [
      "c7ddc2768894bbca",
      "3ea72c2a420cfde0"
    ],
    "x": 374,
    "y": 39,
    "w": 492,
    "h": 82
  },
  {
    "id": "033919525f9f8f52",
    "type": "group",
    "z": "e404a21a200ea798",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "4a7e17d4865cffa2",
      "87c774e28eacd57b"
    ],
    "x": 954,
    "y": 139,
    "w": 492,
    "h": 82
  },
  {
    "id": "93233531937b3c5b",
    "type": "group",
    "z": "e404a21a200ea798",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "1757226126fc2011",
      "b9e071b6f00c3d67",
      "27ac2da36edceb77",
      "2271c8e79360da12"
    ],
    "x": 124,
    "y": 99,
    "w": 782,
    "h": 82
  },
  {
    "id": "1891c8a9c8279dc1",
    "type": "group",
    "z": "e404a21a200ea798",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "f498bbc270cb5e99",
      "a9a2f7647a0e4ed4"
    ],
    "x": 954,
    "y": 39,
    "w": 492,
    "h": 82
  },
  {
    "id": "7f68e627b4ad456a",
    "type": "group",
    "z": "c5b584eb17fdf706",
    "name": "get face name by face id",
    "style": {
      "label": true,
      "color": "#000000"
    },
    "nodes": [
      "abd38a3bfba94980",
      "7a46d18411e71823",
      "5b94bf340246e2f4"
    ],
    "x": 134,
    "y": 439,
    "w": 592,
    "h": 82
  },
  {
    "id": "e6f197a5204b1d19",
    "type": "group",
    "z": "c5b584eb17fdf706",
    "name": "get all vectors computing",
    "style": {
      "label": true,
      "color": "#000000"
    },
    "nodes": [
      "81d8c848044b4824",
      "cdeb1ae0239a071a",
      "3c1501d272224b44",
      "1a6981a43e2ef392",
      "e69c7076a06a204d",
      "e7ef601afcf5adf7"
    ],
    "x": 134,
    "y": 319,
    "w": 1112,
    "h": 102
  },
  {
    "id": "57d31dd28e179a83",
    "type": "group",
    "z": "c5b584eb17fdf706",
    "name": "get current face vector",
    "style": {
      "label": true,
      "color": "#000000"
    },
    "nodes": [
      "6119ca70cef18695",
      "822916ab0d9311d2",
      "b10beb24b2cfe3e1",
      "94ec4bf104636819",
      "eacdc21c158e48a0",
      "16819fbb21a27697",
      "8bb12f72033949dd",
      "b8156427366ffbc0",
      "20ccfceca2c8a814"
    ],
    "x": 134,
    "y": 79,
    "w": 1252,
    "h": 222
  },
  {
    "id": "e18cdbece1ee414b",
    "type": "group",
    "z": "5bb547dce475f866",
    "name": "update records file",
    "style": {
      "label": true
    },
    "nodes": [
      "d8d29a2e1f68dfe7",
      "13ea454879d2d2db",
      "6fe4a735d30c679b",
      "fe36be70f959558f",
      "d5eb4430aeb03f2b",
      "613abc3d927e73b0",
      "d515c361989c804d",
      "82ed87c64df302ee",
      "a65f432ce45eef27"
    ],
    "x": 134,
    "y": 259,
    "w": 1352,
    "h": 162
  },
  {
    "id": "0574b46850707de5",
    "type": "group",
    "z": "5bb547dce475f866",
    "name": "update records-name file",
    "style": {
      "label": true
    },
    "nodes": [
      "77d34c5dcff131de",
      "571941aded192eef",
      "f145c165bea3f87a",
      "244f3d42bf4c2b31",
      "3f60edfd50035b43"
    ],
    "x": 134,
    "y": 439,
    "w": 1052,
    "h": 82
  },
  {
    "id": "a18ab3f640fb968f",
    "type": "group",
    "z": "5bb547dce475f866",
    "name": "get current face vector",
    "style": {
      "label": true
    },
    "nodes": [
      "eb2c8ec65d140976",
      "bf02cef20c7c5573",
      "f8aa938b61591ffb",
      "2ca56057b286ed99",
      "061cd6fe11f24d84",
      "1bd947ef0136bf4a",
      "fb700ec9c87b1f8b",
      "a641359c4d064d04",
      "015f9db91af3e390",
      "bb060c49a5f4dc36",
      "5b84894c77c1fc50"
    ],
    "x": 134,
    "y": 39,
    "w": 1232,
    "h": 202
  },
  {
    "id": "e5814d054eae8048",
    "type": "group",
    "z": "db0357a026e3fe9d",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "0f4d7859be6d8074",
      "09f9f99a2de46ed5",
      "678f2517e5e8f360",
      "b543a5489b7db3b9",
      "6842503887995176"
    ],
    "x": 1894,
    "y": 699,
    "w": 592,
    "h": 162
  },
  {
    "id": "a39f94d95dd8c901",
    "type": "group",
    "z": "0d921b2cdb2f47a8",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "b7006d8725379028",
      "f928057a172b6bc7",
      "6e1637526d57a66b",
      "d40434e5e9fa984d",
      "d4685d2e3ef9a309",
      "54b9a4ed0e9da2db"
    ],
    "x": 94,
    "y": 19,
    "w": 1022,
    "h": 202
  },
  {
    "id": "a4b73bc8cf9a4730",
    "type": "group",
    "z": "0d921b2cdb2f47a8",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "15333d07b325118d",
      "3693cc2db6709049",
      "3d954623e05cac57",
      "33ef77d3eac513f0",
      "01b6c388adacec9b",
      "03c368738cc7f8f2"
    ],
    "x": 94,
    "y": 239,
    "w": 1032,
    "h": 142
  },
  {
    "id": "4cea5da7a6e042b9",
    "type": "group",
    "z": "0d921b2cdb2f47a8",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "cf49b87ca54fadb6",
      "2001f5fb16131c7a",
      "ef3714d03835eed0",
      "ea0c0d562f20ce77",
      "42ee150fd31ac501"
    ],
    "x": 94,
    "y": 399,
    "w": 1032,
    "h": 142
  },
  {
    "id": "9dfd1352fc8f5514",
    "type": "group",
    "z": "951833ec275c67c2",
    "name": "update geofence",
    "style": {
      "label": true
    },
    "nodes": [
      "0321fc619fdefe20",
      "e1d9d1d5615765de",
      "b7d9bbba6ab1b2c2",
      "7311a79049ce08bb",
      "792a9f34bd996a0d"
    ],
    "x": 54,
    "y": 251.5,
    "w": 632,
    "h": 149.5
  },
  {
    "id": "c1371c3a2c8d4f9a",
    "type": "group",
    "z": "951833ec275c67c2",
    "name": "set map settings on connect",
    "style": {
      "label": true
    },
    "nodes": [
      "bf29b331c7f2a940",
      "5c6b04022962467c",
      "9eef6878aa2e5901"
    ],
    "x": 54,
    "y": 139,
    "w": 912,
    "h": 82
  },
  {
    "id": "28c70b3fb05d3267",
    "type": "group",
    "z": "951833ec275c67c2",
    "name": "dashboard ui",
    "style": {
      "label": true
    },
    "nodes": [
      "f1181c566e893035",
      "86cc369d49d63f68",
      "05bb79f6cfd781f4"
    ],
    "x": 54,
    "y": 39,
    "w": 532,
    "h": 82
  },
  {
    "id": "8251399ab5e97093",
    "type": "group",
    "z": "0659cda55a05f740",
    "name": "",
    "style": {
      "label": true,
      "color": "#000000",
      "fill": "#dbcbe7"
    },
    "nodes": [
      "ad2e13ab7c986d05",
      "0cc6f8f73a498441",
      "2c12362a3c3d0eae",
      "88573d33cfe19edf",
      "e1dc6451e9e339a6"
    ],
    "x": 64,
    "y": 119,
    "w": 792,
    "h": 402
  },
  {
    "id": "c702fbe05b9afb59",
    "type": "group",
    "z": "0659cda55a05f740",
    "name": "",
    "style": {
      "label": true,
      "color": "#000000",
      "fill": "#dbcbe7"
    },
    "nodes": [
      "85f635cb0c722614",
      "e69425b83273e1f9",
      "432ef9ad0794a77a",
      "b4baf6bb84dd2511",
      "36e2137aa6d5fb4f",
      "812ea1fadddc2f43",
      "833dfce865b19b2f",
      "13b3a02c6a414d6d",
      "a3787b2c45bb09b3",
      "027cdd18eae2489d",
      "becf3cfdcc4ddb21",
      "624a0c4e1be347e2"
    ],
    "x": 74,
    "y": 559,
    "w": 572,
    "h": 442
  },
  {
    "id": "f11bf0633195afe6",
    "type": "group",
    "z": "0659cda55a05f740",
    "name": "",
    "style": {
      "label": true,
      "color": "#000000",
      "fill": "#dbcbe7"
    },
    "nodes": [
      "8f4e14449f78d9c7",
      "b5c67be953f9a256",
      "ef65ded2e9d4b6d8",
      "f996c4df6525225c",
      "34c8a12384d94a83",
      "e2036e1f82dc877b"
    ],
    "x": 888,
    "y": 119,
    "w": 924,
    "h": 568
  },
  {
    "id": "ad60dd8276ebc91f",
    "type": "group",
    "z": "0659cda55a05f740",
    "style": {
      "stroke": "#3d3e46",
      "stroke-opacity": "1",
      "fill": "#21222c",
      "fill-opacity": "0.5",
      "label": true,
      "label-position": "nw",
      "color": "#f8f8f2"
    },
    "nodes": [
      "ea9c70d40f694a81",
      "0101ede081a4c0f8",
      "134a0b6660ec4271",
      "34000a572d2865db",
      "9231025e7e8cc366",
      "4279d3d0717f8a33",
      "dc9c32c8cd435f45",
      "f2c3ad4921b598f8",
      "d63a6d794598f60f",
      "d957f1dca8608f37",
      "a5e513e1c35b327d"
    ],
    "x": 894,
    "y": 699,
    "w": 992,
    "h": 462
  },
  {
    "id": "877c275c9c5ce289",
    "type": "group",
    "z": "0659cda55a05f740",
    "style": {
      "stroke": "#3d3e46",
      "stroke-opacity": "1",
      "fill": "#21222c",
      "fill-opacity": "0.5",
      "label": true,
      "label-position": "nw",
      "color": "#f8f8f2"
    },
    "nodes": [
      "2cbd8278a58cc763",
      "e6932abd14a69f0b"
    ],
    "x": 54,
    "y": 1079,
    "w": 772,
    "h": 82
  },
  {
    "id": "3ef9216a78268b39",
    "type": "group",
    "z": "83ddd822c5c4b267",
    "style": {
      "stroke": "#3d3e46",
      "stroke-opacity": "1",
      "fill": "#21222c",
      "fill-opacity": "0.5",
      "label": true,
      "label-position": "nw",
      "color": "#f8f8f2"
    },
    "nodes": [
      "98140bc009a8360d",
      "1e9fd3689fd29354",
      "e269bd7ca3d5ab90",
      "9ac738c9569d9b32",
      "45da8c0a04f01cee",
      "4623e0824908287d",
      "aa441f238241b94c",
      "cadfe4b80da526b4",
      "2b37f593d84b3ac1",
      "7cb7100889ba7675",
      "5538c36c2ef9e75e",
      "18d28b01e018585f",
      "0f889c1d5c1b3de8",
      "6fdf3f5248a1c18e",
      "34620f9085de7037"
    ],
    "x": 154,
    "y": 179,
    "w": 1132,
    "h": 522
  },
  {
    "id": "a8dfe50e821dfd0b",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "g": "d821d39182a45218",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "37a4169a796bc409",
      "1a1aac49baec583b",
      "27dc0363dfd2c60d",
      "e5470b0dea4188f0",
      "6b25c7462632d304",
      "b9be4eadde0d5464",
      "4813977826279959"
    ],
    "x": 1034,
    "y": 219,
    "w": 912,
    "h": 202
  },
  {
    "id": "8e5fb88de994075b",
    "type": "group",
    "z": "1766c4cb75850c2c",
    "g": "d821d39182a45218",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "3ea0d24d5a357d8c",
      "b97841458d677cf9",
      "4712b34643952b3c",
      "1ed7a698814e5190",
      "45f2f20fc1a0b77f"
    ],
    "x": 294,
    "y": 259,
    "w": 732,
    "h": 162
  },
  {
    "id": "ad2e13ab7c986d05",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "8251399ab5e97093",
    "name": "When a new tracker's position reported, check geofence",
    "style": {
      "label": true
    },
    "nodes": [
      "60b1721c8f2f192f",
      "104d0182465308b0",
      "83a1c4206bdadc28"
    ],
    "x": 114,
    "y": 299,
    "w": 702,
    "h": 82
  },
  {
    "id": "0cc6f8f73a498441",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "8251399ab5e97093",
    "name": "A ui button to clear geofence record",
    "style": {
      "label": true
    },
    "nodes": [
      "50f3808dc27d03ec",
      "f6995bba2807dbcf",
      "d6ae04695590915d"
    ],
    "x": 104,
    "y": 399,
    "w": 612,
    "h": 82
  },
  {
    "id": "e1dc6451e9e339a6",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "8251399ab5e97093",
    "name": "Receive tracker's postion reported, and add a poin to the map",
    "style": {
      "label": true
    },
    "nodes": [
      "a56934c807269ea8",
      "794f6f1403b5da46"
    ],
    "x": 114,
    "y": 199,
    "w": 672,
    "h": 82
  },
  {
    "id": "8f4e14449f78d9c7",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "send chat message",
    "style": {
      "label": true,
      "fill": "none"
    },
    "nodes": [
      "71f8d5f648c86d9b",
      "eb0c56d232605fda",
      "fc404d18dd19cd6b",
      "837003ff9da67964",
      "a2439d093ac64042",
      "d674390c2cab0c41",
      "5d541ca2b1125fec"
    ],
    "x": 914,
    "y": 459,
    "w": 872,
    "h": 202
  },
  {
    "id": "b5c67be953f9a256",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "chat box ui",
    "style": {
      "label": true
    },
    "nodes": [
      "b377b7368363b941",
      "36d3298bcfa34c87",
      "a37efe4de95a1802",
      "c72b162dc6f6b02f",
      "0c10ce89d51a0984",
      "ca75938e99dccd3f"
    ],
    "x": 924,
    "y": 159,
    "w": 712,
    "h": 162
  },
  {
    "id": "ef65ded2e9d4b6d8",
    "type": "group",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "receive chat message",
    "style": {
      "label": true
    },
    "nodes": [
      "ad635efce0e91966",
      "4764b35399c850f0"
    ],
    "x": 914,
    "y": 339,
    "w": 472,
    "h": 82
  },
  {
    "id": "2a6c6f3f0d1de049",
    "type": "ui-base",
    "name": "Hazard Response Mission Pack",
    "path": "/dashboard",
    "includeClientData": true,
    "acceptsClientConfig": [
      "ui-notification",
      "ui-control"
    ],
    "showPathInSidebar": false,
    "showPageTitle": true,
    "navigationStyle": "default",
    "titleBarStyle": "default"
  },
  {
    "id": "bf7959673d8303c0",
    "type": "ui-theme",
    "name": "Default Theme",
    "colors": {
      "surface": "#ffffff",
      "primary": "#0094ce",
      "bgPage": "#eeeeee",
      "groupBg": "#ffffff",
      "groupOutline": "#cccccc"
    },
    "sizes": {
      "pagePadding": "0px",
      "groupGap": "0px",
      "groupBorderRadius": "0px",
      "widgetGap": "0px"
    }
  },
  {
    "id": "a3e3f0f53df52d39",
    "type": "ui-theme",
    "name": "Theme Name",
    "colors": {
      "surface": "#ffffff",
      "primary": "#0094ce",
      "bgPage": "#eeeeee",
      "groupBg": "#ffffff",
      "groupOutline": "#cccccc"
    },
    "sizes": {
      "pagePadding": "12px",
      "groupGap": "12px",
      "groupBorderRadius": "4px",
      "widgetGap": "12px"
    }
  },
  {
    "id": "ff55020100020001",
    "type": "modbus-client",
    "name": "Default RS485 Channel 1",
    "clienttype": "serial",
    "bufferCommands": false,
    "stateLogEnabled": false,
    "queueLogEnabled": false,
    "failureLogEnabled": true,
    "tcpHost": "127.0.0.1",
    "tcpPort": "502",
    "tcpType": "DEFAULT",
    "serialPort": "/dev/ttyAMA2",
    "serialType": "RTU",
    "serialBaudrate": "9600",
    "serialDatabits": "8",
    "serialStopbits": "1",
    "serialParity": "none",
    "serialConnectionDelay": "1000",
    "serialAsciiResponseStartDelimiter": "0x3A",
    "unit_id": "1",
    "commandDelay": "1",
    "clientTimeout": "3000",
    "reconnectOnTimeout": true,
    "reconnectTimeout": "2000",
    "parallelUnitIdsAllowed": false,
    "showErrors": false,
    "showWarnings": true,
    "showLogs": true
  },
  {
    "id": "ff55020100020002",
    "type": "modbus-client",
    "name": "Default RS485 Channel 2",
    "clienttype": "serial",
    "bufferCommands": false,
    "stateLogEnabled": false,
    "queueLogEnabled": false,
    "failureLogEnabled": true,
    "tcpHost": "127.0.0.1",
    "tcpPort": "502",
    "tcpType": "DEFAULT",
    "serialPort": "/dev/ttyAMA3",
    "serialType": "RTU",
    "serialBaudrate": "9600",
    "serialDatabits": "8",
    "serialStopbits": "1",
    "serialParity": "none",
    "serialConnectionDelay": "1000",
    "serialAsciiResponseStartDelimiter": "0x3A",
    "unit_id": "1",
    "commandDelay": "1",
    "clientTimeout": "3000",
    "reconnectOnTimeout": true,
    "reconnectTimeout": "2000",
    "parallelUnitIdsAllowed": false,
    "showErrors": false,
    "showWarnings": true,
    "showLogs": true
  },
  {
    "id": "ff55020100020003",
    "type": "modbus-client",
    "name": "Default RS485 Channel 3",
    "clienttype": "serial",
    "bufferCommands": false,
    "stateLogEnabled": false,
    "queueLogEnabled": false,
    "failureLogEnabled": true,
    "tcpHost": "127.0.0.1",
    "tcpPort": "502",
    "tcpType": "DEFAULT",
    "serialPort": "/dev/ttyAMA4",
    "serialType": "RTU",
    "serialBaudrate": "9600",
    "serialDatabits": "8",
    "serialStopbits": "1",
    "serialParity": "none",
    "serialConnectionDelay": "1000",
    "serialAsciiResponseStartDelimiter": "0x3A",
    "unit_id": "1",
    "commandDelay": "1",
    "clientTimeout": "3000",
    "reconnectOnTimeout": true,
    "reconnectTimeout": "2000",
    "parallelUnitIdsAllowed": false,
    "showErrors": false,
    "showWarnings": true,
    "showLogs": true
  },
  {
    "id": "ae209b4f406aab66",
    "type": "ui-group",
    "name": "Factor Show",
    "page": "",
    "width": "18",
    "height": "9",
    "order": 3,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "76d599e67044eeb3",
    "type": "postgreSQLConfig",
    "name": "",
    "host": "host.docker.internal",
    "hostFieldType": "str",
    "port": "5432",
    "portFieldType": "num",
    "database": "chirpstack",
    "databaseFieldType": "str",
    "ssl": "false",
    "sslFieldType": "bool",
    "applicationName": "",
    "applicationNameType": "str",
    "max": "10",
    "maxFieldType": "num",
    "idle": "1000",
    "idleFieldType": "num",
    "connectionTimeout": "10000",
    "connectionTimeoutFieldType": "num",
    "user": "chirpstack",
    "userFieldType": "str",
    "password": "chirpstack",
    "passwordFieldType": "str"
  },
  {
    "id": "97a36525813f3f9f",
    "type": "ui-theme",
    "name": "Theme Name",
    "colors": {
      "surface": "#ffffff",
      "primary": "#0094ce",
      "bgPage": "#eeeeee",
      "groupBg": "#ffffff",
      "groupOutline": "#cccccc"
    },
    "sizes": {
      "pagePadding": "0px",
      "groupGap": "0px",
      "groupBorderRadius": "0px",
      "widgetGap": "0px"
    }
  },
  {
    "id": "cd0ac6079998d71c",
    "type": "ui-group",
    "name": "  Water",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 1,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "4c42d5986c4bbb30",
    "type": "ui-group",
    "name": "Energy monitoring",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 4,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "ee7e123b644fb0fb",
    "type": "ui-group",
    "name": "Ultrasonic datalogger",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 3,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "11c7bc76871ef97a",
    "type": "ui-group",
    "name": "  Battery Status",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 2,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "d86c2124665af35b",
    "type": "ui-theme",
    "name": "Theme",
    "colors": {
      "surface": "#ffffff",
      "primary": "#0094ce",
      "bgPage": "#eeeeee",
      "groupBg": "#ffffff",
      "groupOutline": "#cccccc"
    },
    "sizes": {
      "pagePadding": "12px",
      "groupGap": "12px",
      "groupBorderRadius": "4px",
      "widgetGap": "12px"
    }
  },
  {
    "id": "aaef1ae98f9e5ac7",
    "type": "ui-group",
    "name": "ControlPart",
    "page": "",
    "width": "19",
    "height": "3",
    "order": 2,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "fa596d99836a105b",
    "type": "ui-group",
    "name": "Introduction",
    "page": "",
    "width": "19",
    "height": "1",
    "order": 1,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "7f7efa6aab86223a",
    "type": "ui-group",
    "name": "Tracking configuration",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 6,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "d2572cd2c6eedad3",
    "type": "ui-group",
    "name": "Tracking viewer",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 5,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "14ac8e16c178d0c3",
    "type": "ui-group",
    "name": "Preview and performance",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 4,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "e8de57e79e3ba00b",
    "type": "ui-group",
    "name": "Chat Group",
    "page": "",
    "width": "6",
    "height": "6",
    "order": 1,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "5c4a9eb8bcc506ec",
    "type": "ui-group",
    "name": "Geofence",
    "page": "",
    "width": "6",
    "height": "13",
    "order": 2,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "1b9a8117899e03b1",
    "type": "ui-group",
    "name": "Object Detection Alert",
    "page": "",
    "width": "6",
    "height": "2",
    "order": 2,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "6efcdf57f80c8926",
    "type": "ui-group",
    "name": "Command Group",
    "page": "",
    "width": "3",
    "height": "6",
    "order": 2,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "b3386a5606a07fc6",
    "type": "ui-group",
    "name": "Connect Camera",
    "page": "",
    "width": "6",
    "height": "2",
    "order": 1,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "32e94b3eb843c9f2",
    "type": "ui-group",
    "name": "Light Controller",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 5,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "69fbe1228561845f",
    "type": "ui-group",
    "name": "Sound Controller",
    "page": "",
    "width": "6",
    "height": "1",
    "order": 6,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "ee7258bda6d1e1eb",
    "type": "ui-group",
    "name": "Geofence Operation",
    "page": "",
    "width": "6",
    "height": "2",
    "order": 4,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "8a67b5077a1657c0",
    "type": "ui-group",
    "name": "Digital Twins",
    "page": "",
    "width": "6",
    "height": "13",
    "order": 1,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "cde4df4e1b515e62",
    "type": "ui-group",
    "name": "IP camera vision",
    "page": "",
    "width": "6",
    "height": "2",
    "order": 3,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "25b3debea13cb5c5",
    "type": "websocket-listener",
    "path": "/ws/gv2",
    "wholemsg": "false"
  },
  {
    "id": "9c029b64aec038c6",
    "type": "websocket-listener",
    "path": "/ws/gv2/tracking",
    "wholemsg": "false"
  },
  {
    "id": "server1",
    "type": "websocket-listener",
    "path": "/default/path",
    "wholemsg": "false"
  },
  {
    "id": "77ed695e80c70135",
    "type": "ui-group",
    "name": "Onboard a new face",
    "page": "",
    "width": "12",
    "height": "8",
    "order": 1,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "995fd82ffba178d6",
    "type": "ui-group",
    "name": "Recognize Identity",
    "page": "",
    "width": "12",
    "height": "8",
    "order": 2,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "245bf6e70a132eaa",
    "type": "ui-group",
    "name": "My Group",
    "page": "",
    "width": "6",
    "height": "2",
    "order": 3,
    "showTitle": false,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "e23de7dd4ba7d6aa",
    "type": "ui-group",
    "name": "Onboarded Identity List",
    "page": "",
    "width": "12",
    "height": "6",
    "order": 3,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "cfe2a3efe5d958ce",
    "type": "ui-group",
    "name": "My Group",
    "page": "",
    "width": "12",
    "height": "6",
    "order": 4,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "503075ef63e60cf5",
    "type": "ui-group",
    "name": "Message",
    "page": "",
    "width": "4",
    "height": "11",
    "order": 2,
    "showTitle": true,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "53707ce4f54749e1",
    "type": "ui-group",
    "name": "7in1",
    "page": "f3700c18c351beca",
    "width": "12",
    "height": "6",
    "order": 5,
    "showTitle": true,
    "className": "in1",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "5290c3946218970d",
    "type": "ui-group",
    "name": "Hazard Response Command Center",
    "page": "f3700c18c351beca",
    "width": "4",
    "height": "6",
    "order": 2,
    "showTitle": true,
    "className": "map-box",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "04cddd622489bf0a",
    "type": "ui-group",
    "name": "Meshtastic Commander",
    "page": "f3700c18c351beca",
    "width": "3",
    "height": "6",
    "order": 4,
    "showTitle": true,
    "className": "message-box map-box",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "ee9ef85c506ffeea",
    "type": "ui-group",
    "name": "Action Status",
    "page": "f3700c18c351beca",
    "width": "2",
    "height": "6",
    "order": 1,
    "showTitle": true,
    "className": "map-box status-panel",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "f3700c18c351beca",
    "type": "ui-page",
    "name": "Hazard Response Command Center",
    "ui": "2a6c6f3f0d1de049",
    "path": "/hrcc",
    "icon": "home",
    "layout": "grid",
    "theme": "bf7959673d8303c0",
    "order": 1,
    "className": "",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "c428312d1f6165d1",
    "type": "mqtt-broker",
    "name": "mqtt",
    "broker": "127.0.0.1",
    "port": "1883",
    "clientid": "",
    "autoConnect": true,
    "usetls": false,
    "protocolVersion": "4",
    "keepalive": "60",
    "cleansession": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthPayload": "",
    "birthMsg": {},
    "closeTopic": "",
    "closeQos": "0",
    "closePayload": "",
    "closeMsg": {},
    "willTopic": "",
    "willQos": "0",
    "willPayload": "",
    "willMsg": {},
    "sessionExpiry": ""
  },
  {
    "id": "8824dea1.83e31",
    "type": "websocket-client",
    "path": "ws://localhost:9898/",
    "tls": "",
    "wholemsg": "false"
  },
  {
    "id": "fdc1fcb5b637d024",
    "type": "ui-group",
    "name": "",
    "page": "f3700c18c351beca",
    "width": "3",
    "height": "6",
    "order": 3,
    "showTitle": true,
    "className": "map-box",
    "visible": "true",
    "disabled": "false"
  },
  {
    "id": "ff55020100010001",
    "type": "mqtt-broker",
    "name": "Default MQTT Broker",
    "broker": "host.docker.internal",
    "port": "1883",
    "clientid": "",
    "autoConnect": true,
    "usetls": false,
    "protocolVersion": "4",
    "keepalive": "",
    "cleansession": true,
    "autoUnsubscribe": true,
    "birthTopic": "",
    "birthQos": "0",
    "birthRetain": "false",
    "birthPayload": "",
    "birthMsg": {},
    "closeTopic": "",
    "closeQos": "0",
    "closeRetain": "false",
    "closePayload": "",
    "closeMsg": {},
    "willTopic": "",
    "willQos": "0",
    "willRetain": "false",
    "willPayload": "",
    "willMsg": {},
    "userProps": "",
    "sessionExpiry": "",
    "info": "This is the default MQTT Server configuration in the Mission Pack, please do not remove or change it"
  },
  {
    "id": "8e4db328f42c4974",
    "type": "function",
    "z": "f11a6acbc82d2c5c",
    "name": "7-in-1 weather station",
    "func": "var temperature = {\n    payload: Math.random() * 40,\n    topic: \"temperature\"\n};\n\nvar humidity = {\n    payload: Math.random() * 100,\n    topic: \"humidity\"\n};\n\nvar windSpeed = {\n    payload: Math.random() * 20,\n    topic: \"windSpeed\"\n};\n\nvar precipitation = {\n    payload: Math.random() * 50,\n    topic: \"precipitation\"\n};\n\nvar vegetationDensity = {\n    payload: Math.random() * 100,\n    topic: \"vegetationDensity\"\n};\n\nvar fuelMoisture = {\n    payload: Math.random() * 100,\n    topic: \"fuelMoisture\"\n};\n\nvar soilMoisture = {\n    payload: Math.random() * 100,\n    topic: \"soilMoisture\"\n};\n\nvar total = {\n    payload: {\n        temperature: temperature.payload,\n        humidity: humidity.payload,\n        windSpeed: windSpeed.payload,\n        precipitation: precipitation.payload,\n        vegetationDensity: vegetationDensity.payload,\n        fuelMoisture: fuelMoisture.payload,\n        soilMoisture: soilMoisture.payload\n    },\n    topic: \"total\"\n};\n\nreturn [temperature, humidity, windSpeed, precipitation, vegetationDensity, fuelMoisture, soilMoisture, total];\n",
    "outputs": 8,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 360,
    "y": 120,
    "wires": [
      [
        "d13ad91ac508db4c"
      ],
      [
        "772715fb0b63dd2a"
      ],
      [
        "7e23227f9b76321f"
      ],
      [
        "55b9f3c6aa5baa15"
      ],
      [
        "6fcd9713b7a0c408"
      ],
      [
        "16cac78624bc6e83"
      ],
      [
        "20cd1089729f666f"
      ],
      [
        "c2437ef708dab502"
      ]
    ]
  },
  {
    "id": "c7d6a465aad48164",
    "type": "inject",
    "z": "f11a6acbc82d2c5c",
    "name": "onstartup",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "5",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 150,
    "y": 120,
    "wires": [
      [
        "8e4db328f42c4974"
      ]
    ]
  },
  {
    "id": "d13ad91ac508db4c",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "temperature",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 80,
    "wires": [
      [
        "3a6ab4a46c5c856e"
      ]
    ]
  },
  {
    "id": "772715fb0b63dd2a",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "humidity",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 120,
    "wires": [
      [
        "6b6a9690a8786b72"
      ]
    ]
  },
  {
    "id": "7e23227f9b76321f",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "windSpeed",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 160,
    "wires": [
      [
        "c72f1d53fa0877e1"
      ]
    ]
  },
  {
    "id": "55b9f3c6aa5baa15",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "precipitation",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 200,
    "wires": [
      [
        "833587c680aa5057"
      ]
    ]
  },
  {
    "id": "6fcd9713b7a0c408",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "vegetationDensity",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 240,
    "wires": [
      [
        "bc4740acb653759e"
      ]
    ]
  },
  {
    "id": "16cac78624bc6e83",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "fuelMoisture",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 280,
    "wires": [
      [
        "342c90344efb042a"
      ]
    ]
  },
  {
    "id": "20cd1089729f666f",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "soilMoisture",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 320,
    "wires": [
      [
        "f43224200031aa54"
      ]
    ]
  },
  {
    "id": "3a6ab4a46c5c856e",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "temperature",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 80,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "6b6a9690a8786b72",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "humidity",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 120,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "c72f1d53fa0877e1",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "windSpeed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 160,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "833587c680aa5057",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "precipitation",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 200,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "bc4740acb653759e",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "vegetationDensity",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 240,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "342c90344efb042a",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "fuelMoisture",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 280,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "f43224200031aa54",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "soilMoisture",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 320,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "9c84a20fd70247b6",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "to 2 decimal places",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$round(payload * 100) / 100",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1050,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "c2437ef708dab502",
    "type": "function",
    "z": "f11a6acbc82d2c5c",
    "name": "compute fire factor",
    "func": "var data = msg.payload;\nvar fireRisk = (data.temperature * 0.4 + data.humidity * 0.2 + data.windSpeed * 0.3 + data.precipitation * 0.1);\n msg.payload = fireRisk;\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 430,
    "y": 360,
    "wires": [
      [
        "28d356b875a141bc"
      ]
    ]
  },
  {
    "id": "28d356b875a141bc",
    "type": "switch",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "property": "fireRisk",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 360,
    "wires": [
      [
        "7a2d00bd3764599c"
      ]
    ]
  },
  {
    "id": "7a2d00bd3764599c",
    "type": "change",
    "z": "f11a6acbc82d2c5c",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "fireRisk",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 780,
    "y": 360,
    "wires": [
      [
        "9c84a20fd70247b6"
      ]
    ]
  },
  {
    "id": "f2e7e8a6abfabf27",
    "type": "ui-template",
    "z": "c64ffede4f1f69bd",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "Digital Twin UI - Background",
    "order": 3,
    "width": "${Width}",
    "height": "${Height}",
    "head": "",
    "format": "<template>\n  <div class=\"bg-585562\">\n    <img class=\"bg-585562\" :src=\"processedUrl\" />\n  </div>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        processedUrl: ''\n      }\n    },\n    created() {\n      this.processImageUrl();\n    },\n    watch: {\n      msg: function() {\n        // Watch for changes in msg and reprocess the image URL when it changes\n        this.processImageUrl();\n      }\n    },\n    methods: {\n      processImageUrl() {\n        // Get the current dashboard domain and port\n        const currentDomain = window.location.hostname;\n\n        // Get the original image URL from msg.payload\n        const originalUrl = this.msg?.payload;\n\n        if (originalUrl) {\n          try {\n            const url = new URL(originalUrl);\n\n            // Check and replace the IP part of the URL while retaining the port\n            if (url.hostname === '192.168.100.10' && url.port === '8092') {\n              url.hostname = currentDomain;\n              this.processedUrl = url.toString();\n            } else {\n              this.processedUrl = originalUrl;\n            }\n          } catch (e) {\n            // Log any errors encountered during URL processing\n            console.error('Error processing URL:', e);\n            this.processedUrl = originalUrl;\n          }\n        } else {\n          // Log a message if msg.payload is null or undefined\n          console.error('msg.payload is null or undefined');\n        }\n      }\n    }\n  }\n</script>\n\n<style>\n/* Define any styles here - supports raw CSS */\n.bg-585562 {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.bg-585562 img.bg-585562 {\n  height: 100%;\n  width: 100%;\n  object-fit: cover;\n}\n</style>\n",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 1540,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "9d2dbc8c74d1df4b",
    "type": "ui-template",
    "z": "c64ffede4f1f69bd",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "Digital Twin UI - Container",
    "order": 0,
    "width": "${Width}",
    "height": "${Height}",
    "head": "",
    "format": "<template>\n    <div class=\"box\">\n        \n    </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n            }\n        },\n    }\n</script>\n<style>\n    .box{\n        position: relative;\n        margin: 10px;\n        width: 100%;\n        height: 100%;\n    }\n</style>",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 1090,
    "y": 140,
    "wires": [
      [
        "f2e7e8a6abfabf27"
      ]
    ]
  },
  {
    "id": "6bfa48f56105ef16",
    "type": "inject",
    "z": "c64ffede4f1f69bd",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "x": 110,
    "y": 220,
    "wires": [
      [
        "9b6e3ab7a7f2929f",
        "13880e52c8665520"
      ]
    ]
  },
  {
    "id": "efd7c095acb08799",
    "type": "file in",
    "z": "c64ffede4f1f69bd",
    "name": "read image",
    "filename": "payload",
    "filenameType": "msg",
    "format": "",
    "chunk": false,
    "sendError": false,
    "encoding": "base64",
    "allProps": false,
    "x": 770,
    "y": 300,
    "wires": [
      [
        "01020db6ba1607be"
      ]
    ]
  },
  {
    "id": "01020db6ba1607be",
    "type": "function",
    "z": "c64ffede4f1f69bd",
    "name": "encode image",
    "func": "msg.payload = \"data:image/jpeg;base64,\" + msg.payload.toString('base64');\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 940,
    "y": 300,
    "wires": [
      [
        "f2e7e8a6abfabf27"
      ]
    ]
  },
  {
    "id": "95e2ca8e72c0c25a",
    "type": "change",
    "z": "c64ffede4f1f69bd",
    "name": "get imagepath from envs",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "imagePath",
        "tot": "env",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 550,
    "y": 100,
    "wires": [
      [
        "f2e7e8a6abfabf27"
      ]
    ]
  },
  {
    "id": "9b6e3ab7a7f2929f",
    "type": "switch",
    "z": "c64ffede4f1f69bd",
    "name": "",
    "property": "imageSelector",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "url",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "file",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 330,
    "y": 220,
    "wires": [
      [
        "95e2ca8e72c0c25a"
      ],
      [
        "d25e6135eedfa7a2"
      ]
    ]
  },
  {
    "id": "d25e6135eedfa7a2",
    "type": "change",
    "z": "c64ffede4f1f69bd",
    "name": "get imagepath from envs",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "imagePath",
        "tot": "env"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 550,
    "y": 300,
    "wires": [
      [
        "efd7c095acb08799"
      ]
    ]
  },
  {
    "id": "13880e52c8665520",
    "type": "change",
    "z": "c64ffede4f1f69bd",
    "name": "set empty on startup",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 380,
    "y": 40,
    "wires": [
      [
        "f2e7e8a6abfabf27"
      ]
    ]
  },
  {
    "id": "dcdfb77142edf9f9",
    "type": "ui-template",
    "z": "c25ee8e3cadf74f6",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "UI Template",
    "order": 4,
    "width": "1",
    "height": "1",
    "head": "",
    "format": "<template>\n  <div\n    class=\"item-881695\"\n    :style=\"\n      'left:' +\n      msg.payload.position[0] +\n      ';top:' +\n      msg.payload.position[1] +\n      ';'\n    \"\n  >\n    <div>{{ msg.payload.name }}</div>\n    <div :style=\"'font-size:' + msg.payload.fontSize * 2 + 'px !important;'\">\n      {{ msg.payload.value }} {{msg.payload.unit}}\n    </div>\n    <div :style=\"'font-size:' + msg.payload.fontSize * 0.8 + 'px !important;'\">\n      {{ timeFn(msg.payload.time) }}\n    </div>\n    <div :style=\"'font-size:' + msg.payload.fontSize * 0.8 + 'px !important;'\">\n      {{ msg.payload.time === 0 ? '..' : '' }}\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {};\n  },\n  created() {},\n\n  methods: {\n    /**\n     * @description 10位时间戳转换\n     * @param time\n     * @returns {string}\n     */\n    tenBitTimestamp(time, type) {\n      const date = new Date(time * 1000);\n      const y = date.getFullYear();\n      let m = date.getMonth() + 1;\n      m = m < 10 ? \"0\" + m : m;\n      let d = date.getDate();\n      d = d < 10 ? \"0\" + d : d;\n      let h = date.getHours();\n      h = h < 10 ? \"0\" + h : h;\n      let minute = date.getMinutes();\n      let second = date.getSeconds();\n      minute = minute < 10 ? \"0\" + minute : minute;\n      second = second < 10 ? \"0\" + second : second;\n      return type\n        ? y + \"/\" + m + \"/\" + d\n        : y + \"/\" + m + \"/\" + d + \" \" + h + \":\" + minute + \":\" + second; //组合\n    },\n\n    /**\n     * @description 13位时间戳转换\n     * @param time\n     * @returns {string}\n     */\n    thirteenBitTimestamp(time, type) {\n      const date = new Date(time / 1);\n      const y = date.getFullYear();\n      let m = date.getMonth() + 1;\n      m = m < 10 ? \"0\" + m : m;\n      let d = date.getDate();\n      d = d < 10 ? \"0\" + d : d;\n      let h = date.getHours();\n      h = h < 10 ? \"0\" + h : h;\n      let minute = date.getMinutes();\n      let second = date.getSeconds();\n      minute = minute < 10 ? \"0\" + minute : minute;\n      second = second < 10 ? \"0\" + second : second;\n      return type\n        ? y + \"/\" + m + \"/\" + d\n        : y + \"/\" + m + \"/\" + d + \" \" + h + \":\" + minute + \":\" + second; //组合\n    },\n\n    timeFn(time, type) {\n      if (time === 0) {\n        return \"--\";\n      }\n      time = time + \"\";\n      let timestamp;\n      if (time.length == 10) timestamp = this.tenBitTimestamp(time, type);\n      else if (time.length == 13)\n        timestamp = this.thirteenBitTimestamp(time, type);\n      else return (timestamp = \"\");\n      let timezone = timestamp\n        ? parseInt((0 - new Date(timestamp).getTimezoneOffset()) / 60)\n        : \"\";\n      timezone = timezone\n        ? (timezone > 0 ? \"(UTC+\" : \"(UTC\") + timezone + \")\"\n        : \"\";\n      return type ? timestamp : timestamp + timezone;\n    },\n  },\n};\n</script>\n\n<style>\n.item-881695 {\n  width: 170px;\n  height: auto;\n  position: absolute;\n  z-index: 1;\n  background: rgba(255, 255, 255, 0.8);\n  padding: 20px;\n  border-radius: 10px;\n  font-weight: bold;\n}\n</style>\n",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 1410,
    "y": 520,
    "wires": [
      []
    ]
  },
  {
    "id": "3b56b93f6cf23646",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set font size",
    "func": "msg.payload = {\n    ...msg.payload,\n    fontSize: env.get(\"card_font_size\")\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1030,
    "y": 520,
    "wires": [
      [
        "3f1983a07bacaa61"
      ]
    ]
  },
  {
    "id": "eb2b84e989af7418",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set name",
    "func": "msg.payload = {\n    ...msg.payload,\n    name: env.get(\"card_name\")\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 680,
    "y": 520,
    "wires": [
      [
        "afa26713358dce1e"
      ]
    ]
  },
  {
    "id": "afa26713358dce1e",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set position",
    "func": "msg.payload = {\n    ...msg.payload,\n    position: [\n        env.get(\"card_position_x\"), \n        env.get(\"card_position_y\")\n    ]\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 850,
    "y": 520,
    "wires": [
      [
        "3b56b93f6cf23646"
      ]
    ]
  },
  {
    "id": "3f1983a07bacaa61",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set unit",
    "func": "msg.payload = {\n    ...msg.payload,\n    unit: env.get(\"card_unit\")\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1200,
    "y": 520,
    "wires": [
      [
        "dcdfb77142edf9f9"
      ]
    ]
  },
  {
    "id": "81111372d49074cf",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set value and time",
    "func": "msg.payload = {\n    value: msg.payload,\n    time: '' + Date.now()\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 470,
    "y": 520,
    "wires": [
      [
        "eb2b84e989af7418"
      ]
    ]
  },
  {
    "id": "74162ccbd520f320",
    "type": "inject",
    "z": "c25ee8e3cadf74f6",
    "name": "On Startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0.1",
    "topic": "",
    "x": 250,
    "y": 420,
    "wires": [
      [
        "e75d38e7f7e2418c",
        "ed8749cbb76eaff3"
      ]
    ]
  },
  {
    "id": "e75d38e7f7e2418c",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "set value and time",
    "func": "msg.payload = {\n    value: '--',\n    time: 0\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 470,
    "y": 420,
    "wires": [
      [
        "eb2b84e989af7418"
      ]
    ]
  },
  {
    "id": "270964d67cd7e5ca",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "Show 'Lastest value'",
    "func": "return {\n    payload: 'Last value: ' + msg.payload\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "ed8749cbb76eaff3",
    "type": "function",
    "z": "c25ee8e3cadf74f6",
    "name": "Show 'Waiting to update value'",
    "func": "return {\n    payload: {\n        fill: \"yellow\",\n        shape: \"dot\",\n        text: 'Waiting to update value'\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 490,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "ca580e1444a51d82",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "e17956ebf8df1058",
    "name": "Basic mqtt publish",
    "info": "",
    "x": 930,
    "y": 520,
    "wires": []
  },
  {
    "id": "4813977826279959",
    "type": "link out",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "pub",
    "mode": "link",
    "links": [
      "b64fe8d75146fa69"
    ],
    "x": 1870,
    "y": 380,
    "wires": [],
    "l": true
  },
  {
    "id": "9abc04b2e7d3257a",
    "type": "link out",
    "z": "1766c4cb75850c2c",
    "g": "977b1c156a278f35",
    "name": "pub",
    "mode": "link",
    "links": [
      "b64fe8d75146fa69"
    ],
    "x": 1510,
    "y": 120,
    "wires": [],
    "l": true
  },
  {
    "id": "b64fe8d75146fa69",
    "type": "link in",
    "z": "1766c4cb75850c2c",
    "g": "e17956ebf8df1058",
    "name": "pub",
    "links": [
      "1567eeb1bb47fec5",
      "4813977826279959",
      "9abc04b2e7d3257a"
    ],
    "x": 910,
    "y": 580,
    "wires": [
      [
        "c0843f7df37d8e49"
      ]
    ],
    "l": true
  },
  {
    "id": "1567eeb1bb47fec5",
    "type": "link out",
    "z": "1766c4cb75850c2c",
    "g": "b36553531342820f",
    "name": "pub",
    "mode": "link",
    "links": [
      "b64fe8d75146fa69"
    ],
    "x": 690,
    "y": 580,
    "wires": [],
    "l": true
  },
  {
    "id": "c0843f7df37d8e49",
    "type": "mqtt out",
    "z": "1766c4cb75850c2c",
    "g": "e17956ebf8df1058",
    "name": "mqtt out",
    "topic": "",
    "qos": "0",
    "retain": "false",
    "respTopic": "",
    "contentType": "",
    "userProps": "",
    "correl": "",
    "expiry": "",
    "broker": "${mqtt-broker}",
    "x": 1040,
    "y": 580,
    "wires": []
  },
  {
    "id": "d1f974398f147b02",
    "type": "link out",
    "z": "1766c4cb75850c2c",
    "g": "b36553531342820f",
    "name": "sub/unsub",
    "mode": "link",
    "links": [
      "86d3046f1847f777"
    ],
    "x": 710,
    "y": 640,
    "wires": [],
    "l": true
  },
  {
    "id": "86d3046f1847f777",
    "type": "link in",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "sub/unsub",
    "links": [
      "b9be4eadde0d5464",
      "d1f974398f147b02"
    ],
    "x": 400,
    "y": 800,
    "wires": [
      [
        "6f49bb85fb1ca9dd"
      ]
    ],
    "l": true
  },
  {
    "id": "b9be4eadde0d5464",
    "type": "link out",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "sub/unsub",
    "mode": "link",
    "links": [
      "86d3046f1847f777"
    ],
    "x": 1850,
    "y": 260,
    "wires": [],
    "l": true
  },
  {
    "id": "1a9a58a193b6a274",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "Received data",
    "info": "",
    "x": 370,
    "y": 740,
    "wires": []
  },
  {
    "id": "45f2f20fc1a0b77f",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "8e5fb88de994075b",
    "name": "check camera id, to flow.camera_id",
    "info": "",
    "x": 460,
    "y": 300,
    "wires": []
  },
  {
    "id": "195c561cb96ad7cb",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "d821d39182a45218",
    "name": "Handle start",
    "info": "",
    "x": 370,
    "y": 220,
    "wires": []
  },
  {
    "id": "1fec46e9cd347a2a",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "b36553531342820f",
    "name": "Handle stop",
    "info": "",
    "x": 370,
    "y": 520,
    "wires": []
  },
  {
    "id": "46ee7c72c6d678a2",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "b36553531342820f",
    "name": "Unsubscribe Action Builder",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "mqtt_tx",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "action",
        "pt": "msg",
        "to": "unsubscribe",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 420,
    "y": 640,
    "wires": [
      [
        "d1f974398f147b02"
      ]
    ]
  },
  {
    "id": "6b25c7462632d304",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "send a start command to camera",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "mqtt_rx",
        "tot": "flow",
        "dc": true
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "[65,84,43,73,78,86,79,75,69,61,45,49,44,48,44,48,13,10]",
        "tot": "bin"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1660,
    "y": 380,
    "wires": [
      [
        "4813977826279959"
      ]
    ]
  },
  {
    "id": "e5470b0dea4188f0",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "override mqtt_tx and mqtt_rx",
    "rules": [
      {
        "t": "set",
        "p": "mqtt_tx",
        "pt": "flow",
        "to": "\"sscma/v0/\" & payload & \"/tx\"",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "mqtt_rx",
        "pt": "flow",
        "to": "\"sscma/v0/\" & payload & \"/rx\"",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1360,
    "y": 340,
    "wires": [
      [
        "27dc0363dfd2c60d",
        "6b25c7462632d304"
      ]
    ]
  },
  {
    "id": "1ed7a698814e5190",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "8e5fb88de994075b",
    "name": "set flow.camera_id",
    "rules": [
      {
        "t": "set",
        "p": "camera_id",
        "pt": "flow",
        "to": "cameraId",
        "tot": "env",
        "dc": true
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "cameraId",
        "tot": "env",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 710,
    "y": 340,
    "wires": [
      [
        "3ea0d24d5a357d8c"
      ]
    ]
  },
  {
    "id": "4712b34643952b3c",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "8e5fb88de994075b",
    "name": "set flow.camera_id",
    "rules": [
      {
        "t": "set",
        "p": "camera_id",
        "pt": "flow",
        "to": "topic",
        "tot": "msg",
        "dc": true
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "topic",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 710,
    "y": 380,
    "wires": [
      [
        "3ea0d24d5a357d8c"
      ]
    ]
  },
  {
    "id": "b97841458d677cf9",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "g": "8e5fb88de994075b",
    "name": "whether cameraId is set in env",
    "property": "cameraId",
    "propertyType": "env",
    "rules": [
      {
        "t": "nempty"
      },
      {
        "t": "empty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 450,
    "y": 360,
    "wires": [
      [
        "1ed7a698814e5190"
      ],
      [
        "4712b34643952b3c"
      ]
    ]
  },
  {
    "id": "7712b011fe04d5e2",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "Check image is valid",
    "property": "payload.length",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gte",
        "v": "100",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1280,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "a3d2cf36d30ad3a8",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "get inference result",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.data.boxes",
        "tot": "msg",
        "dc": true
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "raw",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 800,
    "wires": [
      [
        "ce2e532308aa4012"
      ]
    ],
    "info": "[[118,150,237,175,100,0],[114,119,76,84,100,2]]"
  },
  {
    "id": "5c869b5a19000f23",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "get image",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "payload.data.image",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "raw",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1080,
    "y": 740,
    "wires": [
      [
        "7712b011fe04d5e2"
      ]
    ]
  },
  {
    "id": "7fff0e065d651496",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "g": "977b1c156a278f35",
    "name": "reconnect logic",
    "info": "",
    "x": 380,
    "y": 60,
    "wires": []
  },
  {
    "id": "03a1c725d65f15e2",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "g": "977b1c156a278f35",
    "name": "Confirm that the camera is currently expected to be connected",
    "property": "mqtt_rx",
    "propertyType": "flow",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 850,
    "y": 120,
    "wires": [
      [
        "c6651882a2276fc2"
      ]
    ]
  },
  {
    "id": "c6651882a2276fc2",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "977b1c156a278f35",
    "name": "send a start command to camera",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "mqtt_rx",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "[65,84,43,73,78,86,79,75,69,61,45,49,44,48,44,48,13,10]",
        "tot": "bin"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1280,
    "y": 120,
    "wires": [
      [
        "9abc04b2e7d3257a"
      ]
    ]
  },
  {
    "id": "82a43b334bf4b932",
    "type": "inject",
    "z": "1766c4cb75850c2c",
    "g": "977b1c156a278f35",
    "name": "auto resend command",
    "props": [
      {
        "p": "payload"
      }
    ],
    "repeat": "3",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 450,
    "y": 120,
    "wires": [
      [
        "03a1c725d65f15e2"
      ]
    ]
  },
  {
    "id": "a78007c93b1c1fe1",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "b36553531342820f",
    "name": "send a stop command to camera",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "mqtt_rx",
        "tot": "flow",
        "dc": true
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "[65,84,43,66,82,69,65,75,13,10]",
        "tot": "bin"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 440,
    "y": 580,
    "wires": [
      [
        "1567eeb1bb47fec5"
      ]
    ]
  },
  {
    "id": "2a5b878f4609d83d",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "Check msg is valid",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 830,
    "y": 800,
    "wires": [
      [
        "5c869b5a19000f23",
        "a3d2cf36d30ad3a8",
        "76719286957aa942"
      ]
    ]
  },
  {
    "id": "3ea0d24d5a357d8c",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "8e5fb88de994075b",
    "name": "Retrieve Input",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "camera_id",
        "tot": "flow",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 360,
    "wires": [
      [
        "1a1aac49baec583b",
        "37a4169a796bc409"
      ]
    ]
  },
  {
    "id": "6f49bb85fb1ca9dd",
    "type": "mqtt in",
    "z": "1766c4cb75850c2c",
    "g": "4812ceb994ecee47",
    "name": "when receive data",
    "topic": "",
    "qos": "2",
    "datatype": "auto-detect",
    "broker": "${mqtt-broker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 1,
    "x": 590,
    "y": 800,
    "wires": [
      [
        "2a5b878f4609d83d"
      ]
    ]
  },
  {
    "id": "27dc0363dfd2c60d",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "subscribe Action Builder",
    "rules": [
      {
        "t": "set",
        "p": "action",
        "pt": "msg",
        "to": "subscribe",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "{}",
        "tot": "json"
      },
      {
        "t": "set",
        "p": "topic.topic",
        "pt": "msg",
        "to": "\"sscma/v0/\" & payload & \"/tx\"",
        "tot": "jsonata"
      },
      {
        "t": "set",
        "p": "topic.qos",
        "pt": "msg",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1630,
    "y": 340,
    "wires": [
      [
        "b9be4eadde0d5464"
      ]
    ]
  },
  {
    "id": "1a1aac49baec583b",
    "type": "delay",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "delay 0.2s",
    "pauseType": "delay",
    "timeout": "200",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1130,
    "y": 360,
    "wires": [
      [
        "e5470b0dea4188f0"
      ]
    ]
  },
  {
    "id": "37a4169a796bc409",
    "type": "change",
    "z": "1766c4cb75850c2c",
    "g": "a8dfe50e821dfd0b",
    "name": "Unsubscribe Action Builder",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "mqtt_tx",
        "tot": "flow"
      },
      {
        "t": "set",
        "p": "action",
        "pt": "msg",
        "to": "unsubscribe",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1360,
    "y": 260,
    "wires": [
      [
        "b9be4eadde0d5464"
      ]
    ]
  },
  {
    "id": "cc53c77934293557",
    "type": "status",
    "z": "1766c4cb75850c2c",
    "name": "",
    "scope": null,
    "x": 1450,
    "y": 1060,
    "wires": [
      []
    ]
  },
  {
    "id": "6961ad7433fb3c65",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "name": "image buffer",
    "info": "",
    "x": 1670,
    "y": 700,
    "wires": []
  },
  {
    "id": "aef67c51ff6af9a3",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "name": "inference result",
    "info": "",
    "x": 1680,
    "y": 800,
    "wires": []
  },
  {
    "id": "17bdb18a27c66e11",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "name": "start or stop",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "start",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "stop",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 150,
    "y": 360,
    "wires": [
      [
        "b97841458d677cf9"
      ],
      [
        "a78007c93b1c1fe1",
        "46ee7c72c6d678a2"
      ]
    ]
  },
  {
    "id": "a89d1fafc072f198",
    "type": "comment",
    "z": "1766c4cb75850c2c",
    "name": "original data",
    "info": "",
    "x": 1670,
    "y": 960,
    "wires": []
  },
  {
    "id": "ce2e532308aa4012",
    "type": "function",
    "z": "1766c4cb75850c2c",
    "name": "Check if the target is detected",
    "func": "if (Array.isArray(msg.payload)) {\n    var length = msg.payload.length;\n    if (length > 1) {\n        msg.payload = 1;\n    } else if (length === 0) {\n        msg.payload = 0;\n    } else {\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = 0;\n}\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1390,
    "y": 1240,
    "wires": [
      [
        "963a647e7b951cba"
      ]
    ]
  },
  {
    "id": "963a647e7b951cba",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "name": "yes or no",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1620,
    "y": 1240,
    "wires": [
      [
        "e4db2d42d0a9aab5"
      ],
      [
        "3d8473d039795dd6"
      ]
    ]
  },
  {
    "id": "e4db2d42d0a9aab5",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "name": "",
    "property": "triggerMode",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "yes",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1750,
    "y": 1200,
    "wires": [
      []
    ]
  },
  {
    "id": "3d8473d039795dd6",
    "type": "switch",
    "z": "1766c4cb75850c2c",
    "name": "",
    "property": "triggerMode",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "no",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1750,
    "y": 1280,
    "wires": [
      []
    ]
  },
  {
    "id": "76719286957aa942",
    "type": "msg-speed",
    "z": "1766c4cb75850c2c",
    "name": "",
    "frequency": "sec",
    "interval": 1,
    "estimation": false,
    "ignore": false,
    "pauseAtStartup": false,
    "topicDependent": false,
    "x": 1310,
    "y": 1000,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "f8c167e299ad5d74",
    "type": "rtsp2mjpeg",
    "z": "cca203ebc25b2ce6",
    "url": "${url}",
    "username": "${username}",
    "password": "${passowrd}",
    "rate": "1",
    "quality": "1",
    "resolution": "${resolution}",
    "x": 210,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "96a1b615dbe08457",
    "type": "status",
    "z": "cca203ebc25b2ce6",
    "name": "",
    "scope": null,
    "x": 190,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "ec19f33ceb5af3e5",
    "type": "catch",
    "z": "cca203ebc25b2ce6",
    "name": "",
    "scope": [
      "f8c167e299ad5d74"
    ],
    "uncaught": false,
    "x": 200,
    "y": 240,
    "wires": [
      [
        "9b1eb01ff5f01c5b"
      ]
    ]
  },
  {
    "id": "9b1eb01ff5f01c5b",
    "type": "debug",
    "z": "cca203ebc25b2ce6",
    "name": "debug 5",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 400,
    "y": 220,
    "wires": []
  },
  {
    "id": "ddb4e6e006510608",
    "type": "mqtt in",
    "z": "fdfd26c77e5e2a42",
    "name": "subscribe mqtt, and receive message",
    "topic": "",
    "qos": "0",
    "datatype": "auto-detect",
    "broker": "${mqttBroker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 1,
    "x": 690,
    "y": 60,
    "wires": [
      [
        "3a8cef5012cb76cd",
        "c3ca0d27c2ea2c12"
      ]
    ]
  },
  {
    "id": "statusNode",
    "type": "status",
    "z": "fdfd26c77e5e2a42",
    "name": "",
    "scope": [
      "ddb4e6e006510608"
    ],
    "x": 1870,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "d39494835463c35e",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "name": "build subscribe topic command",
    "func": "var applicationId = env.get(\"applicationId\");\nvar deviceId = env.get(\"deviceId\");\n\nif (!applicationId) {\n    applicationId = env.get(\"SENSECRAFT_MISSION_PACK_CHIRPSTACK_APPID\");\n}\n\nif (!deviceId) {\n    deviceId = env.get(\"SENSECRAFT_MISSION_PACK_DEVICE_TRIPWIRE_DEVEUI\")\n}\n\nmsg.action = 'subscribe'\nmsg.topic = {\n    topic: `application/${applicationId}/device/${deviceId}/event/up`,\n    qos: 0\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 370,
    "y": 60,
    "wires": [
      [
        "ddb4e6e006510608"
      ]
    ]
  },
  {
    "id": "8b3e99e06e13cf85",
    "type": "inject",
    "z": "fdfd26c77e5e2a42",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "x": 130,
    "y": 60,
    "wires": [
      [
        "d39494835463c35e"
      ]
    ]
  },
  {
    "id": "b9d1463ac16b48f1",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "d": true,
    "name": "decode tripwire message",
    "func": "var value = parseInt(msg.payload.object.messages[0][0].measurementValue);\n\nmsg.payload = value;\nmsg.sensecraft = {}\nmsg.sensecraft.fromType = \"Device\"\nmsg.sensecraft.valueMeaning = \"ChangeValue\"\nmsg.sensecraft.valuetype = \"Number\"\nmsg.sensecraft.expectInputType = [\"Condition\"]\n\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1190,
    "y": 60,
    "wires": [
      [
        "5da5f4ea1905df1e",
        "9a0531c77d01eb12"
      ]
    ]
  },
  {
    "id": "3a8cef5012cb76cd",
    "type": "change",
    "z": "fdfd26c77e5e2a42",
    "d": true,
    "name": "",
    "rules": [
      {
        "t": "delete",
        "p": "topic",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 60,
    "wires": [
      [
        "b9d1463ac16b48f1"
      ]
    ]
  },
  {
    "id": "5da5f4ea1905df1e",
    "type": "switch",
    "z": "fdfd26c77e5e2a42",
    "name": "if value=0, then",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1500,
    "y": 40,
    "wires": [
      [
        "a46a241a689227b4"
      ]
    ]
  },
  {
    "id": "9a0531c77d01eb12",
    "type": "switch",
    "z": "fdfd26c77e5e2a42",
    "name": "if value=1, then",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1500,
    "y": 80,
    "wires": [
      [
        "9d635b7355433cc1"
      ]
    ]
  },
  {
    "id": "a46a241a689227b4",
    "type": "template",
    "z": "fdfd26c77e5e2a42",
    "name": "whenFalseOutput",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{env.whenFalseOutput}}",
    "output": "str",
    "x": 1690,
    "y": 40,
    "wires": [
      [
        "fbb4b0a21824b98f"
      ]
    ]
  },
  {
    "id": "9d635b7355433cc1",
    "type": "template",
    "z": "fdfd26c77e5e2a42",
    "name": "whenTrueOutput",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{env.whenTrueOutput}}",
    "output": "str",
    "x": 1690,
    "y": 80,
    "wires": [
      [
        "fbb4b0a21824b98f"
      ]
    ]
  },
  {
    "id": "fbb4b0a21824b98f",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "name": "all in one",
    "func": "\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1880,
    "y": 60,
    "wires": [
      [
        "d6f6d0ab45a73962"
      ]
    ]
  },
  {
    "id": "d6f6d0ab45a73962",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "name": "update status",
    "func": "return {\n    payload: {\n        fill: \"green\",\n        shape: \"dot\",\n        text: 'Last Value: ' + msg.payload\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1880,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "c3ca0d27c2ea2c12",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "name": "decode lorawan raw message",
    "func": "// Decode the MQTT payload from ChirpStack, which is Base64 encoded hex data\nvar base64Data = msg.payload.data || \"\";\nvar devEui = msg.payload.deviceInfo.devEui;\nvar bytes = Buffer.from(base64Data, 'base64'); // Decode Base64 string to byte array\nvar port = msg.payload.fPort || 0; // Extract fPort from the message, defaulting to 0 if not present\n\n// Call the decodeUplink function to process the decoded bytes\nmsg = {\n    payload: decodeUplink({bytes: bytes}, port).data\n}\n\n// Return the processed message object\nreturn msg;\n\n/**\n * Main decoder function for uplink messages.\n * Takes in the decoded byte array and processes it into a structured format.\n */\nfunction decodeUplink(input, port) {\n    var bytes = input['bytes'];\n    bytes = bytes2HexString(bytes).toUpperCase(); // Convert byte array to uppercase hex string\n\n    let result = {\n        'err': 0, \n        'eui': devEui,\n        'port': port,\n        'payload': bytes, \n        'valid': true,\n        'messages': []\n    };\n\n    // Split the hex string into individual data frames based on their identifiers\n    let splitArray = dataSplit(bytes);\n\n    // Decode each data frame according to its dataId and store the results\n    let decoderArray = splitArray.map(item => {\n        return dataIdAndDataValueJudge(item.dataId, item.dataValue);\n    });\n\n    // Store the decoded messages in the result object\n    result.messages = decoderArray;\n\n    return { data: result };\n}\n\n/**\n * Converts a byte array or buffer to a hex string.\n * This function ensures that each byte is represented as a two-character hex value.\n * \n * @param {Buffer|Array} arrBytes - The byte array to convert\n * @returns {string} - The resulting hex string\n */\nfunction bytes2HexString(arrBytes) {\n    if (!Array.isArray(arrBytes)) {\n        arrBytes = Array.from(arrBytes); // Convert buffer or array-like object to array\n    }\n    return arrBytes.map(byte => ('0' + (byte & 0xFF).toString(16)).slice(-2)).join('');\n}\n\n/**\n * Splits the hex string into data frames based on their identifiers.\n * Each frame is defined by a dataId and a corresponding dataValue.\n * \n * @param {string} bytes - The hex string to split\n * @returns {Array} - An array of objects containing dataId and dataValue\n */\nfunction dataSplit(bytes) {\n    let frameArray = [];\n\n    while (bytes.length > 2) {\n        let dataId = bytes.substring(0, 2); // Extract the data identifier\n        let dataValue;\n        let dataObj = {};\n\n        // Define the length of each data frame based on the dataId\n        const dataIdMap = {\n            '01': 22, '20': 22, '21': 22, '30': 22, '31': 22, '33': 22, \n            '40': 22, '41': 22, '42': 22, '43': 22, '44': 22, '45': 22,\n            '02': 18, '03': 4, '06': 4, '05': 10, '34': 10, \n            '04': 20, '10': 20, '32': 20, '35': 20, '36': 20, '37': 20, '38': 20, '39': 20\n        };\n\n        // Determine the length of the dataValue based on the dataId\n        let length = dataIdMap[dataId] || 2;\n        dataValue = bytes.substring(2, length); // Extract the dataValue based on the length\n        bytes = bytes.substring(length); // Move to the next frame\n\n        dataObj = { 'dataId': dataId, 'dataValue': dataValue }; // Create an object for this data frame\n\n        frameArray.push(dataObj); // Add the object to the array of frames\n    }\n\n    return frameArray;\n}\n\n/**\n * Decodes the dataValue of a given dataId and converts it into meaningful measurements.\n * \n * @param {string} dataId - The identifier for the type of data\n * @param {string} dataValue - The hex string representing the data to be decoded\n * @returns {Array} - An array of measurement objects\n */\nfunction dataIdAndDataValueJudge(dataId, dataValue) {\n    const measurements = [];\n    switch (dataId) {\n        case '01': // Temperature, humidity, light intensity, UV index, wind speed\n            measurements.push(createMeasurement('4097', 'Air Temperature', dataValue.substring(0, 4), 10));\n            measurements.push(createMeasurement('4098', 'Air Humidity', dataValue.substring(4, 6)));\n            measurements.push(createMeasurement('4099', 'Light Intensity', dataValue.substring(6, 14)));\n            measurements.push(createMeasurement('4190', 'UV Index', dataValue.substring(14, 16), 10));\n            measurements.push(createMeasurement('4105', 'Wind Speed', dataValue.substring(16, 20), 10));\n            break;\n        case '02': // Wind direction, rainfall, barometric pressure\n            measurements.push(createMeasurement('4104', 'Wind Direction Sensor', dataValue.substring(0, 4)));\n            measurements.push(createMeasurement('4113', 'Rain Gauge', dataValue.substring(4, 12), 1000));\n            measurements.push(createMeasurement('4101', 'Barometric Pressure', dataValue.substring(12, 16), 0.1));\n            break;\n        case '03': // Battery level\n            measurements.push({ 'Battery(%)': loraWANV2DataFormat(dataValue) });\n            break;\n        case '04': // Battery, hardware version, firmware version, measurement intervals\n            measurements.push({\n                'Battery(%)': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'Hardware Version': createVersion(dataValue.substring(2, 6)),\n                'Firmware Version': createVersion(dataValue.substring(6, 10)),\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(10, 14))) * 60,\n                'gpsInterval': parseInt(loraWANV2DataFormat(dataValue.substring(14, 18))) * 60\n            });\n            break;\n        case '05': // Measurement interval, GPS interval\n            measurements.push({\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(0, 4))) * 60,\n                'gpsInterval': parseInt(loraWANV2DataFormat(dataValue.substring(4, 8))) * 60\n            });\n            break;\n        case '06': // Sensor error event\n            measurements.push(createErrorMeasurement(dataValue));\n            break;\n        case '10': // Status and channel type\n            let { status, type } = loraWANV2BitDataFormat(dataValue.substring(0, 2));\n            measurements.push({\n                status: status, \n                channelType: type, \n                sensorEui: dataValue.substring(2)\n            });\n            break;\n        case '20':\n        case '21':\n        case '43':\n        case '44':\n        case '45': // AI detections\n            measurements.push(...createAIMeasurements(dataId, dataValue));\n            break;\n        case '30':\n        case '31':\n        case '32':\n        case '33': // Channel measurements\n            measurements.push(...createChannelMeasurements(dataId, dataValue));\n            break;\n        case '34': // Data logger configuration\n            measurements.push({\n                'dataloggerProtocol': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'dataloggerGPIOInput': loraWANV2DataFormat(dataValue.substring(2, 4)),\n                'dataloggerAnalogType': loraWANV2DataFormat(dataValue.substring(4, 6)),\n                'dataloggerAnalogInterface': loraWANV2DataFormat(dataValue.substring(6, 8))\n            });\n            break;\n        case '35':\n        case '36':\n        case '37':\n        case '38': // Channel pair measurements\n            measurements.push(createChannelMeasurementPair(dataValue));\n            break;\n        case '39': // Battery, hardware version, firmware version, measurement intervals\n            measurements.push({\n                'Battery(%)': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'Hardware Version': createVersion(dataValue.substring(2, 6)),\n                'Firmware Version': createVersion(dataValue.substring(6, 10)),\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(10, 14))) * 60,\n                'thresholdMeasureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(14, 18)))\n            });\n            break;\n        case '40':\n        case '41': // Light intensity, sound intensity, accelerometer data\n            measurements.push(...createSensorMeasurements(dataValue));\n            break;\n        case '42': // Air temperature, humidity, tVOC, CO2, soil moisture\n            measurements.push(createMeasurement('4097', 'Air Temperature', dataValue.substring(0, 4), 100));\n            measurements.push(createMeasurement('4098', 'Air Humidity', dataValue.substring(4, 8), 100));\n            measurements.push(createMeasurement('4195', 'Total Volatile Organic Compounds', dataValue.substring(8, 12)));\n            measurements.push(createMeasurement('4100', 'CO2', dataValue.substring(12, 16)));\n            measurements.push(createMeasurement('4196', 'Soil moisture intensity', dataValue.substring(16, 20)));\n            break;\n        default:\n            break;\n    }\n    return measurements;\n}\n\n/**\n * Creates a measurement object.\n * \n * @param {string} measurementId - The ID of the measurement type\n * @param {string} type - The type of measurement (e.g., temperature, humidity)\n * @param {string} data - The raw hex string representing the data\n * @param {number} divisor - A divisor for scaling the data value (optional)\n * @returns {Object} - A measurement object with the formatted data\n */\nfunction createMeasurement(measurementId, type, data, divisor = 1) {\n    return {\n        measurementValue: loraWANV2DataFormat(data, divisor),\n        measurementId: measurementId,\n        type: type\n    };\n}\n\n/**\n * Creates a version string from a data string.\n * \n * @param {string} data - The raw hex string representing version information\n * @returns {string} - The formatted version string (e.g., \"1.0\")\n */\nfunction createVersion(data) {\n    return `${loraWANV2DataFormat(data.substring(0, 2))}.${loraWANV2DataFormat(data.substring(2, 4))}`;\n}\n\n/**\n * Creates an error measurement object based on an error code.\n * \n * @param {string} dataValue - The raw hex string representing the error code\n * @returns {Object} - An error measurement object with detailed error information\n */\nfunction createErrorMeasurement(dataValue) {\n    const errorCodes = {\n        '00': 'CCL_SENSOR_ERROR_NONE',\n        '01': 'CCL_SENSOR_NOT_FOUND',\n        '02': 'CCL_SENSOR_WAKEUP_ERROR',\n        '03': 'CCL_SENSOR_NOT_RESPONSE',\n        '04': 'CCL_SENSOR_DATA_EMPTY',\n        '05': 'CCL_SENSOR_DATA_HEAD_ERROR',\n        '06': 'CCL_SENSOR_DATA_CRC_ERROR',\n        '07': 'CCL_SENSOR_DATA_B1_NO_VALID',\n        '08': 'CCL_SENSOR_DATA_B2_NO_VALID',\n        '09': 'CCL_SENSOR_RANDOM_NOT_MATCH',\n        '0A': 'CCL_SENSOR_PUBKEY_SIGN_VERIFY_FAILED',\n        '0B': 'CCL_SENSOR_DATA_SIGN_VERIFY_FAILED',\n        '0C': 'CCL_SENSOR_DATA_VALUE_HI',\n        '0D': 'CCL_SENSOR_DATA_VALUE_LOW',\n        '0E': 'CCL_SENSOR_DATA_VALUE_MISSED',\n        '0F': 'CCL_SENSOR_ARG_INVAILD',\n        '10': 'CCL_SENSOR_RS485_MASTER_BUSY',\n        '11': 'CCL_SENSOR_RS485_REV_DATA_ERROR',\n        '12': 'CCL_SENSOR_RS485_REG MISSING',\n        '13': 'CCL_SENSOR_RS485_FUN_EXE_ERROR',\n        '14': 'CCL_SENSOR_RS485_WRITE_STRATEGY_ERROR',\n        '15': 'CCL_SENSOR_CONFIG_ERROR',\n        'FF': 'CCL_SENSOR_DATA_ERROR_UNKNOWN'\n    };\n    const errCode = dataValue;\n    return {\n        measurementId: '4101',\n        type: 'sensor_error_event',\n        errCode: errCode,\n        descZh: errorCodes[errCode] || 'CC_OTHER_FAILED'\n    };\n}\n\n/**\n * Creates an array of AI detection measurements.\n * \n * @param {string} dataId - The identifier for the AI detection type\n * @param {string} dataValue - The raw hex string representing AI detection data\n * @returns {Array} - An array of AI detection measurement objects\n */\nfunction createAIMeasurements(dataId, dataValue) {\n    let measurements = [];\n    let initMeasurementId = dataId === '20' ? 4175 : dataId === '21' ? 4180 : 0;\n    for (let i = 0; i < dataValue.length; i += 4) {\n        let modelId = loraWANV2DataFormat(dataValue.substring(i, i + 2));\n        let detectionType = loraWANV2DataFormat(dataValue.substring(i + 2, i + 4));\n        let aiValues = `${modelId}.${detectionType}`;\n        measurements.push({\n            measurementValue: aiValues,\n            measurementId: initMeasurementId,\n            type: `AI Detection ${i}`\n        });\n        initMeasurementId++;\n    }\n    return measurements;\n}\n\n/**\n * Creates an array of channel measurements.\n * \n * @param {string} dataId - The identifier for the channel measurement type\n * @param {string} dataValue - The raw hex string representing channel measurement data\n * @returns {Array} - An array of channel measurement objects\n */\nfunction createChannelMeasurements(dataId, dataValue) {\n    let measurements = [];\n    let channelInfo = loraWANV2ChannelBitFormat(dataValue.substring(0, 2));\n    let dataOne = createMeasurement(parseInt(channelInfo.one), 'Measurement', dataValue.substring(4, 12), 1000);\n    let dataTwo = createMeasurement(parseInt(channelInfo.two), 'Measurement', dataValue.substring(12, 20), 1000);\n\n    if (parseInt(channelInfo.one)) measurements.push(dataOne);\n    if (parseInt(channelInfo.two)) measurements.push(dataTwo);\n    return measurements;\n}\n\n/**\n * Creates a pair of channel measurement objects.\n * \n * @param {string} dataValue - The raw hex string representing the channel data\n * @returns {Object} - An object containing two channel measurements\n */\nfunction createChannelMeasurementPair(dataValue) {\n    let channelInfo = loraWANV2ChannelBitFormat(dataValue.substring(0, 2));\n    let channelSortOne = 3920 + (parseInt(channelInfo.one) - 1) * 2;\n    let channelSortTwo = 3921 + (parseInt(channelInfo.two) - 1) * 2;\n\n    return {\n        [channelSortOne]: loraWANV2DataFormat(dataValue.substring(2, 10), 1000),\n        [channelSortTwo]: loraWANV2DataFormat(dataValue.substring(10, 18), 1000)\n    };\n}\n\n/**\n * Creates an array of sensor measurements (light intensity, sound intensity, accelerometer data).\n * \n * @param {string} dataValue - The raw hex string representing sensor data\n * @returns {Array} - An array of sensor measurement objects\n */\nfunction createSensorMeasurements(dataValue) {\n    return [\n        createMeasurement('4193', 'Light Intensity', dataValue.substring(0, 4)),\n        createMeasurement('4192', 'Sound Intensity', dataValue.substring(4, 8)),\n        createMeasurement('4150', 'AccelerometerX', dataValue.substring(8, 12), 100),\n        createMeasurement('4151', 'AccelerometerY', dataValue.substring(12, 16), 100),\n        createMeasurement('4152', 'AccelerometerZ', dataValue.substring(16, 20), 100)\n    ];\n}\n\n/**\n * Converts a hex string to a decimal number, applying a divisor for scaling if necessary.\n * Handles big-endian formats and supports signed integers.\n * \n * @param {string} str - The raw hex string to format\n * @param {number} divisor - A divisor for scaling the result (optional, default is 1)\n * @returns {number} - The formatted value as a number\n */\nfunction loraWANV2DataFormat(str, divisor = 1) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    if (str2[0] === '1') {\n        let arr = str2.split('').map(item => (parseInt(item) === 1 ? 0 : 1));\n        str2 = parseInt(arr.join(''), 2) + 1;\n        return -str2 / divisor;\n    }\n    return parseInt(str2, 2) / divisor;\n}\n\n/**\n * Transforms a hex string from big-endian format to an array of bytes.\n * \n * @param {string} data - The raw hex string\n * @returns {Array} - An array of byte strings\n */\nfunction bigEndianTransform(data) {\n    let dataArray = [];\n    for (let i = 0; i < data.length; i += 2) {\n        dataArray.push(data.substring(i, i + 2));\n    }\n    return dataArray;\n}\n\n/**\n * Converts an array of hex bytes to a binary string.\n * Ensures each byte is represented as an 8-bit binary number.\n * \n * @param {Array} arr - The array of hex byte strings\n * @returns {string} - The concatenated binary string\n */\nfunction toBinary(arr) {\n    return arr.map(item => parseInt(item, 16).toString(2).padStart(8, '0')).join('');\n}\n\n/**\n * Decodes a status and channel type from a bitfield.\n * \n * @param {string} str - The raw hex string representing the bitfield\n * @returns {Object} - An object containing the decoded channel, status, and type\n */\nfunction loraWANV2BitDataFormat(str) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    return {\n        channel: parseInt(str2.substring(0, 4), 2),\n        status: parseInt(str2.substring(4, 5), 2),\n        type: parseInt(str2.substring(5), 2)\n    };\n}\n\n/**\n * Decodes two channel identifiers from a bitfield.\n * \n * @param {string} str - The raw hex string representing the bitfield\n * @returns {Object} - An object containing the decoded channel identifiers\n */\nfunction loraWANV2ChannelBitFormat(str) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    return {\n        one: parseInt(str2.substring(0, 4), 2),\n        two: parseInt(str2.substring(4, 8), 2)\n    };\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 990,
    "y": 180,
    "wires": [
      [
        "6f15162a393a1c41"
      ]
    ]
  },
  {
    "id": "6f15162a393a1c41",
    "type": "function",
    "z": "fdfd26c77e5e2a42",
    "name": "decode tripwire message",
    "func": "var value = parseInt(msg.payload.messages[0][0].measurementValue);\n\nreturn {\n    payload: value,\n    sensecraft: {\n        fromType: 'Device',\n        valueMeaning: 'ChangeValue',\n        valuetype: 'Number',\n        expectInputType: ['Condition']\n    }\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1270,
    "y": 180,
    "wires": [
      [
        "5da5f4ea1905df1e",
        "9a0531c77d01eb12"
      ]
    ]
  },
  {
    "id": "4ed1a424454e047f",
    "type": "mqtt in",
    "z": "e0d523198c47fac8",
    "name": "subscribe mqtt, and receive message",
    "topic": "",
    "qos": "0",
    "datatype": "auto-detect",
    "broker": "${mqttBroker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 1,
    "x": 690,
    "y": 80,
    "wires": [
      [
        "9369152b78be0fd8",
        "609a0d5ccc3483ea"
      ]
    ]
  },
  {
    "id": "bf8cf61d9a1c87e9",
    "type": "status",
    "z": "e0d523198c47fac8",
    "name": "",
    "scope": [
      "4ed1a424454e047f"
    ],
    "x": 1560,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "66957fd11eb1e7f3",
    "type": "function",
    "z": "e0d523198c47fac8",
    "name": "build subscribe topic command",
    "func": "var applicationId = env.get(\"applicationId\");\nvar deviceId = env.get(\"deviceId\");\n\nif(!applicationId) {\n    applicationId = env.get(\"SENSECRAFT_MISSION_PACK_CHIRPSTACK_APPID\");\n}\n\nif(!deviceId) {\n    deviceId = env.get(\"SENSECRAFT_MISSION_PACK_DEVICE_ULTRASONIC_DEVEUI\")\n}\n\nmsg.action = 'subscribe'\nmsg.topic = {\n    topic: `application/${applicationId}/device/${deviceId}/event/up`,\n    qos: 0\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 370,
    "y": 80,
    "wires": [
      [
        "4ed1a424454e047f"
      ]
    ]
  },
  {
    "id": "f375699ff32824af",
    "type": "inject",
    "z": "e0d523198c47fac8",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "x": 130,
    "y": 80,
    "wires": [
      [
        "66957fd11eb1e7f3"
      ]
    ]
  },
  {
    "id": "4a6bb66a194ebecb",
    "type": "function",
    "z": "e0d523198c47fac8",
    "d": true,
    "name": "decode ultrasonic message",
    "func": "var value = (msg.payload.object.messages[0][0].measurementValue || 0) / 1000.0\n\nmsg.payload = value;\nmsg.sensecraft = {}\nmsg.sensecraft.fromType = \"Device\"\nmsg.sensecraft.valueMeaning = \"ChangeValue\"\nmsg.sensecraft.valuetype = \"Number\"\nmsg.sensecraft.expectInputType = [\"Condition\"]\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1300,
    "y": 80,
    "wires": [
      [
        "b4cae0a3a27b6aa9"
      ]
    ]
  },
  {
    "id": "9369152b78be0fd8",
    "type": "change",
    "z": "e0d523198c47fac8",
    "d": true,
    "name": "delete unused msg fields",
    "rules": [
      {
        "t": "delete",
        "p": "topic",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1010,
    "y": 80,
    "wires": [
      [
        "4a6bb66a194ebecb"
      ]
    ]
  },
  {
    "id": "b4cae0a3a27b6aa9",
    "type": "function",
    "z": "e0d523198c47fac8",
    "name": "update status",
    "func": "return {\n    payload: {\n        fill: \"green\",\n        shape: \"dot\",\n        text: 'Last Value: ' + msg.payload\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1540,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "609a0d5ccc3483ea",
    "type": "function",
    "z": "e0d523198c47fac8",
    "name": "decode lorawan raw message",
    "func": "// Decode the MQTT payload from ChirpStack, which is Base64 encoded hex data\nvar base64Data = msg.payload.data || \"\";\nvar devEui = msg.payload.deviceInfo.devEui;\nvar bytes = Buffer.from(base64Data, 'base64'); // Decode Base64 string to byte array\nvar port = msg.payload.fPort || 0; // Extract fPort from the message, defaulting to 0 if not present\n\n// Call the decodeUplink function to process the decoded bytes\nmsg = {\n    payload: decodeUplink({bytes: bytes}, port).data\n}\n\n// Return the processed message object\nreturn msg;\n\n/**\n * Main decoder function for uplink messages.\n * Takes in the decoded byte array and processes it into a structured format.\n */\nfunction decodeUplink(input, port) {\n    var bytes = input['bytes'];\n    bytes = bytes2HexString(bytes).toUpperCase(); // Convert byte array to uppercase hex string\n\n    let result = {\n        'err': 0, \n        'eui': devEui,\n        'port': port,\n        'payload': bytes, \n        'valid': true,\n        'messages': []\n    };\n\n    // Split the hex string into individual data frames based on their identifiers\n    let splitArray = dataSplit(bytes);\n\n    // Decode each data frame according to its dataId and store the results\n    let decoderArray = splitArray.map(item => {\n        return dataIdAndDataValueJudge(item.dataId, item.dataValue);\n    });\n\n    // Store the decoded messages in the result object\n    result.messages = decoderArray;\n\n    return { data: result };\n}\n\n/**\n * Converts a byte array or buffer to a hex string.\n * This function ensures that each byte is represented as a two-character hex value.\n * \n * @param {Buffer|Array} arrBytes - The byte array to convert\n * @returns {string} - The resulting hex string\n */\nfunction bytes2HexString(arrBytes) {\n    if (!Array.isArray(arrBytes)) {\n        arrBytes = Array.from(arrBytes); // Convert buffer or array-like object to array\n    }\n    return arrBytes.map(byte => ('0' + (byte & 0xFF).toString(16)).slice(-2)).join('');\n}\n\n/**\n * Splits the hex string into data frames based on their identifiers.\n * Each frame is defined by a dataId and a corresponding dataValue.\n * \n * @param {string} bytes - The hex string to split\n * @returns {Array} - An array of objects containing dataId and dataValue\n */\nfunction dataSplit(bytes) {\n    let frameArray = [];\n\n    while (bytes.length > 2) {\n        let dataId = bytes.substring(0, 2); // Extract the data identifier\n        let dataValue;\n        let dataObj = {};\n\n        // Define the length of each data frame based on the dataId\n        const dataIdMap = {\n            '01': 22, '20': 22, '21': 22, '30': 22, '31': 22, '33': 22, \n            '40': 22, '41': 22, '42': 22, '43': 22, '44': 22, '45': 22,\n            '02': 18, '03': 4, '06': 4, '05': 10, '34': 10, \n            '04': 20, '10': 20, '32': 20, '35': 20, '36': 20, '37': 20, '38': 20, '39': 20\n        };\n\n        // Determine the length of the dataValue based on the dataId\n        let length = dataIdMap[dataId] || 2;\n        dataValue = bytes.substring(2, length); // Extract the dataValue based on the length\n        bytes = bytes.substring(length); // Move to the next frame\n\n        dataObj = { 'dataId': dataId, 'dataValue': dataValue }; // Create an object for this data frame\n\n        frameArray.push(dataObj); // Add the object to the array of frames\n    }\n\n    return frameArray;\n}\n\n/**\n * Decodes the dataValue of a given dataId and converts it into meaningful measurements.\n * \n * @param {string} dataId - The identifier for the type of data\n * @param {string} dataValue - The hex string representing the data to be decoded\n * @returns {Array} - An array of measurement objects\n */\nfunction dataIdAndDataValueJudge(dataId, dataValue) {\n    const measurements = [];\n    switch (dataId) {\n        case '01': // Temperature, humidity, light intensity, UV index, wind speed\n            measurements.push(createMeasurement('4097', 'Air Temperature', dataValue.substring(0, 4), 10));\n            measurements.push(createMeasurement('4098', 'Air Humidity', dataValue.substring(4, 6)));\n            measurements.push(createMeasurement('4099', 'Light Intensity', dataValue.substring(6, 14)));\n            measurements.push(createMeasurement('4190', 'UV Index', dataValue.substring(14, 16), 10));\n            measurements.push(createMeasurement('4105', 'Wind Speed', dataValue.substring(16, 20), 10));\n            break;\n        case '02': // Wind direction, rainfall, barometric pressure\n            measurements.push(createMeasurement('4104', 'Wind Direction Sensor', dataValue.substring(0, 4)));\n            measurements.push(createMeasurement('4113', 'Rain Gauge', dataValue.substring(4, 12), 1000));\n            measurements.push(createMeasurement('4101', 'Barometric Pressure', dataValue.substring(12, 16), 0.1));\n            break;\n        case '03': // Battery level\n            measurements.push({ 'Battery(%)': loraWANV2DataFormat(dataValue) });\n            break;\n        case '04': // Battery, hardware version, firmware version, measurement intervals\n            measurements.push({\n                'Battery(%)': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'Hardware Version': createVersion(dataValue.substring(2, 6)),\n                'Firmware Version': createVersion(dataValue.substring(6, 10)),\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(10, 14))) * 60,\n                'gpsInterval': parseInt(loraWANV2DataFormat(dataValue.substring(14, 18))) * 60\n            });\n            break;\n        case '05': // Measurement interval, GPS interval\n            measurements.push({\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(0, 4))) * 60,\n                'gpsInterval': parseInt(loraWANV2DataFormat(dataValue.substring(4, 8))) * 60\n            });\n            break;\n        case '06': // Sensor error event\n            measurements.push(createErrorMeasurement(dataValue));\n            break;\n        case '10': // Status and channel type\n            let { status, type } = loraWANV2BitDataFormat(dataValue.substring(0, 2));\n            measurements.push({\n                status: status, \n                channelType: type, \n                sensorEui: dataValue.substring(2)\n            });\n            break;\n        case '20':\n        case '21':\n        case '43':\n        case '44':\n        case '45': // AI detections\n            measurements.push(...createAIMeasurements(dataId, dataValue));\n            break;\n        case '30':\n        case '31':\n        case '32':\n        case '33': // Channel measurements\n            measurements.push(...createChannelMeasurements(dataId, dataValue));\n            break;\n        case '34': // Data logger configuration\n            measurements.push({\n                'dataloggerProtocol': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'dataloggerGPIOInput': loraWANV2DataFormat(dataValue.substring(2, 4)),\n                'dataloggerAnalogType': loraWANV2DataFormat(dataValue.substring(4, 6)),\n                'dataloggerAnalogInterface': loraWANV2DataFormat(dataValue.substring(6, 8))\n            });\n            break;\n        case '35':\n        case '36':\n        case '37':\n        case '38': // Channel pair measurements\n            measurements.push(createChannelMeasurementPair(dataValue));\n            break;\n        case '39': // Battery, hardware version, firmware version, measurement intervals\n            measurements.push({\n                'Battery(%)': loraWANV2DataFormat(dataValue.substring(0, 2)),\n                'Hardware Version': createVersion(dataValue.substring(2, 6)),\n                'Firmware Version': createVersion(dataValue.substring(6, 10)),\n                'measureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(10, 14))) * 60,\n                'thresholdMeasureInterval': parseInt(loraWANV2DataFormat(dataValue.substring(14, 18)))\n            });\n            break;\n        case '40':\n        case '41': // Light intensity, sound intensity, accelerometer data\n            measurements.push(...createSensorMeasurements(dataValue));\n            break;\n        case '42': // Air temperature, humidity, tVOC, CO2, soil moisture\n            measurements.push(createMeasurement('4097', 'Air Temperature', dataValue.substring(0, 4), 100));\n            measurements.push(createMeasurement('4098', 'Air Humidity', dataValue.substring(4, 8), 100));\n            measurements.push(createMeasurement('4195', 'Total Volatile Organic Compounds', dataValue.substring(8, 12)));\n            measurements.push(createMeasurement('4100', 'CO2', dataValue.substring(12, 16)));\n            measurements.push(createMeasurement('4196', 'Soil moisture intensity', dataValue.substring(16, 20)));\n            break;\n        default:\n            break;\n    }\n    return measurements;\n}\n\n/**\n * Creates a measurement object.\n * \n * @param {string} measurementId - The ID of the measurement type\n * @param {string} type - The type of measurement (e.g., temperature, humidity)\n * @param {string} data - The raw hex string representing the data\n * @param {number} divisor - A divisor for scaling the data value (optional)\n * @returns {Object} - A measurement object with the formatted data\n */\nfunction createMeasurement(measurementId, type, data, divisor = 1) {\n    return {\n        measurementValue: loraWANV2DataFormat(data, divisor),\n        measurementId: measurementId,\n        type: type\n    };\n}\n\n/**\n * Creates a version string from a data string.\n * \n * @param {string} data - The raw hex string representing version information\n * @returns {string} - The formatted version string (e.g., \"1.0\")\n */\nfunction createVersion(data) {\n    return `${loraWANV2DataFormat(data.substring(0, 2))}.${loraWANV2DataFormat(data.substring(2, 4))}`;\n}\n\n/**\n * Creates an error measurement object based on an error code.\n * \n * @param {string} dataValue - The raw hex string representing the error code\n * @returns {Object} - An error measurement object with detailed error information\n */\nfunction createErrorMeasurement(dataValue) {\n    const errorCodes = {\n        '00': 'CCL_SENSOR_ERROR_NONE',\n        '01': 'CCL_SENSOR_NOT_FOUND',\n        '02': 'CCL_SENSOR_WAKEUP_ERROR',\n        '03': 'CCL_SENSOR_NOT_RESPONSE',\n        '04': 'CCL_SENSOR_DATA_EMPTY',\n        '05': 'CCL_SENSOR_DATA_HEAD_ERROR',\n        '06': 'CCL_SENSOR_DATA_CRC_ERROR',\n        '07': 'CCL_SENSOR_DATA_B1_NO_VALID',\n        '08': 'CCL_SENSOR_DATA_B2_NO_VALID',\n        '09': 'CCL_SENSOR_RANDOM_NOT_MATCH',\n        '0A': 'CCL_SENSOR_PUBKEY_SIGN_VERIFY_FAILED',\n        '0B': 'CCL_SENSOR_DATA_SIGN_VERIFY_FAILED',\n        '0C': 'CCL_SENSOR_DATA_VALUE_HI',\n        '0D': 'CCL_SENSOR_DATA_VALUE_LOW',\n        '0E': 'CCL_SENSOR_DATA_VALUE_MISSED',\n        '0F': 'CCL_SENSOR_ARG_INVAILD',\n        '10': 'CCL_SENSOR_RS485_MASTER_BUSY',\n        '11': 'CCL_SENSOR_RS485_REV_DATA_ERROR',\n        '12': 'CCL_SENSOR_RS485_REG MISSING',\n        '13': 'CCL_SENSOR_RS485_FUN_EXE_ERROR',\n        '14': 'CCL_SENSOR_RS485_WRITE_STRATEGY_ERROR',\n        '15': 'CCL_SENSOR_CONFIG_ERROR',\n        'FF': 'CCL_SENSOR_DATA_ERROR_UNKNOWN'\n    };\n    const errCode = dataValue;\n    return {\n        measurementId: '4101',\n        type: 'sensor_error_event',\n        errCode: errCode,\n        descZh: errorCodes[errCode] || 'CC_OTHER_FAILED'\n    };\n}\n\n/**\n * Creates an array of AI detection measurements.\n * \n * @param {string} dataId - The identifier for the AI detection type\n * @param {string} dataValue - The raw hex string representing AI detection data\n * @returns {Array} - An array of AI detection measurement objects\n */\nfunction createAIMeasurements(dataId, dataValue) {\n    let measurements = [];\n    let initMeasurementId = dataId === '20' ? 4175 : dataId === '21' ? 4180 : 0;\n    for (let i = 0; i < dataValue.length; i += 4) {\n        let modelId = loraWANV2DataFormat(dataValue.substring(i, i + 2));\n        let detectionType = loraWANV2DataFormat(dataValue.substring(i + 2, i + 4));\n        let aiValues = `${modelId}.${detectionType}`;\n        measurements.push({\n            measurementValue: aiValues,\n            measurementId: initMeasurementId,\n            type: `AI Detection ${i}`\n        });\n        initMeasurementId++;\n    }\n    return measurements;\n}\n\n/**\n * Creates an array of channel measurements.\n * \n * @param {string} dataId - The identifier for the channel measurement type\n * @param {string} dataValue - The raw hex string representing channel measurement data\n * @returns {Array} - An array of channel measurement objects\n */\nfunction createChannelMeasurements(dataId, dataValue) {\n    let measurements = [];\n    let channelInfo = loraWANV2ChannelBitFormat(dataValue.substring(0, 2));\n    let dataOne = createMeasurement(parseInt(channelInfo.one), 'Measurement', dataValue.substring(4, 12), 1000);\n    let dataTwo = createMeasurement(parseInt(channelInfo.two), 'Measurement', dataValue.substring(12, 20), 1000);\n\n    if (parseInt(channelInfo.one)) measurements.push(dataOne);\n    if (parseInt(channelInfo.two)) measurements.push(dataTwo);\n    return measurements;\n}\n\n/**\n * Creates a pair of channel measurement objects.\n * \n * @param {string} dataValue - The raw hex string representing the channel data\n * @returns {Object} - An object containing two channel measurements\n */\nfunction createChannelMeasurementPair(dataValue) {\n    let channelInfo = loraWANV2ChannelBitFormat(dataValue.substring(0, 2));\n    let channelSortOne = 3920 + (parseInt(channelInfo.one) - 1) * 2;\n    let channelSortTwo = 3921 + (parseInt(channelInfo.two) - 1) * 2;\n\n    return {\n        [channelSortOne]: loraWANV2DataFormat(dataValue.substring(2, 10), 1000),\n        [channelSortTwo]: loraWANV2DataFormat(dataValue.substring(10, 18), 1000)\n    };\n}\n\n/**\n * Creates an array of sensor measurements (light intensity, sound intensity, accelerometer data).\n * \n * @param {string} dataValue - The raw hex string representing sensor data\n * @returns {Array} - An array of sensor measurement objects\n */\nfunction createSensorMeasurements(dataValue) {\n    return [\n        createMeasurement('4193', 'Light Intensity', dataValue.substring(0, 4)),\n        createMeasurement('4192', 'Sound Intensity', dataValue.substring(4, 8)),\n        createMeasurement('4150', 'AccelerometerX', dataValue.substring(8, 12), 100),\n        createMeasurement('4151', 'AccelerometerY', dataValue.substring(12, 16), 100),\n        createMeasurement('4152', 'AccelerometerZ', dataValue.substring(16, 20), 100)\n    ];\n}\n\n/**\n * Converts a hex string to a decimal number, applying a divisor for scaling if necessary.\n * Handles big-endian formats and supports signed integers.\n * \n * @param {string} str - The raw hex string to format\n * @param {number} divisor - A divisor for scaling the result (optional, default is 1)\n * @returns {number} - The formatted value as a number\n */\nfunction loraWANV2DataFormat(str, divisor = 1) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    if (str2[0] === '1') {\n        let arr = str2.split('').map(item => (parseInt(item) === 1 ? 0 : 1));\n        str2 = parseInt(arr.join(''), 2) + 1;\n        return -str2 / divisor;\n    }\n    return parseInt(str2, 2) / divisor;\n}\n\n/**\n * Transforms a hex string from big-endian format to an array of bytes.\n * \n * @param {string} data - The raw hex string\n * @returns {Array} - An array of byte strings\n */\nfunction bigEndianTransform(data) {\n    let dataArray = [];\n    for (let i = 0; i < data.length; i += 2) {\n        dataArray.push(data.substring(i, i + 2));\n    }\n    return dataArray;\n}\n\n/**\n * Converts an array of hex bytes to a binary string.\n * Ensures each byte is represented as an 8-bit binary number.\n * \n * @param {Array} arr - The array of hex byte strings\n * @returns {string} - The concatenated binary string\n */\nfunction toBinary(arr) {\n    return arr.map(item => parseInt(item, 16).toString(2).padStart(8, '0')).join('');\n}\n\n/**\n * Decodes a status and channel type from a bitfield.\n * \n * @param {string} str - The raw hex string representing the bitfield\n * @returns {Object} - An object containing the decoded channel, status, and type\n */\nfunction loraWANV2BitDataFormat(str) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    return {\n        channel: parseInt(str2.substring(0, 4), 2),\n        status: parseInt(str2.substring(4, 5), 2),\n        type: parseInt(str2.substring(5), 2)\n    };\n}\n\n/**\n * Decodes two channel identifiers from a bitfield.\n * \n * @param {string} str - The raw hex string representing the bitfield\n * @returns {Object} - An object containing the decoded channel identifiers\n */\nfunction loraWANV2ChannelBitFormat(str) {\n    let strReverse = bigEndianTransform(str);\n    let str2 = toBinary(strReverse);\n    return {\n        one: parseInt(str2.substring(0, 4), 2),\n        two: parseInt(str2.substring(4, 8), 2)\n    };\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 990,
    "y": 160,
    "wires": [
      [
        "e759cd06d6462147"
      ]
    ]
  },
  {
    "id": "e759cd06d6462147",
    "type": "function",
    "z": "e0d523198c47fac8",
    "name": "decode ultrasonic message",
    "func": "var value = (msg.payload.messages[0][0].measurementValue || 0) / 1000.0\n\nreturn {\n    payload: value,\n    sensecraft: {\n        fromType: 'Device',\n        valueMeaning: 'ChangeValue',\n        valuetype: 'Number',\n        expectInputType: ['Condition']\n    }\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1300,
    "y": 160,
    "wires": [
      [
        "b4cae0a3a27b6aa9"
      ]
    ]
  },
  {
    "id": "6118cd66d545feee",
    "type": "function",
    "z": "864d0ea09f268ade",
    "name": "override global envs",
    "func": "global.set('geoLat', undefined);\nglobal.set('geoLng', undefined);\nglobal.set('radius', undefined);\nglobal.set('geoArea', undefined);\nglobal.set('geoPolygon', undefined);\n\nnode.status({ \n    fill: \"yellow\", \n    shape: \"dot\", \n    text: \"Geofence cleared\" \n});\nmsg.payload = \"Geofence cleared\";\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 240,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "b4fa1b291be93bd0",
    "type": "status",
    "z": "864d0ea09f268ade",
    "name": "",
    "scope": null,
    "x": 130,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "17166137dc2d2393",
    "type": "function",
    "z": "3222c245ca4d6f5a",
    "name": "get this node id as 'condition item id' and set to flow",
    "func": "var condition_item_id = node.id;\n\nflow.set(\"condition_item_id\", condition_item_id)\n\nreturn {\n    payload: condition_item_id\n};",
    "outputs": 1,
    "timeout": "0",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 480,
    "y": 100,
    "wires": [
      [
        "9abdef358b9063d3"
      ]
    ]
  },
  {
    "id": "9abdef358b9063d3",
    "type": "change",
    "z": "3222c245ca4d6f5a",
    "name": "prepare the metadata to next node",
    "rules": [
      {
        "t": "set",
        "p": "condition.action",
        "pt": "msg",
        "to": "report_item_id",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "condition.value",
        "pt": "msg",
        "to": "payload",
        "tot": "msg",
        "dc": true
      },
      {
        "t": "delete",
        "p": "topic",
        "pt": "msg"
      },
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 900,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "f90a4f3b20c7063b",
    "type": "inject",
    "z": "3222c245ca4d6f5a",
    "name": "onstartup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "x": 160,
    "y": 100,
    "wires": [
      [
        "17166137dc2d2393"
      ]
    ]
  },
  {
    "id": "6feedcb6904fe0b7",
    "type": "function",
    "z": "3222c245ca4d6f5a",
    "name": "handle condition",
    "func": "return msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 950,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "cdf78b2f3d8e9912",
    "type": "change",
    "z": "3222c245ca4d6f5a",
    "name": "set condition flag",
    "rules": [
      {
        "t": "set",
        "p": "condition.action",
        "pt": "msg",
        "to": "report_item",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 630,
    "y": 200,
    "wires": [
      [
        "6feedcb6904fe0b7"
      ]
    ]
  },
  {
    "id": "3ea72c2a420cfde0",
    "type": "debug",
    "z": "aa193c820dc14bcf",
    "g": "99d0e9268f69dc25",
    "name": "debug 1",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 760,
    "y": 80,
    "wires": []
  },
  {
    "id": "c7ddc2768894bbca",
    "type": "function",
    "z": "aa193c820dc14bcf",
    "g": "99d0e9268f69dc25",
    "name": "save all condition items id",
    "func": "var items = flow.get(\"items\") || [];\n\nif (msg.condition && msg.condition.value !== undefined) {\n    items.push(msg.condition.value);\n}\n\nflow.set(\"items\", items);\n\nreturn {\n    payload: items\n};\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 510,
    "y": 80,
    "wires": [
      [
        "3ea72c2a420cfde0"
      ]
    ]
  },
  {
    "id": "3452e74a6f467e5e",
    "type": "function",
    "z": "aa193c820dc14bcf",
    "name": "function 65",
    "func": "\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 450,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "ea3247f6fb34b34b",
    "type": "function",
    "z": "aa193c820dc14bcf",
    "name": "function 66",
    "func": "\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 470,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "a1a49100e860fc7f",
    "type": "switch",
    "z": "aa193c820dc14bcf",
    "name": "report_node_id",
    "property": "condition.action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "report_item_id",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 240,
    "y": 160,
    "wires": [
      [
        "c7ddc2768894bbca"
      ],
      [
        "3452e74a6f467e5e"
      ]
    ]
  },
  {
    "id": "58a570950dc50edf",
    "type": "debug",
    "z": "aa193c820dc14bcf",
    "name": "debug 2",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 220,
    "y": 80,
    "wires": []
  },
  {
    "id": "9657bcc00fd4b2a5",
    "type": "function",
    "z": "cb0af35beb73a330",
    "name": "function 64",
    "func": "\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 270,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "87c774e28eacd57b",
    "type": "file",
    "z": "e404a21a200ea798",
    "g": "033919525f9f8f52",
    "name": "override records-name",
    "filename": "/data/files/_face_recognization/records-name.txt",
    "filenameType": "str",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "none",
    "x": 1320,
    "y": 180,
    "wires": [
      [
        "99c9b37632c5c033"
      ]
    ]
  },
  {
    "id": "4a7e17d4865cffa2",
    "type": "function",
    "z": "e404a21a200ea798",
    "g": "033919525f9f8f52",
    "name": "empty object payload",
    "func": "return {\n    payload: {}\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1080,
    "y": 180,
    "wires": [
      [
        "87c774e28eacd57b"
      ]
    ]
  },
  {
    "id": "2271c8e79360da12",
    "type": "function",
    "z": "e404a21a200ea798",
    "g": "93233531937b3c5b",
    "name": "send empty msg",
    "func": "\nreturn {\n    topic: '',\n    payload: ''\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 230,
    "y": 140,
    "wires": [
      [
        "1757226126fc2011"
      ]
    ]
  },
  {
    "id": "27ac2da36edceb77",
    "type": "function",
    "z": "e404a21a200ea798",
    "g": "93233531937b3c5b",
    "name": "get total face number",
    "func": "// 获取输入的 payload 数组\nlet inputArray = msg.payload;\n\n// 检查输入是否是一个数组\nif (Array.isArray(inputArray)) {\n    // 获取数组的元素数量\n    let elementCount = inputArray.length;\n    \n    // 将元素数量作为新的 payload 输出\n    msg.payload = elementCount;\n} else {\n    // 如果输入不是数组，输出一个错误消息\n    msg.payload = \"输入的 payload 不是一个数组\";\n}\n\n// 返回消息对象\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 780,
    "y": 140,
    "wires": [
      [
        "a9a2f7647a0e4ed4",
        "4a7e17d4865cffa2"
      ]
    ]
  },
  {
    "id": "b9e071b6f00c3d67",
    "type": "json",
    "z": "e404a21a200ea798",
    "g": "93233531937b3c5b",
    "name": "to json",
    "property": "payload",
    "action": "obj",
    "pretty": false,
    "x": 590,
    "y": 140,
    "wires": [
      [
        "27ac2da36edceb77"
      ]
    ]
  },
  {
    "id": "1757226126fc2011",
    "type": "file in",
    "z": "e404a21a200ea798",
    "g": "93233531937b3c5b",
    "name": "get records",
    "filename": "/data/files/_face_recognization/records.txt",
    "filenameType": "str",
    "format": "utf8",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 430,
    "y": 140,
    "wires": [
      [
        "b9e071b6f00c3d67"
      ]
    ]
  },
  {
    "id": "a9a2f7647a0e4ed4",
    "type": "function",
    "z": "e404a21a200ea798",
    "g": "1891c8a9c8279dc1",
    "name": "empty arrary payload",
    "func": "return {\n    payload: []\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1080,
    "y": 80,
    "wires": [
      [
        "f498bbc270cb5e99"
      ]
    ]
  },
  {
    "id": "f498bbc270cb5e99",
    "type": "file",
    "z": "e404a21a200ea798",
    "g": "1891c8a9c8279dc1",
    "name": "override records",
    "filename": "/data/files/_face_recognization/records.txt",
    "filenameType": "str",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "none",
    "x": 1340,
    "y": 80,
    "wires": [
      [
        "99c9b37632c5c033"
      ]
    ]
  },
  {
    "id": "99c9b37632c5c033",
    "type": "join",
    "z": "e404a21a200ea798",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "useparts": false,
    "accumulate": false,
    "timeout": "",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 1530,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "16b0d0cdb64d28b3",
    "type": "file in",
    "z": "4090eb5792412927",
    "name": "get records-name",
    "filename": "/data/files/_face_recognization/records-name.txt",
    "filenameType": "str",
    "format": "utf8",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 230,
    "y": 100,
    "wires": [
      [
        "a13cca7fb9aa7d7f"
      ]
    ]
  },
  {
    "id": "a13cca7fb9aa7d7f",
    "type": "json",
    "z": "4090eb5792412927",
    "name": "to json",
    "property": "payload",
    "action": "obj",
    "pretty": false,
    "x": 410,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "c3a84f1cf9e4f549",
    "type": "status",
    "z": "4090eb5792412927",
    "name": "",
    "scope": null,
    "x": 370,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "20ccfceca2c8a814",
    "type": "link out",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "step-1",
    "mode": "link",
    "links": [
      "e7ef601afcf5adf7"
    ],
    "x": 1310,
    "y": 120,
    "wires": [],
    "l": true
  },
  {
    "id": "e7ef601afcf5adf7",
    "type": "link in",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "step-1'",
    "links": [
      "20ccfceca2c8a814"
    ],
    "x": 210,
    "y": 360,
    "wires": [
      [
        "81d8c848044b4824"
      ]
    ],
    "l": true
  },
  {
    "id": "e69c7076a06a204d",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "error msg",
    "func": "\nreturn {\n    topic: 'err'\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1000,
    "y": 380,
    "wires": [
      [
        "1a6981a43e2ef392"
      ]
    ]
  },
  {
    "id": "1a6981a43e2ef392",
    "type": "link out",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "err output",
    "mode": "link",
    "links": [
      "44d6327fc2130e2d"
    ],
    "x": 1160,
    "y": 380,
    "wires": [],
    "l": true
  },
  {
    "id": "b8156427366ffbc0",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "error msg",
    "func": "\nreturn {\n    topic: 'err'\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1060,
    "y": 260,
    "wires": [
      [
        "8bb12f72033949dd"
      ]
    ]
  },
  {
    "id": "8bb12f72033949dd",
    "type": "link out",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "err output",
    "mode": "link",
    "links": [
      "44d6327fc2130e2d"
    ],
    "x": 1220,
    "y": 260,
    "wires": [],
    "l": true
  },
  {
    "id": "5b94bf340246e2f4",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "7f68e627b4ad456a",
    "name": "get face name",
    "func": "\nreturn {\n    topic: 'success',\n    payload: msg.payload[flow.get('faceid')]\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 620,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "7a46d18411e71823",
    "type": "json",
    "z": "c5b584eb17fdf706",
    "g": "7f68e627b4ad456a",
    "name": "to json",
    "property": "payload",
    "action": "obj",
    "pretty": false,
    "x": 430,
    "y": 480,
    "wires": [
      [
        "5b94bf340246e2f4"
      ]
    ]
  },
  {
    "id": "abd38a3bfba94980",
    "type": "file in",
    "z": "c5b584eb17fdf706",
    "g": "7f68e627b4ad456a",
    "name": "get records-name",
    "filename": "/data/files/_face_recognization/records-name.txt",
    "filenameType": "str",
    "format": "utf8",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 250,
    "y": 480,
    "wires": [
      [
        "7a46d18411e71823"
      ]
    ]
  },
  {
    "id": "3c1501d272224b44",
    "type": "switch",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "similarity",
    "property": "payload.similarity",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gte",
        "v": "similarity",
        "vt": "env"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 840,
    "y": 360,
    "wires": [
      [
        "abd38a3bfba94980"
      ],
      [
        "e69c7076a06a204d"
      ]
    ]
  },
  {
    "id": "cdeb1ae0239a071a",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "get face id and similarity",
    "func": "// 获取传入的payload数组\nlet array = msg.payload[0];\n\n// 初始化最大值和对应的索引\nlet maxVal = array[0];\nlet maxIndex = 0;\n\n// 遍历数组找出最大值及其对应的索引\nfor (let i = 1; i < array.length; i++) {\n    if (array[i] > maxVal) {\n        maxVal = array[i];\n        maxIndex = i;\n    }\n}\n\nflow.set('similarity', maxVal);\nflow.set('faceid', maxIndex + 1);\n\n// 返回修改后的msg对象\nreturn {\n    topic: '',\n    payload: {\n        similarity: maxVal,\n        faceid: maxIndex + 1\n    }\n};\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 650,
    "y": 360,
    "wires": [
      [
        "3c1501d272224b44"
      ]
    ]
  },
  {
    "id": "16819fbb21a27697",
    "type": "base64",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "",
    "action": "",
    "property": "payload",
    "x": 220,
    "y": 160,
    "wires": [
      [
        "6119ca70cef18695"
      ]
    ]
  },
  {
    "id": "81d8c848044b4824",
    "type": "good-calculate-cosine",
    "z": "c5b584eb17fdf706",
    "g": "e6f197a5204b1d19",
    "name": "",
    "file": "/data/files/_face_recognization/records.txt",
    "x": 410,
    "y": 360,
    "wires": [
      [
        "cdeb1ae0239a071a"
      ]
    ]
  },
  {
    "id": "eacdc21c158e48a0",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "Error Messege",
    "func": "node.warn(msg.errMsg);",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1080,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "94ec4bf104636819",
    "type": "good-face-vectorization",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "",
    "inputType": "1",
    "returnType": "0",
    "method": "0",
    "path": "./example.txt",
    "x": 1110,
    "y": 120,
    "wires": [
      [
        "20ccfceca2c8a814"
      ]
    ]
  },
  {
    "id": "b10beb24b2cfe3e1",
    "type": "switch",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "",
    "property": "next",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "false"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 850,
    "y": 160,
    "wires": [
      [
        "94ec4bf104636819"
      ],
      [
        "eacdc21c158e48a0",
        "b8156427366ffbc0"
      ]
    ]
  },
  {
    "id": "822916ab0d9311d2",
    "type": "function",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "check if face exists",
    "func": "if (msg.payload.data.face.length === 1){\n    msg.next = true;\n    msg.payload = msg.payload.data.face;\n} else if (msg.payload.data.face.length === 0) {\n    msg.next = false;\n    msg.errMsg = \"Couldn't find the face. Please try again.\";\n} else {\n    msg.next = false;\n    msg.errMsg = \"There are several faces. Please register only one person.\";\n}\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 670,
    "y": 160,
    "wires": [
      [
        "b10beb24b2cfe3e1"
      ]
    ]
  },
  {
    "id": "6119ca70cef18695",
    "type": "good-face-detection",
    "z": "c5b584eb17fdf706",
    "g": "57d31dd28e179a83",
    "name": "",
    "returnValue": "1",
    "threshold": "0.1",
    "absolutePathDir": "",
    "x": 440,
    "y": 160,
    "wires": [
      [
        "822916ab0d9311d2"
      ]
    ]
  },
  {
    "id": "3d9fa93c082008e6",
    "type": "status",
    "z": "c5b584eb17fdf706",
    "name": "",
    "scope": null,
    "x": 1030,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "44d6327fc2130e2d",
    "type": "link in",
    "z": "c5b584eb17fdf706",
    "name": "err output'",
    "links": [
      "8bb12f72033949dd",
      "1a6981a43e2ef392"
    ],
    "x": 1140,
    "y": 460,
    "wires": [
      []
    ],
    "l": true
  },
  {
    "id": "5b84894c77c1fc50",
    "type": "change",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "set cropped_image",
    "rules": [
      {
        "t": "set",
        "p": "cropped_image",
        "pt": "flow",
        "to": "payload.originImg",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 610,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "a65f432ce45eef27",
    "type": "link out",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "parallel-2",
    "mode": "link",
    "links": [
      "3f60edfd50035b43"
    ],
    "x": 1100,
    "y": 380,
    "wires": [],
    "l": true
  },
  {
    "id": "3f60edfd50035b43",
    "type": "link in",
    "z": "5bb547dce475f866",
    "g": "0574b46850707de5",
    "name": "parallel-2'",
    "links": [
      "a65f432ce45eef27"
    ],
    "x": 220,
    "y": 480,
    "wires": [
      [
        "77d34c5dcff131de"
      ]
    ],
    "l": true
  },
  {
    "id": "82ed87c64df302ee",
    "type": "link in",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "get current face vector'",
    "links": [
      "bb060c49a5f4dc36"
    ],
    "x": 260,
    "y": 340,
    "wires": [
      [
        "6fe4a735d30c679b"
      ]
    ],
    "l": true
  },
  {
    "id": "bb060c49a5f4dc36",
    "type": "link out",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "get current face vector",
    "mode": "link",
    "links": [
      "d515c361989c804d",
      "f1956fa040a5ae36",
      "82ed87c64df302ee"
    ],
    "x": 1240,
    "y": 120,
    "wires": [],
    "l": true
  },
  {
    "id": "d515c361989c804d",
    "type": "link in",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "get current face vector'",
    "links": [
      "bb060c49a5f4dc36"
    ],
    "x": 260,
    "y": 380,
    "wires": [
      [
        "d8d29a2e1f68dfe7"
      ]
    ],
    "l": true
  },
  {
    "id": "015f9db91af3e390",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "error msg",
    "func": "\nreturn {\n    topic: 'err'\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 920,
    "y": 200,
    "wires": [
      [
        "a641359c4d064d04"
      ]
    ]
  },
  {
    "id": "a641359c4d064d04",
    "type": "link out",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "err output",
    "mode": "link",
    "links": [
      "a601c4964f762916"
    ],
    "x": 1060,
    "y": 200,
    "wires": [],
    "l": true
  },
  {
    "id": "244f3d42bf4c2b31",
    "type": "json",
    "z": "5bb547dce475f866",
    "g": "0574b46850707de5",
    "name": "to json",
    "property": "payload",
    "action": "obj",
    "pretty": false,
    "x": 590,
    "y": 480,
    "wires": [
      [
        "f145c165bea3f87a"
      ]
    ]
  },
  {
    "id": "f145c165bea3f87a",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "0574b46850707de5",
    "name": "add face id and name",
    "func": "msg.payload[msg.current_face_id] = '' + flow.get(\"input_name\");\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 800,
    "y": 480,
    "wires": [
      [
        "571941aded192eef"
      ]
    ]
  },
  {
    "id": "571941aded192eef",
    "type": "file",
    "z": "5bb547dce475f866",
    "g": "0574b46850707de5",
    "name": "override records-name",
    "filename": "/data/files/_face_recognization/records-name.txt",
    "filenameType": "str",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "none",
    "x": 1060,
    "y": 480,
    "wires": [
      [
        "d476491945a48358"
      ]
    ]
  },
  {
    "id": "77d34c5dcff131de",
    "type": "file in",
    "z": "5bb547dce475f866",
    "g": "0574b46850707de5",
    "name": "get records-name",
    "filename": "/data/files/_face_recognization/records-name.txt",
    "filenameType": "str",
    "format": "utf8",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 410,
    "y": 480,
    "wires": [
      [
        "244f3d42bf4c2b31"
      ]
    ]
  },
  {
    "id": "613abc3d927e73b0",
    "type": "file",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "override records",
    "filename": "/data/files/_face_recognization/records.txt",
    "filenameType": "str",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "none",
    "x": 1380,
    "y": 300,
    "wires": [
      [
        "d476491945a48358"
      ]
    ]
  },
  {
    "id": "d5eb4430aeb03f2b",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "set face id",
    "func": "var faceId = parseInt(msg.payload[1].length + 1);\n\nflow.set('current_face_id', faceId);\nmsg.current_face_id = faceId;\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 910,
    "y": 380,
    "wires": [
      [
        "fe36be70f959558f",
        "a65f432ce45eef27"
      ]
    ]
  },
  {
    "id": "fb700ec9c87b1f8b",
    "type": "change",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "set input name",
    "rules": [
      {
        "t": "set",
        "p": "input_name",
        "pt": "flow",
        "to": "topic",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 240,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "fe36be70f959558f",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "combine new records array",
    "func": "var payload = msg.payload;\n\nvar elementToAdd = payload[0][0];\n\nvar targetArray = payload[1];\n\ntargetArray.push(elementToAdd);\n\nmsg.payload = targetArray;\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1140,
    "y": 300,
    "wires": [
      [
        "613abc3d927e73b0"
      ]
    ]
  },
  {
    "id": "6fe4a735d30c679b",
    "type": "join",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "useparts": false,
    "accumulate": false,
    "timeout": "",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 750,
    "y": 360,
    "wires": [
      [
        "d5eb4430aeb03f2b"
      ]
    ]
  },
  {
    "id": "13ea454879d2d2db",
    "type": "json",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "to json",
    "property": "payload",
    "action": "obj",
    "pretty": false,
    "x": 630,
    "y": 380,
    "wires": [
      [
        "6fe4a735d30c679b"
      ]
    ]
  },
  {
    "id": "d8d29a2e1f68dfe7",
    "type": "file in",
    "z": "5bb547dce475f866",
    "g": "e18cdbece1ee414b",
    "name": "get records",
    "filename": "/data/files/_face_recognization/records.txt",
    "filenameType": "str",
    "format": "utf8",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 470,
    "y": 380,
    "wires": [
      [
        "13ea454879d2d2db"
      ]
    ]
  },
  {
    "id": "1bd947ef0136bf4a",
    "type": "base64",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "",
    "action": "",
    "property": "payload",
    "x": 220,
    "y": 140,
    "wires": [
      [
        "eb2c8ec65d140976"
      ]
    ]
  },
  {
    "id": "061cd6fe11f24d84",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "Error Messege",
    "func": "return console.log(msg.errMsg);",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 940,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "2ca56057b286ed99",
    "type": "good-face-vectorization",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "",
    "inputType": "1",
    "returnType": "0",
    "method": "1",
    "path": "/data/files/_face_recognization/records.txt",
    "x": 970,
    "y": 120,
    "wires": [
      [
        "bb060c49a5f4dc36"
      ]
    ]
  },
  {
    "id": "f8aa938b61591ffb",
    "type": "switch",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "",
    "property": "next",
    "propertyType": "msg",
    "rules": [
      {
        "t": "true"
      },
      {
        "t": "false"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 770,
    "y": 140,
    "wires": [
      [
        "2ca56057b286ed99"
      ],
      [
        "061cd6fe11f24d84",
        "015f9db91af3e390"
      ]
    ]
  },
  {
    "id": "bf02cef20c7c5573",
    "type": "function",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "check if face exists",
    "func": "if (msg.payload.data.face.length === 1){\n    msg.next = true;\n    msg.payload = msg.payload.data.face;\n} else if (msg.payload.data.face.length === 0) {\n    msg.next = false;\n    msg.errMsg = \"Couldn't find the face. Please try again.\";\n} else {\n    msg.next = false;\n    msg.errMsg = \"There are several faces. Please register only one person.\";\n}\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 610,
    "y": 140,
    "wires": [
      [
        "f8aa938b61591ffb"
      ]
    ]
  },
  {
    "id": "eb2c8ec65d140976",
    "type": "good-face-detection",
    "z": "5bb547dce475f866",
    "g": "a18ab3f640fb968f",
    "name": "",
    "returnValue": "1",
    "threshold": "0.1",
    "absolutePathDir": "",
    "x": 400,
    "y": 140,
    "wires": [
      [
        "bf02cef20c7c5573",
        "5b84894c77c1fc50"
      ]
    ]
  },
  {
    "id": "0b1a4ae0fb685dac",
    "type": "status",
    "z": "5bb547dce475f866",
    "name": "",
    "scope": null,
    "x": 2110,
    "y": 540,
    "wires": [
      []
    ]
  },
  {
    "id": "d476491945a48358",
    "type": "join",
    "z": "5bb547dce475f866",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "topic",
    "joiner": "\\n",
    "joinerType": "str",
    "useparts": false,
    "accumulate": false,
    "timeout": "",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "",
    "reduceFixup": "",
    "x": 1570,
    "y": 420,
    "wires": [
      [
        "29d4d7e465696410"
      ]
    ]
  },
  {
    "id": "09d5c1594e88a074",
    "type": "function",
    "z": "5bb547dce475f866",
    "name": "build output message",
    "func": "\nreturn {\n    topic: 'success',\n    payload: flow.get(\"current_face_id\")\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2140,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "a601c4964f762916",
    "type": "link in",
    "z": "5bb547dce475f866",
    "name": "err output'",
    "links": [
      "a641359c4d064d04"
    ],
    "x": 2180,
    "y": 360,
    "wires": [
      []
    ],
    "l": true
  },
  {
    "id": "9b13775bb0e64b3b",
    "type": "file",
    "z": "5bb547dce475f866",
    "name": "",
    "filename": "filename",
    "filenameType": "msg",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "none",
    "x": 1940,
    "y": 420,
    "wires": [
      [
        "09d5c1594e88a074"
      ]
    ]
  },
  {
    "id": "29d4d7e465696410",
    "type": "function",
    "z": "5bb547dce475f866",
    "name": "prepare to write file",
    "func": "var faceid = flow.get('cropped_image');\n\nreturn {\n    faceid: faceid,\n    filename: '/data/files/_face_recognization/images/' + flow.get(\"current_face_id\") + '.jpg',\n    payload: faceid\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1750,
    "y": 420,
    "wires": [
      [
        "9b13775bb0e64b3b"
      ]
    ]
  },
  {
    "id": "4c66e73173def117",
    "type": "function",
    "z": "8e71ad1d725a1c4b",
    "name": "Circle Geofence Check",
    "func": "const geoLat = parseFloat(global.get('geofence_geoLat'));\nconst geoLng = parseFloat(global.get('geofence_geoLng'));\nconst radius = parseFloat(global.get('geofence_radius'));\n\n// Check if the geofence values are set\nif (isNaN(geoLat) || isNaN(geoLng) || isNaN(radius)) {\n    node.status({ fill: \"yellow\", shape: \"dot\", text: \"Geofence not set\" });\n    msg.payload = \"Geofence not set\";\n    msg.result = false;\n    return msg;\n}\n\nfunction haversine(lat1, lon1, lat2, lon2) {\n    const R = 6371000; // Radius of the Earth in meters\n    const dLat = (lat2 - lat1) * (Math.PI / 180);\n    const dLon = (lon2 - lon1) * (Math.PI / 180);\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n        Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *\n        Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n}\n\nconst latitude = msg.payload.latitude;\nconst longitude = msg.payload.longitude;\nconst distance = haversine(latitude, longitude, geoLat, geoLng);\n\nif (distance <= radius) {\n    node.status({ fill: \"green\", shape: \"dot\", text: \"Inside geofence\" });\n    msg.payload = \"Inside geofence\";\n    msg.result = false;\n} else {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Outside geofence\" });\n    msg.payload = \"Outside geofence\";\n    msg.result = true;\n}\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 250,
    "y": 80,
    "wires": [
      [
        "60dcdf32abc3caca"
      ]
    ]
  },
  {
    "id": "6043d188a20436b2",
    "type": "function",
    "z": "8e71ad1d725a1c4b",
    "name": "Rectangle Geofence Check",
    "func": "const geoArea = global.get('geofence_geoArea');\n// node.warn(\"Rectangle geofence retrieved: \" + JSON.stringify(geoArea));\n\n// Check if the geofence values are set\nif (!geoArea || geoArea.length !== 4) {\n    node.status({\n        fill: \"yellow\", \n        shape: \"dot\", \n        text: \"Geofence not set\"\n    });\n    msg.payload = \"Geofence not set\";\n    msg.result = false;\n    return msg;\n}\n\nconst latitude = msg.payload.latitude;\nconst longitude = msg.payload.longitude;\n// node.warn(\"Checking point: \" + JSON.stringify({lat: latitude, lon: longitude}));\n\nconst [sw, nw, ne, se] = geoArea;\n\nif (latitude >= sw.lat && latitude <= nw.lat && longitude >= sw.lng && longitude <= se.lng) {\n    node.status({\n        fill: \"green\", \n        shape: \"dot\", \n        text: \"Inside geofence\"\n    });\n    msg.payload = \"Inside geofence\";\n    msg.result = false;\n} else {\n    node.status({\n        fill: \"red\", \n        shape: \"dot\", \n        text: \"Outside geofence\"\n    });\n    msg.payload = \"Outside geofence\";\n    msg.result = true;\n}\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 260,
    "y": 140,
    "wires": [
      [
        "60dcdf32abc3caca"
      ]
    ]
  },
  {
    "id": "08675c9954291a36",
    "type": "function",
    "z": "8e71ad1d725a1c4b",
    "name": "Polygon Geofence Check",
    "func": "const geoPolygon = global.get('geofence_geoPolygon');\n// node.warn(\"Polygon geofence retrieved: \" + JSON.stringify(geoPolygon));\n\n// Check if the geofence values are set\nif (!geoPolygon || geoPolygon.length < 3) {\n    node.status({\n        fill: \"yellow\", \n        shape: \"dot\", \n        text: \"Geofence not set\"\n    });\n    msg.payload = \"Geofence not set\";\n    msg.result = false;\n    return msg;\n}\n\nconst latitude = msg.payload.latitude;\nconst longitude = msg.payload.longitude;\n// node.warn(\"Checking point: \" + JSON.stringify({lat: latitude, lon: longitude}));\n\nfunction pointInPolygon(point, vs) {\n    const x = point[0], y = point[1];\n\n    let inside = false;\n    for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {\n        const xi = vs[i][0], yi = vs[i][1];\n        const xj = vs[j][0], yj = vs[j][1];\n\n        const intersect = ((yi > y) != (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n\n    return inside;\n}\n\n// Convert polygon points to array of arrays\nconst polygonPoints = geoPolygon.map(point => [point.lat, point.lng]);\n\n// Check if the point is inside the polygon\nconst isInside = pointInPolygon([latitude, longitude], polygonPoints);\n\nif (isInside) {\n    node.status({\n        fill: \"green\", \n        shape: \"dot\", \n        text: \"Inside geofence\"\n    });\n    msg.payload = \"Inside geofence\";\n    msg.result = false;\n} else {\n    node.status({\n        fill: \"red\", \n        shape: \"dot\", \n        text: \"Outside geofence\"\n    });\n    msg.payload = \"Outside geofence\";\n    msg.result = true;\n}\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 250,
    "y": 200,
    "wires": [
      [
        "60dcdf32abc3caca"
      ]
    ]
  },
  {
    "id": "56ab0313b569ca75",
    "type": "status",
    "z": "8e71ad1d725a1c4b",
    "name": "",
    "scope": null,
    "x": 570,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "60dcdf32abc3caca",
    "type": "function",
    "z": "8e71ad1d725a1c4b",
    "name": "return result only",
    "func": "return {\n    payload: msg.result\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 530,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "5e9440fabfd2da69",
    "type": "inject",
    "z": "38e9748a918c1e10",
    "name": "onstartup",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "5",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 130,
    "y": 160,
    "wires": [
      [
        "f5ab1fc12799c8ed"
      ]
    ]
  },
  {
    "id": "f5ab1fc12799c8ed",
    "type": "function",
    "z": "38e9748a918c1e10",
    "name": "Generate precipitation, address, geomorphology, hydrological data",
    "func": "var rainfall = {\n    payload: Math.random() * 100,\n    topic: \"rainfall\"\n};\n\nvar rockType = {\n    payload: Math.random() * 100,\n    topic: \"rockType\"\n};\n\nvar faultActivity = {\n    payload: Math.random() * 20,\n    topic: \"faultActivity\"\n};\n\nvar slope = {\n    payload: Math.random() * 50,\n    topic: \"slope\"\n};\n\nvar terrainChange = {\n    payload: Math.random() * 100,\n    topic: \"terrainChange\"\n};\n\nvar surfaceWaterFlow = {\n    payload: Math.random() * 100,\n    topic: \"surfaceWaterFlow\"\n};\n\n\n\nvar total = {\n    payload: {\n        rainfall: rainfall.payload,\n        rockType: rockType.payload,\n        faultActivity: faultActivity.payload,\n        slope: slope.payload,\n        terrainChange: terrainChange.payload,\n        surfaceWaterFlow: surfaceWaterFlow.payload,\n    },\n    topic: \"total\"\n};\n\nreturn [rainfall, rockType, faultActivity, slope, terrainChange, surfaceWaterFlow, total];\n",
    "outputs": 7,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 160,
    "wires": [
      [
        "5db0f103b9546827"
      ],
      [
        "15fb2d60fd0e04a0"
      ],
      [
        "2a41badc83a1e603"
      ],
      [
        "da67238f9d4ced60"
      ],
      [
        "773740c8ab9f4651"
      ],
      [
        "3b72256b2d2d247d"
      ],
      [
        "69e83088031bdcec"
      ]
    ]
  },
  {
    "id": "1149f0a0b9fd843e",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "rainfall",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "5edb4c8f76a82f6a",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "rockType",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "0693edfe70c78b67",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "faultActivity",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "54fbd230597f32cc",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "slope",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "f9708d2c3af3b53f",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "terrainChange",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "5f7a3634e1d812be",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "surfaceWaterFlow",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "64a108e017924245",
    "type": "change",
    "z": "38e9748a918c1e10",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "total",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1320,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "5db0f103b9546827",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "rainfall",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 60,
    "wires": [
      [
        "1149f0a0b9fd843e"
      ]
    ]
  },
  {
    "id": "15fb2d60fd0e04a0",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "rockType",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 100,
    "wires": [
      [
        "5edb4c8f76a82f6a"
      ]
    ]
  },
  {
    "id": "2a41badc83a1e603",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "faultActivity",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 140,
    "wires": [
      [
        "0693edfe70c78b67"
      ]
    ]
  },
  {
    "id": "da67238f9d4ced60",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "slope",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 180,
    "wires": [
      [
        "54fbd230597f32cc"
      ]
    ]
  },
  {
    "id": "773740c8ab9f4651",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "terrainChange",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 220,
    "wires": [
      [
        "f9708d2c3af3b53f"
      ]
    ]
  },
  {
    "id": "3b72256b2d2d247d",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "surfaceWaterFlow",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 260,
    "wires": [
      [
        "5f7a3634e1d812be"
      ]
    ]
  },
  {
    "id": "6b7f3b83a2935fa2",
    "type": "switch",
    "z": "38e9748a918c1e10",
    "name": "",
    "property": "total",
    "propertyType": "env",
    "rules": [
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1150,
    "y": 300,
    "wires": [
      [
        "64a108e017924245"
      ]
    ]
  },
  {
    "id": "69e83088031bdcec",
    "type": "function",
    "z": "38e9748a918c1e10",
    "name": "Calculate the risk of geological disasters",
    "func": "var data = msg.payload;\nvar geoRisk = (data.rainfall * 0.3 + data.rockType * 0.2 + data.faultActivity * 0.2 + data.slope * 0.2 + data.terrainChange * 0.1);\nmsg.payload = geoRisk;\n\n// Keep two decimal places\nmsg.payload = parseFloat(msg.payload.toFixed(2));\n\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 900,
    "y": 300,
    "wires": [
      [
        "6b7f3b83a2935fa2"
      ]
    ]
  },
  {
    "id": "3c0fed2eb2400e17",
    "type": "ui-template",
    "z": "24744a865787dab5",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "processed preview ui",
    "order": 1,
    "width": 0,
    "height": 0,
    "head": "",
    "format": "<template>\n    <div class=\"container\" :style=\"{ height: msg.env.height + 'px' }\">\n        <template v-if=\"msg.payload\">\n            <img class=\"image\" :class=\"{ mirrored: msg.env.mirror }\" :style=\"{ height: msg.env.height + 'px' }\" :src=\"'data:image/jpeg;base64,' + msg.payload\">\n        </template>\n        <template v-else>\n            <div class=\"placeholder\" :style=\"{ height: msg.env.height + 'px' }\">\n                no image\n            </div>\n        </template>\n    </div>\n</template>\n\n<style scoped>\n.container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n}\n\n.image {\n    width: auto; /* 确保图片宽度根据内容自适应 */\n}\n\n.mirrored {\n    transform: scaleX(-1); /* 水平翻转图像 */\n}\n\n.placeholder {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    font-size: 24px;\n    border: 1px solid #ccc;\n}\n</style>\n",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 980,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "25ab445582af8af5",
    "type": "function",
    "z": "24744a865787dab5",
    "name": "delete image's base64 header, if input contains",
    "func": "// 获取msg.payload\nvar payload = msg.payload;\n\n// 检查msg.payload是否以'data:image/jpeg;base64,'开头\nif (payload.startsWith('data:image/jpeg;base64,')) {\n    // 去掉开头的'data:image/jpeg;base64,'\n    payload = payload.substring('data:image/jpeg;base64,'.length);\n}\n\n// 更新msg.payload\nmsg.payload = payload;\n\n// 返回msg对象\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 380,
    "y": 140,
    "wires": [
      [
        "9c4a94790c70b5ab"
      ]
    ]
  },
  {
    "id": "6b8f8035357f4902",
    "type": "function",
    "z": "24744a865787dab5",
    "name": "counting",
    "func": "// Initialize flow variable if not already initialized\nif (typeof flow.get('count') === 'undefined') {\n    flow.set('count', 0);\n}\n\n// Get the current count\nlet count = flow.get('count');\n\n// Increment the count\ncount += 1;\n\n// Update the count in the flow context\nflow.set('count', count);\n\n// Set the count in the message payload\nmsg.payload = 'sent images: ' + count;\n\n// Return the message\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 220,
    "y": 320,
    "wires": [
      [
        "53efe0a905a0143c"
      ]
    ]
  },
  {
    "id": "53efe0a905a0143c",
    "type": "function",
    "z": "24744a865787dab5",
    "name": "summary status",
    "func": "return {\n    payload: {\n        fill: \"green\",\n        shape: \"dot\",\n        text: msg.payload\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "node.send({\n    payload: {\n        fill: \"grey\",\n        shape: \"dot\",\n        text: 'no image input'\n    }\n});",
    "finalize": "",
    "libs": [],
    "x": 400,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "9c4a94790c70b5ab",
    "type": "change",
    "z": "24744a865787dab5",
    "name": "get and pass env vars",
    "rules": [
      {
        "t": "set",
        "p": "env.height",
        "pt": "msg",
        "to": "height",
        "tot": "env",
        "dc": true
      },
      {
        "t": "set",
        "p": "env.mirror",
        "pt": "msg",
        "to": "mirror",
        "tot": "env",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 720,
    "y": 140,
    "wires": [
      [
        "3c0fed2eb2400e17"
      ]
    ]
  },
  {
    "id": "27b6288f430f7417",
    "type": "inject",
    "z": "24744a865787dab5",
    "name": "on startup, set the default no image view",
    "props": [
      {
        "p": "payload"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "payload": "false",
    "payloadType": "bool",
    "x": 400,
    "y": 80,
    "wires": [
      [
        "9c4a94790c70b5ab"
      ]
    ]
  },
  {
    "id": "5f1a254d4658f374",
    "type": "mqtt in",
    "z": "ff55010600100001",
    "name": "Subscribe route online state",
    "topic": "msh/seeed/2/stat/+",
    "qos": "0",
    "datatype": "utf8",
    "broker": "${mqtt-broker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 260,
    "y": 160,
    "wires": [
      [
        "9e8f4a0ffd0eda44"
      ]
    ]
  },
  {
    "id": "9e8f4a0ffd0eda44",
    "type": "function",
    "z": "ff55010600100001",
    "name": "get online route id",
    "func": "let topic = msg.topic;\nlet outputMsg = {\n    payload: {\n        routeid: 0,\n        state: false\n    }\n};\n\nlet originalRouteId = topic.split('/')[4];\n\nlet processed = originalRouteId.replace(/[^a-z0-9]/g, '');\nlet decimalValue = parseInt(processed, 16);\n\n\nif (msg.payload === 'online') {\n    outputMsg.payload.routeid = decimalValue;\n    outputMsg.payload.state = true;\n    flow.set(\"currentRouteId\", decimalValue);\n    flow.set(\"currentRouteState\", true);\n    global.set(\"currentRouteId\", decimalValue);\n    global.set(\"currentRouteState\", true);\n    return {\n        topic: outputMsg.payload.routeid,\n        payload: outputMsg.payload.state\n    };\n} else if (msg.payload === 'offline') {\n    if (global.get(\"currentRouteId\") == decimalValue) {\n        outputMsg.payload.routeid = 0;\n        outputMsg.payload.state = false;\n        flow.set(\"currentRouteId\", 0);\n        flow.set(\"currentRouteState\", false);\n        global.set(\"currentRouteId\", 0);\n        global.set(\"currentRouteState\", false);\n        return {\n            topic: outputMsg.payload.routeid,\n            payload: outputMsg.payload.state\n        };\n    } else {\n        return null;\n    }\n} else {\n    return null;\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 570,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "c392a41fd52b31fe",
    "type": "inject",
    "z": "ff55010600100001",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "x": 230,
    "y": 80,
    "wires": [
      [
        "5c9eedc434bd084a"
      ]
    ]
  },
  {
    "id": "5c9eedc434bd084a",
    "type": "change",
    "z": "ff55010600100001",
    "name": "init flow envs",
    "rules": [
      {
        "t": "set",
        "p": "currentRouteId",
        "pt": "flow",
        "to": "0",
        "tot": "num"
      },
      {
        "t": "set",
        "p": "currentRouteState",
        "pt": "flow",
        "to": "false",
        "tot": "bool"
      },
      {
        "t": "set",
        "p": "currentRouteId",
        "pt": "global",
        "to": "0",
        "tot": "num"
      },
      {
        "t": "set",
        "p": "currentRouteState",
        "pt": "global",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 550,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "5b54f9c21e1e18cf",
    "type": "status",
    "z": "ff55010600100001",
    "name": "",
    "scope": [
      "5f1a254d4658f374"
    ],
    "x": 570,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "74c8d76f73804762",
    "type": "function",
    "z": "c331a93ea0d418b4",
    "name": "Meshtastic Decoder",
    "func": "// Function to check if an object is valid JSON\nfunction isValidJsonObject(obj) {\n    try {\n        JSON.stringify(obj);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n// Check if the payload is a valid JSON string or a JSON object\nif (typeof msg.payload === 'string' && isValidJsonObject(JSON.parse(msg.payload))) {\n    // Parse the JSON message if it's a string\n    msg.payload = JSON.parse(msg.payload);\n} else if (typeof msg.payload === 'object' && isValidJsonObject(msg.payload)) {\n    // Do nothing if it's already a JSON object\n} else {\n    // Ignore invalid JSON strings or objects\n    return [null, null, null, null, null];\n}\n\nlet decoded = msg.payload;\n\nlet positionMsg = null;\nlet textMsg = null;\nlet telemetryMsg = null;\nlet emptyTypeMsg = null;\nlet unknownTypeMsg = null;\n\n// Process different types of messages\nif (decoded.type === \"position\") {\n    if (decoded.payload.latitude_i !== 0 && decoded.payload.longitude_i !== 0) {\n        positionMsg = {\n            payload: {\n                type: \"position\",\n                channel: decoded.channel,\n                from: decoded.from,\n                hop_start: decoded.hop_start,\n                hops_away: decoded.hops_away,\n                id: decoded.id,\n                latitude: decoded.payload.latitude_i,\n                longitude: decoded.payload.longitude_i,\n                PDOP: decoded.payload.PDOP,\n                altitude: decoded.payload.altitude,\n                ground_track: decoded.payload.ground_track,\n                precision_bits: decoded.payload.precision_bits,\n                sats_in_view: decoded.payload.sats_in_view,\n                time: decoded.payload.time,\n                rssi: decoded.rssi,\n                snr: decoded.snr,\n                sender: decoded.sender,\n                timestamp: decoded.timestamp,\n                to: decoded.to\n            }\n        };\n    }\n} else if (decoded.type === \"text\") {\n    var chatmessage = \"\";\n    if (decoded.payload.text && decoded.payload.text.includes(\"\\u0000\")) {\n        chatmessage = \"( Unsupported text content format )\";\n    } else {\n        chatmessage = decoded.payload.text || decoded.payload;\n    }\n\n    textMsg = {\n        payload: {\n            type: \"text\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            text: chatmessage,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"telemetry\") {\n    telemetryMsg = {\n        payload: {\n            type: \"telemetry\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            air_util_tx: decoded.payload.air_util_tx,\n            battery_level: decoded.payload.battery_level,\n            channel_utilization: decoded.payload.channel_utilization,\n            uptime_seconds: decoded.payload.uptime_seconds,\n            voltage: decoded.payload.voltage,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"\") {\n    emptyTypeMsg = {\n        payload: {\n            type: \"\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            rssi: decoded.rssi,\n            sender: decoded.sender,\n            snr: decoded.snr,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else {\n    unknownTypeMsg = {\n        payload: {\n            type: \"unknown\",\n            raw: decoded\n        }\n    };\n}\n\nreturn [positionMsg, textMsg, telemetryMsg, emptyTypeMsg, unknownTypeMsg];\n",
    "outputs": 5,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 560,
    "y": 100,
    "wires": [
      [],
      [
        "9ebe95fbfa40c393"
      ],
      [],
      [],
      []
    ]
  },
  {
    "id": "5d6d30f1d583c1aa",
    "type": "mqtt in",
    "z": "c331a93ea0d418b4",
    "name": "Subscribe meshtastic message",
    "topic": "msh/seeed/2/json/#",
    "qos": "0",
    "datatype": "json",
    "broker": "${mqtt-broker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 270,
    "y": 100,
    "wires": [
      [
        "74c8d76f73804762"
      ]
    ]
  },
  {
    "id": "9ebe95fbfa40c393",
    "type": "function",
    "z": "c331a93ea0d418b4",
    "name": "wrap chat message",
    "func": "var chatUsername = msg.payload.from.toString(16).slice(-4);\nvar chatMessage = msg.payload.text;\n\nreturn {\n    topic: chatUsername,\n    payload: chatMessage\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 790,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "cc68c7211e329ee0",
    "type": "status",
    "z": "c331a93ea0d418b4",
    "name": "",
    "scope": [
      "5d6d30f1d583c1aa"
    ],
    "x": 790,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "5872a66485b62222",
    "type": "function",
    "z": "15e3d881bcd13372",
    "name": "set chat message",
    "func": "var firstLineText = env.get(\"firstLineText\");\nvar prefixText = env.get(\"prefixText\");\nvar suffixText = env.get(\"suffixText\");\n\nvar toSendMessage = '';\nvar inputMessage = msg.payload;\n\nif(firstLineText) {\n    toSendMessage += firstLineText;\n    \n    if (typeof inputMessage === 'string' && inputMessage.trim().length > 0) {\n        toSendMessage += '\\n';\n    }\n}\n\ntoSendMessage += prefixText;\ntoSendMessage += inputMessage;\ntoSendMessage += suffixText;\n\nreturn {\n    payload: {\n        // your meshtastic route id\n        \"from\": global.get(\"currentRouteId\"),\n        \"type\": \"sendtext\",\n        \"payload\": toSendMessage\n    }\n}",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 230,
    "y": 80,
    "wires": [
      [
        "4107e606d6030695"
      ]
    ]
  },
  {
    "id": "4107e606d6030695",
    "type": "mqtt out",
    "z": "15e3d881bcd13372",
    "name": "send a downlink message to meshtastic channel",
    "topic": "msh/seeed/2/json/mqtt/",
    "qos": "0",
    "retain": "false",
    "respTopic": "",
    "contentType": "",
    "userProps": "",
    "correl": "",
    "expiry": "",
    "broker": "${mqtt-broker}",
    "x": 540,
    "y": 80,
    "wires": []
  },
  {
    "id": "0a4a0cebe01e9bab",
    "type": "status",
    "z": "15e3d881bcd13372",
    "name": "",
    "scope": [
      "4107e606d6030695"
    ],
    "x": 550,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "6842503887995176",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "g": "e5814d054eae8048",
    "name": "depend on accuracy",
    "property": "accuracy",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "low",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "medium",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "high",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 2020,
    "y": 780,
    "wires": [
      [
        "09f9f99a2de46ed5"
      ],
      [
        "678f2517e5e8f360"
      ],
      [
        "b543a5489b7db3b9"
      ]
    ]
  },
  {
    "id": "b543a5489b7db3b9",
    "type": "delay",
    "z": "db0357a026e3fe9d",
    "g": "e5814d054eae8048",
    "name": "",
    "pauseType": "delay",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 2220,
    "y": 820,
    "wires": [
      [
        "0f4d7859be6d8074"
      ]
    ]
  },
  {
    "id": "678f2517e5e8f360",
    "type": "delay",
    "z": "db0357a026e3fe9d",
    "g": "e5814d054eae8048",
    "name": "",
    "pauseType": "delay",
    "timeout": "2",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 2220,
    "y": 780,
    "wires": [
      [
        "0f4d7859be6d8074"
      ]
    ]
  },
  {
    "id": "09f9f99a2de46ed5",
    "type": "delay",
    "z": "db0357a026e3fe9d",
    "g": "e5814d054eae8048",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 2220,
    "y": 740,
    "wires": [
      [
        "0f4d7859be6d8074"
      ]
    ]
  },
  {
    "id": "0f4d7859be6d8074",
    "type": "change",
    "z": "db0357a026e3fe9d",
    "d": true,
    "g": "e5814d054eae8048",
    "name": "unblock",
    "rules": [
      {
        "t": "set",
        "p": "object_detection_is_block",
        "pt": "flow",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2400,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "4cc9810beb057ce1",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.1",
    "absolutePathDir": "",
    "x": 1110,
    "y": 60,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "8ca81b01323d0223",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "tidy message",
    "func": "var payload = msg.payload;\nvar originImg = payload.originImg;\n\nvar detectObject = env.get(\"detectObject\");\nvar detections = payload.data[detectObject];\n\n// 将 Buffer 转换为 Base64\n\nmsg.payload = {\n    imageBuffer: originImg,\n    detections: detections\n};\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1610,
    "y": 620,
    "wires": [
      [
        "5f4428b940c5bf31",
        "8df1bae56c96b08c"
      ]
    ]
  },
  {
    "id": "5f4428b940c5bf31",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "draw box",
    "func": "const imageBuffer = msg.payload.imageBuffer;\nconst detections = msg.payload.detections;\n\n(async function processImage() {\n    try {\n        let image = sharp(imageBuffer);\n        const metadata = await image.metadata();\n\n        let svgContent = `\n            <svg width=\"${metadata.width}\" height=\"${metadata.height}\" xmlns=\"http://www.w3.org/2000/svg\">\n        `;\n\n        detections.forEach(det => {\n            const x = det.x;\n            const y = det.y;\n            const w = det.w;\n            const h = det.h;\n            const prob = det.prob;\n\n            // Convert confidence to percentage and round to an integer\n            const probPercentage = Math.round(prob * 100);\n            const label = `people ${probPercentage}%`;\n\n            // Measure the text width dynamically\n            const textWidth = label.length * 8; // Approximate width: 8 pixels per character\n\n            // Add rectangle and text with background to SVG content\n            svgContent += `\n                <rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${h}\" fill=\"none\" stroke=\"red\" stroke-width=\"2\"/>\n                <rect x=\"${x}\" y=\"${y - 20}\" width=\"${textWidth + 4}\" height=\"20\" fill=\"rgba(255, 0, 0, 0.5)\"/>\n                <text x=\"${x + 2}\" y=\"${y - 5}\" font-family=\"Arial\" font-size=\"12\" fill=\"white\">${label}</text>\n            `;\n        });\n\n        svgContent += `</svg>`;\n\n        const svgBuffer = Buffer.from(svgContent);\n\n        image = await image\n            .composite([{ input: svgBuffer, top: 0, left: 0 }])\n            .toBuffer();\n\n        const src = image.toString('base64');\n        if(src){\n        msg.payload = src;\n        }else{\n            msg.payload = imageBuffer.toString('base64')\n        }\n        node.send(msg);\n    } catch (err) {\n        // node.warn(\"Error processing image: \" + err.message);\n        // msg.payload = msg.payload.image.toString('base64'); // Send original image\n        // node.send(msg);\n    }\n})();\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [
      {
        "var": "jimp",
        "module": "jimp"
      },
      {
        "var": "sharp",
        "module": "sharp"
      }
    ],
    "x": 1800,
    "y": 620,
    "wires": [
      [
        "6842503887995176"
      ]
    ]
  },
  {
    "id": "924b7001efd94ca5",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.1",
    "absolutePathDir": "",
    "x": 1110,
    "y": 460,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "8b26f5ebb300a09e",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.1",
    "absolutePathDir": "",
    "x": 1110,
    "y": 860,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "fd67ba63b7633538",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "depend on accuracy",
    "property": "accuracy",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "low",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "medium",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "high",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 640,
    "y": 620,
    "wires": [
      [
        "6263a3b406ed611a"
      ],
      [
        "c24362c677babd77"
      ],
      [
        "bef8f3fe1877249a"
      ]
    ]
  },
  {
    "id": "1bdb545ad0c231d1",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.2",
    "absolutePathDir": "",
    "x": 1110,
    "y": 100,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "e57b7d5758a55de9",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.3",
    "absolutePathDir": "",
    "x": 1110,
    "y": 140,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "d84bc85ca0a98635",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.4",
    "absolutePathDir": "",
    "x": 1110,
    "y": 180,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "62d4683b1fc2cc06",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.5",
    "absolutePathDir": "",
    "x": 1110,
    "y": 220,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "ca3f1644744d9130",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.6",
    "absolutePathDir": "",
    "x": 1110,
    "y": 260,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "8f236a0ce7736a67",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.7",
    "absolutePathDir": "",
    "x": 1110,
    "y": 300,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "161e7e63771837c3",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.8",
    "absolutePathDir": "",
    "x": 1110,
    "y": 340,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "a79b1d0e0933bbcd",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8n",
    "threshold": "0.9",
    "absolutePathDir": "",
    "x": 1110,
    "y": 380,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "b7bfdb04c96a8c7e",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.2",
    "absolutePathDir": "",
    "x": 1110,
    "y": 500,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "7179f7629c37b417",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.3",
    "absolutePathDir": "",
    "x": 1110,
    "y": 540,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "b1ef1e51b44e0b4d",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.4",
    "absolutePathDir": "",
    "x": 1110,
    "y": 580,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "60e60dc505d059f2",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.5",
    "absolutePathDir": "",
    "x": 1110,
    "y": 620,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "7e800305f9499c3d",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.6",
    "absolutePathDir": "",
    "x": 1110,
    "y": 660,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "1cac76d5a83ba664",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.7",
    "absolutePathDir": "",
    "x": 1110,
    "y": 700,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "7baf00e00fb3d165",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.8",
    "absolutePathDir": "",
    "x": 1110,
    "y": 740,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "5e6cdd3fbf116072",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8s",
    "threshold": "0.9",
    "absolutePathDir": "",
    "x": 1110,
    "y": 780,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "9e17c4c34c7b5c44",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.2",
    "absolutePathDir": "",
    "x": 1110,
    "y": 900,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "7539db75ab464661",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.3",
    "absolutePathDir": "",
    "x": 1110,
    "y": 940,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "4d480d861e612286",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.4",
    "absolutePathDir": "",
    "x": 1110,
    "y": 980,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "17a7a5cd00355553",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.5",
    "absolutePathDir": "",
    "x": 1110,
    "y": 1020,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "acb8b71da47fa23a",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.6",
    "absolutePathDir": "",
    "x": 1110,
    "y": 1060,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "c6e89ed70aa495f0",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.7",
    "absolutePathDir": "",
    "x": 1110,
    "y": 1100,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "c95290edc8b467c0",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.8",
    "absolutePathDir": "",
    "x": 1110,
    "y": 1140,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "58e13e024d448eaa",
    "type": "good-object-detection",
    "z": "db0357a026e3fe9d",
    "name": "",
    "returnValue": "0",
    "model": "yolov8m",
    "threshold": "0.9",
    "absolutePathDir": "",
    "x": 1110,
    "y": 1180,
    "wires": [
      [
        "dc88fe07cfda2ae6"
      ]
    ]
  },
  {
    "id": "6263a3b406ed611a",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "confidence",
    "property": "confidence",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "10%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "20%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "30%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "40%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "50%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "60%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "70%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "80%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "90%",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 9,
    "x": 870,
    "y": 220,
    "wires": [
      [
        "4cc9810beb057ce1"
      ],
      [
        "1bdb545ad0c231d1"
      ],
      [
        "e57b7d5758a55de9"
      ],
      [
        "d84bc85ca0a98635"
      ],
      [
        "62d4683b1fc2cc06"
      ],
      [
        "ca3f1644744d9130"
      ],
      [
        "8f236a0ce7736a67"
      ],
      [
        "161e7e63771837c3"
      ],
      [
        "a79b1d0e0933bbcd"
      ]
    ]
  },
  {
    "id": "c24362c677babd77",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "confidence",
    "property": "confidence",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "10%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "20%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "30%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "40%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "50%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "60%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "70%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "80%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "90%",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 9,
    "x": 870,
    "y": 620,
    "wires": [
      [
        "924b7001efd94ca5"
      ],
      [
        "b7bfdb04c96a8c7e"
      ],
      [
        "7179f7629c37b417"
      ],
      [
        "b1ef1e51b44e0b4d"
      ],
      [
        "60e60dc505d059f2"
      ],
      [
        "7e800305f9499c3d"
      ],
      [
        "1cac76d5a83ba664"
      ],
      [
        "7baf00e00fb3d165"
      ],
      [
        "5e6cdd3fbf116072"
      ]
    ]
  },
  {
    "id": "bef8f3fe1877249a",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "confidence",
    "property": "confidence",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "10%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "20%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "30%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "40%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "50%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "60%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "70%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "80%",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "90%",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 9,
    "x": 870,
    "y": 1020,
    "wires": [
      [
        "8b26f5ebb300a09e"
      ],
      [
        "9e17c4c34c7b5c44"
      ],
      [
        "7539db75ab464661"
      ],
      [
        "4d480d861e612286"
      ],
      [
        "17a7a5cd00355553"
      ],
      [
        "acb8b71da47fa23a"
      ],
      [
        "c6e89ed70aa495f0"
      ],
      [
        "c95290edc8b467c0"
      ],
      [
        "58e13e024d448eaa"
      ]
    ]
  },
  {
    "id": "dc88fe07cfda2ae6",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "all-in-one",
    "func": "\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1420,
    "y": 620,
    "wires": [
      [
        "8ca81b01323d0223"
      ]
    ]
  },
  {
    "id": "6599187ffa3f22a7",
    "type": "inject",
    "z": "db0357a026e3fe9d",
    "name": "",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "x": 130,
    "y": 540,
    "wires": [
      [
        "943b12013f8cb826"
      ]
    ]
  },
  {
    "id": "943b12013f8cb826",
    "type": "change",
    "z": "db0357a026e3fe9d",
    "d": true,
    "name": "unblock",
    "rules": [
      {
        "t": "set",
        "p": "object_detection_is_block",
        "pt": "flow",
        "to": "false",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 300,
    "y": 540,
    "wires": [
      []
    ]
  },
  {
    "id": "8a351d2fe6cf41a6",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "if base64, convert to buffer",
    "func": "if (typeof msg.payload === 'string' && msg.payload.length % 4 === 0 && /^[A-Za-z0-9+/]+[=]{0,2}$/.test(msg.payload)) {\n    try {\n        msg.payload = Buffer.from(msg.payload, 'base64');\n    } catch (e) {\n        return msg;\n    }\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 400,
    "y": 660,
    "wires": [
      [
        "fd67ba63b7633538",
        "cd1b3a88fe1625f4"
      ]
    ]
  },
  {
    "id": "112bd9434fbbd5f1",
    "type": "status",
    "z": "db0357a026e3fe9d",
    "name": "",
    "scope": null,
    "x": 1970,
    "y": 1320,
    "wires": [
      []
    ]
  },
  {
    "id": "8df1bae56c96b08c",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "Change the format to a uniform format",
    "func": "const originResult = msg.payload.detections;\n\nconst handledResult = [];\n// for (let i = 0; i < originResult.length; i++) {\n//   const item = originResult[i];\n//   handledResult.push([\n//     Math.round(item.x),\n//     Math.round(item.y),\n//     Math.round(item.w),\n//     Math.round(item.h),\n//     Math.round(item.prob * 100),\n//     0\n//   ]);\n// }\n\nreturn {\n    payload: [0,0,0,0,0]\n}\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1890,
    "y": 920,
    "wires": [
      [
        "781f8497148592e9"
      ]
    ]
  },
  {
    "id": "781f8497148592e9",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "Check if the target is detected",
    "func": "if (Array.isArray(msg.payload)) {\n    var length = msg.payload.length;\n    if (length > 1) {\n        msg.payload = 1;\n    } else if (length === 0) {\n        msg.payload = 0;\n    } else {\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = 0;\n}\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1630,
    "y": 1040,
    "wires": [
      [
        "f1a60136981a081e"
      ]
    ]
  },
  {
    "id": "f1a60136981a081e",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "yes or no",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1860,
    "y": 1040,
    "wires": [
      [
        "203628dce3e52008"
      ],
      [
        "5281469c32ebaa36"
      ]
    ]
  },
  {
    "id": "203628dce3e52008",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "",
    "property": "triggerMode",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "yes",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1990,
    "y": 1000,
    "wires": [
      [
        "7b1d5ceaabf82e41"
      ]
    ]
  },
  {
    "id": "5281469c32ebaa36",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "",
    "property": "triggerMode",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "no",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1990,
    "y": 1080,
    "wires": [
      [
        "a1aa1633b40cbc7f"
      ]
    ]
  },
  {
    "id": "7b1d5ceaabf82e41",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "true",
    "func": "return {\n    payload: true\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2130,
    "y": 1000,
    "wires": [
      []
    ]
  },
  {
    "id": "a1aa1633b40cbc7f",
    "type": "function",
    "z": "db0357a026e3fe9d",
    "name": "false",
    "func": "return {\n    payload: true\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2130,
    "y": 1080,
    "wires": [
      []
    ]
  },
  {
    "id": "cd1b3a88fe1625f4",
    "type": "change",
    "z": "db0357a026e3fe9d",
    "d": true,
    "name": "block",
    "rules": [
      {
        "t": "set",
        "p": "object_detection_is_block",
        "pt": "flow",
        "to": "true",
        "tot": "bool"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 590,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "5c8de64d35533184",
    "type": "switch",
    "z": "db0357a026e3fe9d",
    "name": "not block",
    "property": "object_detection_is_block",
    "propertyType": "flow",
    "rules": [
      {
        "t": "false"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 170,
    "y": 851,
    "wires": [
      []
    ]
  },
  {
    "id": "21d0619968752bc5",
    "type": "inject",
    "z": "a71c1f4952addcd7",
    "name": "onstartup",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "5",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 150,
    "y": 160,
    "wires": [
      [
        "fd1aa19957fe5a3e",
        "a9a81e691d68d988",
        "436dac51e46180d8",
        "d1f3ac7a166ead8d"
      ]
    ]
  },
  {
    "id": "fd1aa19957fe5a3e",
    "type": "random",
    "z": "a71c1f4952addcd7",
    "name": "Solar voltage value (placeholder)",
    "low": "8",
    "high": "13",
    "inte": "false",
    "property": "payload",
    "x": 420,
    "y": 80,
    "wires": [
      [
        "a9a81e691d68d988",
        "e00aad24bc1ea0c0"
      ]
    ]
  },
  {
    "id": "a9a81e691d68d988",
    "type": "range",
    "z": "a71c1f4952addcd7",
    "minin": "8",
    "maxin": "13",
    "minout": "70",
    "maxout": "180",
    "action": "scale",
    "round": true,
    "property": "payload",
    "name": "Power of charge",
    "x": 360,
    "y": 140,
    "wires": [
      [
        "506c2695b3dcac2a"
      ]
    ]
  },
  {
    "id": "436dac51e46180d8",
    "type": "random",
    "z": "a71c1f4952addcd7",
    "name": "Battery status",
    "low": "22",
    "high": "23",
    "inte": "false",
    "property": "payload",
    "x": 360,
    "y": 200,
    "wires": [
      [
        "899ccd7752f11fc2"
      ]
    ]
  },
  {
    "id": "d1f3ac7a166ead8d",
    "type": "random",
    "z": "a71c1f4952addcd7",
    "name": "Battery discharge",
    "low": "73",
    "high": "73",
    "inte": "false",
    "property": "payload",
    "x": 370,
    "y": 260,
    "wires": [
      [
        "ae2892c04d73113b"
      ]
    ]
  },
  {
    "id": "e00aad24bc1ea0c0",
    "type": "change",
    "z": "a71c1f4952addcd7",
    "name": "to 2 decimal places",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$round(payload * 100) / 100",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "506c2695b3dcac2a",
    "type": "change",
    "z": "a71c1f4952addcd7",
    "name": "to 2 decimal places",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$round(payload * 100) / 100",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "899ccd7752f11fc2",
    "type": "change",
    "z": "a71c1f4952addcd7",
    "name": "to 2 decimal places",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$round(payload * 100) / 100",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "ae2892c04d73113b",
    "type": "change",
    "z": "a71c1f4952addcd7",
    "name": "to 2 decimal places",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "$round(payload * 100) / 100",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 690,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "cc379f45cd70a2bb",
    "type": "function",
    "z": "61d68b31136dfa92",
    "name": "Address Converter",
    "func": "// Function to normalize the environment variables (convert to lowercase)\nfunction normalizeEnvVar(value) {\n    if (value===true || value===false){\n        return value;\n    }\n    return value ? value.toLowerCase() : \"\";\n}\n\n// Retrieve and normalize the environment variables\nvar lightColor = normalizeEnvVar(env.get(\"LIGHT_COLOR\"));\nvar lightMode = normalizeEnvVar(env.get(\"LIGHT_MODE\"));\n\nvar value = 0x00;\nvar notification = \"\";\n\n// Define the mapping\nif (lightMode === 'off') {\n    value = 0x60;\n} else if (lightColor === \"red\") {\n    if (lightMode === \"blink\") {\n        value = 0x21;\n    } else if (lightMode === \"flashing\") {\n        value = 0x31;\n    } else if (lightMode === \"on\") {\n        value = 0x11;\n    } else {\n    }\n} else if (lightColor === \"green\") {\n    if (lightMode === \"blink\") {\n        value = 0x23;\n    } else if (lightMode === \"flashing\") {\n        value = 0x33;\n    } else if (lightMode === \"on\") {\n        value = 0x13;\n    } else {\n    }\n} else if (lightColor === \"yellow\") {\n    if (lightMode === \"blink\") {\n        value = 0x22;\n    } else if (lightMode === \"flashing\") {\n        value = 0x32;\n    } else if (lightMode === \"on\") {\n        value = 0x12;\n    } else {\n    }\n} else {\n}\n\n// Convert the hexadecimal value to decimal\nvar decimalValue = value;\n\n// Set the output message\nif (notification) {\n    msg.payload = notification;\n} else {\n    msg.payload = decimalValue;\n}\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 210,
    "y": 80,
    "wires": [
      [
        "1300fb3d05071c03"
      ]
    ]
  },
  {
    "id": "bd4190a43e4774e8",
    "type": "modbus-response",
    "z": "61d68b31136dfa92",
    "name": "",
    "registerShowMax": 20,
    "x": 670,
    "y": 80,
    "wires": []
  },
  {
    "id": "1300fb3d05071c03",
    "type": "modbus-write",
    "z": "61d68b31136dfa92",
    "name": "Light Modbus Config",
    "showStatusActivities": true,
    "showErrors": false,
    "showWarnings": true,
    "unitid": "1",
    "dataType": "HoldingRegister",
    "adr": "194",
    "quantity": "1",
    "server": "${modbus-client}",
    "emptyMsgOnFail": false,
    "keepMsgProperties": false,
    "delayOnStart": false,
    "startDelayTime": "5",
    "x": 440,
    "y": 80,
    "wires": [
      [],
      [
        "bd4190a43e4774e8"
      ]
    ]
  },
  {
    "id": "de52d590953c98c7",
    "type": "status",
    "z": "61d68b31136dfa92",
    "name": "",
    "scope": null,
    "x": 670,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "1aac682eea8590eb",
    "type": "catch",
    "z": "61d68b31136dfa92",
    "name": "",
    "scope": null,
    "uncaught": false,
    "x": 660,
    "y": 220,
    "wires": [
      [
        "7a63f74387974b8f"
      ]
    ]
  },
  {
    "id": "7a63f74387974b8f",
    "type": "debug",
    "z": "61d68b31136dfa92",
    "name": "rs485 light controller - control light",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 980,
    "y": 220,
    "wires": []
  },
  {
    "id": "531e23630b5fa7e4",
    "type": "function",
    "z": "b8596ac29abcf525",
    "name": "set volumn",
    "func": "msg.payload = {\n    'unitid': 1,\n    'fc': 6,\n    'quantity': 1,\n    'address': 0x0006,\n    'value': env.get(\"volumn\") || 1 // 1~30\n};\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 530,
    "y": 280,
    "wires": [
      [
        "a4059d176b2a92a7"
      ]
    ]
  },
  {
    "id": "c2be6a5e8de4caff",
    "type": "function",
    "z": "b8596ac29abcf525",
    "name": "play sound",
    "func": "msg.payload = {\n    'unitid': 1,\n    'fc': 6,\n    'quantity': 1,\n    'address': 0x0008,\n    'value': 0x0001, // 1~30\n};\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 690,
    "y": 420,
    "wires": [
      [
        "566fe77c7f7f9bc7"
      ]
    ]
  },
  {
    "id": "29fd66e49dac1ff8",
    "type": "function",
    "z": "b8596ac29abcf525",
    "name": "stop sound",
    "func": "msg.payload = {\n    'unitid': 1,\n    'fc': 6,\n    'quantity': 1,\n    'address': 0x0016,\n    'value': 0x0000, // 1~30\n};\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 690,
    "y": 520,
    "wires": [
      [
        "a59287a8c1b4806c"
      ]
    ]
  },
  {
    "id": "a4059d176b2a92a7",
    "type": "modbus-flex-write",
    "z": "b8596ac29abcf525",
    "name": "",
    "showStatusActivities": true,
    "showErrors": false,
    "showWarnings": true,
    "server": "${modbus-client}",
    "emptyMsgOnFail": false,
    "keepMsgProperties": false,
    "delayOnStart": false,
    "startDelayTime": "5",
    "x": 730,
    "y": 280,
    "wires": [
      [],
      [
        "8a3c6d49b7cde4e0"
      ]
    ]
  },
  {
    "id": "8a3c6d49b7cde4e0",
    "type": "modbus-response",
    "z": "b8596ac29abcf525",
    "name": "",
    "registerShowMax": 20,
    "x": 970,
    "y": 280,
    "wires": []
  },
  {
    "id": "566fe77c7f7f9bc7",
    "type": "modbus-flex-write",
    "z": "b8596ac29abcf525",
    "name": "",
    "showStatusActivities": true,
    "showErrors": false,
    "showWarnings": true,
    "server": "${modbus-client}",
    "emptyMsgOnFail": false,
    "keepMsgProperties": false,
    "delayOnStart": false,
    "startDelayTime": "5",
    "x": 890,
    "y": 420,
    "wires": [
      [],
      [
        "e8157e7719c8cae8"
      ]
    ]
  },
  {
    "id": "e8157e7719c8cae8",
    "type": "modbus-response",
    "z": "b8596ac29abcf525",
    "name": "",
    "registerShowMax": 20,
    "x": 1110,
    "y": 420,
    "wires": []
  },
  {
    "id": "a59287a8c1b4806c",
    "type": "modbus-flex-write",
    "z": "b8596ac29abcf525",
    "name": "",
    "showStatusActivities": true,
    "showErrors": false,
    "showWarnings": true,
    "server": "${modbus-client}",
    "emptyMsgOnFail": false,
    "keepMsgProperties": false,
    "delayOnStart": false,
    "startDelayTime": "5",
    "x": 890,
    "y": 520,
    "wires": [
      [],
      [
        "b6b57e8a2368518e"
      ]
    ]
  },
  {
    "id": "b6b57e8a2368518e",
    "type": "modbus-response",
    "z": "b8596ac29abcf525",
    "name": "",
    "registerShowMax": 20,
    "x": 1110,
    "y": 520,
    "wires": []
  },
  {
    "id": "f25ba559326dccfb",
    "type": "switch",
    "z": "b8596ac29abcf525",
    "name": "action switch",
    "property": "action",
    "propertyType": "env",
    "rules": [
      {
        "t": "eq",
        "v": "play",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "stop",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 470,
    "y": 460,
    "wires": [
      [
        "c2be6a5e8de4caff"
      ],
      [
        "29fd66e49dac1ff8"
      ]
    ]
  },
  {
    "id": "7f7fc470a59b569f",
    "type": "status",
    "z": "b8596ac29abcf525",
    "name": "",
    "scope": null,
    "x": 1030,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "3b5f77c1a5b86b89",
    "type": "inject",
    "z": "b8596ac29abcf525",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "x": 360,
    "y": 280,
    "wires": [
      [
        "531e23630b5fa7e4"
      ]
    ]
  },
  {
    "id": "fcbf6fde33ed01b2",
    "type": "catch",
    "z": "b8596ac29abcf525",
    "name": "",
    "scope": null,
    "uncaught": false,
    "x": 1040,
    "y": 720,
    "wires": [
      [
        "4f9ed8d5827c26af"
      ]
    ]
  },
  {
    "id": "4f9ed8d5827c26af",
    "type": "debug",
    "z": "b8596ac29abcf525",
    "name": "rs485 light controller - control sound",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 1350,
    "y": 720,
    "wires": []
  },
  {
    "id": "54b9a4ed0e9da2db",
    "type": "link out",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "link A",
    "mode": "link",
    "links": [
      "03c368738cc7f8f2",
      "1466bddebcba4155"
    ],
    "x": 410,
    "y": 180,
    "wires": [],
    "l": true
  },
  {
    "id": "d4685d2e3ef9a309",
    "type": "link out",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "link A",
    "mode": "link",
    "links": [
      "03c368738cc7f8f2",
      "1466bddebcba4155"
    ],
    "x": 1040,
    "y": 60,
    "wires": [],
    "l": true
  },
  {
    "id": "03c368738cc7f8f2",
    "type": "link in",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "link A",
    "links": [
      "54b9a4ed0e9da2db",
      "d4685d2e3ef9a309",
      "2649b6e22c4c7042"
    ],
    "x": 200,
    "y": 340,
    "wires": [
      [
        "15333d07b325118d"
      ]
    ],
    "l": true
  },
  {
    "id": "01b6c388adacec9b",
    "type": "comment",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "request pysscma for analyze",
    "info": "",
    "x": 240,
    "y": 280,
    "wires": []
  },
  {
    "id": "d40434e5e9fa984d",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "replay last analyze input message",
    "func": "var lastMsg = flow.get('last_analyze_input')\n\nreturn lastMsg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 820,
    "y": 60,
    "wires": [
      [
        "d4685d2e3ef9a309"
      ]
    ]
  },
  {
    "id": "6e1637526d57a66b",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "storage last analyze input",
    "func": "flow.set('last_analyze_input', msg)",
    "outputs": 0,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 470,
    "y": 140,
    "wires": []
  },
  {
    "id": "f928057a172b6bc7",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "action to set a config to flow env",
    "func": "flow.set(msg.payload.k, msg.payload.v);",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 500,
    "y": 60,
    "wires": [
      [
        "d40434e5e9fa984d"
      ]
    ]
  },
  {
    "id": "b7006d8725379028",
    "type": "switch",
    "z": "0d921b2cdb2f47a8",
    "g": "a39f94d95dd8c901",
    "name": "config or analyze",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "config",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 210,
    "y": 140,
    "wires": [
      [
        "f928057a172b6bc7"
      ],
      [
        "6e1637526d57a66b",
        "54b9a4ed0e9da2db"
      ]
    ]
  },
  {
    "id": "42ee150fd31ac501",
    "type": "comment",
    "z": "0d921b2cdb2f47a8",
    "g": "4cea5da7a6e042b9",
    "name": "take effect config",
    "info": "",
    "x": 200,
    "y": 440,
    "wires": []
  },
  {
    "id": "ea0c0d562f20ce77",
    "type": "delay",
    "z": "0d921b2cdb2f47a8",
    "g": "4cea5da7a6e042b9",
    "name": "limit 1 msg/1s",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 240,
    "y": 500,
    "wires": [
      [
        "ef3714d03835eed0"
      ]
    ]
  },
  {
    "id": "ef3714d03835eed0",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "4cea5da7a6e042b9",
    "name": "build default config",
    "func": "return {\n    topic: 'track_session',\n    payload: {\n        \"tracker_config\": {\n            \"track_thresh\": 0.25,\n            \"track_buffer\": 30,\n            \"match_thresh\": 0.8,\n            \"frame_rate\": 30\n        },\n        \"annotation_config\": {\n            \"resolution\": [\n                240,\n                240\n            ],\n            \"polygon\": {\n                \"thickness\": 1,\n                \"text_scale\": 0.3,\n                \"text_thickness\": 0.5,\n                \"text_padding\": 2\n            },\n            \"bounding_box\": {\n                \"thickness\": 2\n            },\n            \"tracing\": {\n                \"position\": \"CENTER\",\n                \"trace_length\": 30,\n                \"trace_thickness\": 1\n            },\n            \"labeling\": {\n                \"text_scale\": 0.3,\n                \"text_thickness\": 1,\n                \"text_padding\": 3,\n                \"text_position\": \"TOP_LEFT\",\n                \"label_map\": {\n                    \"0\": \"Person\",\n                    \"1\": \"Car\",\n                    \"2\": \"Truck\"\n                }\n            },\n            \"heatmap\": {\n                \"position\": \"BOTTOM_CENTER\",\n                \"opacity\": 0.25,\n                \"radius\": 10,\n                \"kernel_size\": 5\n            }\n        },\n        \"regions_config\": {\n            \"Region_A\": {\n                \"polygon\": [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        240,\n                        0\n                    ],\n                    [\n                        240,\n                        160\n                    ],\n                    [\n                        0,\n                        80\n                    ]\n                ],\n                \"triggering_position\": \"CENTER\"\n            },\n            \"Region_B\": {\n                \"polygon\": [\n                    [\n                        0,\n                        80\n                    ],\n                    [\n                        240,\n                        160\n                    ],\n                    [\n                        240,\n                        240\n                    ],\n                    [\n                        0,\n                        240\n                    ]\n                ],\n                \"triggering_position\": \"CENTER\"\n            }\n        }\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 470,
    "y": 500,
    "wires": [
      [
        "cf49b87ca54fadb6"
      ]
    ]
  },
  {
    "id": "2001f5fb16131c7a",
    "type": "http request",
    "z": "0d921b2cdb2f47a8",
    "g": "4cea5da7a6e042b9",
    "name": "Request modify config",
    "method": "POST",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "http://192.168.100.10:8000",
    "tls": "",
    "persist": true,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [
      {
        "keyType": "Content-Type",
        "keyValue": "",
        "valueType": "application/json",
        "valueValue": ""
      },
      {
        "keyType": "other",
        "keyValue": "Session-Id",
        "valueType": "other",
        "valueValue": "72d6be56"
      }
    ],
    "x": 1000,
    "y": 500,
    "wires": [
      []
    ]
  },
  {
    "id": "cf49b87ca54fadb6",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "4cea5da7a6e042b9",
    "name": "modify pos postion config",
    "func": "var pos1 = flow.get(\"pos1\") || 0;\nvar pos2 = flow.get(\"pos2\") || 0;\n\nif (flow.get(\"vertical\")) {\n    msg.payload.regions_config.Region_A.polygon[1] = [240, 0];\n    msg.payload.regions_config.Region_A.polygon[2] = [240, pos2];\n    msg.payload.regions_config.Region_A.polygon[3] = [0, pos1];\n\n    msg.payload.regions_config.Region_B.polygon[0] = [0, pos1];\n    msg.payload.regions_config.Region_B.polygon[1] = [240, pos2];\n    msg.payload.regions_config.Region_B.polygon[3] = [0, 240];\n}\nelse {\n    msg.payload.regions_config.Region_A.polygon[1] = [pos1, 0];\n    msg.payload.regions_config.Region_A.polygon[2] = [pos2, 240];\n    msg.payload.regions_config.Region_A.polygon[3] = [0, 240];\n\n    msg.payload.regions_config.Region_B.polygon[0] = [pos1, 0];\n    msg.payload.regions_config.Region_B.polygon[1] = [240, 0];\n    msg.payload.regions_config.Region_B.polygon[3] = [pos2, 240];\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 730,
    "y": 500,
    "wires": [
      [
        "2001f5fb16131c7a"
      ]
    ]
  },
  {
    "id": "33ef77d3eac513f0",
    "type": "switch",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "Check response msg is valid",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 820,
    "y": 300,
    "wires": [
      [
        "3d954623e05cac57"
      ]
    ]
  },
  {
    "id": "3d954623e05cac57",
    "type": "json",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "format json",
    "property": "payload",
    "action": "",
    "pretty": false,
    "x": 1030,
    "y": 300,
    "wires": [
      [
        "4dc77c2354f525c8",
        "1c0afd68563ff258"
      ]
    ]
  },
  {
    "id": "3693cc2db6709049",
    "type": "http request",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "Request tracking analyze",
    "method": "POST",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "http://192.168.100.10:8000/72d6be56",
    "tls": "",
    "persist": true,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [
      {
        "keyType": "Content-Type",
        "keyValue": "",
        "valueType": "other",
        "valueValue": "application/json"
      }
    ],
    "x": 570,
    "y": 300,
    "wires": [
      [
        "33ef77d3eac513f0",
        "ea0c0d562f20ce77"
      ]
    ]
  },
  {
    "id": "15333d07b325118d",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "g": "a4b73bc8cf9a4730",
    "name": "Construct settings from flow",
    "func": "// Check if msg.payload.data exists\nif (msg.payload.data) {\n    // Initialize an empty list for annotations\n    var annotations_list = [];\n\n    // Check for various annotation types in the flow context and add them to the list\n    if (flow.get(\"polygon\"))\n        annotations_list.push(\"polygon\");\n    if (flow.get(\"heatmap\"))\n        annotations_list.push(\"heatmap\");\n    if (flow.get(\"bounding_box\"))\n        annotations_list.push(\"bounding_box\");\n    if (flow.get(\"tracing\"))\n        annotations_list.push(\"tracing\");\n    if (flow.get(\"labeling\"))\n        annotations_list.push(\"labeling\");\n\n    // Initialize the annotations array in the payload data\n    msg.payload.data.annotations = [];\n    msg.payload.data.annotations.push(annotations_list);\n\n    // Convert the payload data to a JSON string\n    msg.payload = JSON.stringify(msg.payload.data);\n} else {\n    // If msg.payload.data does not exist, set msg to null\n    msg = null;\n}\n\n// Return the modified message\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "// 部署节点后，此处添加的代码将运行一次。\n// flow.set(\"polygon\", false);\n// flow.set(\"bounding_box\", false);\n// flow.set(\"tracing\", false);\n// flow.set(\"labeling\", false);\n// flow.set(\"heatmap\", false);",
    "finalize": "",
    "libs": [],
    "x": 400,
    "y": 340,
    "wires": [
      [
        "3693cc2db6709049"
      ]
    ]
  },
  {
    "id": "4dc77c2354f525c8",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "name": "postPost",
    "func": "if (msg.payload.annotations) {\n    msg.topic = \"track\"\n    msg.payload = msg.payload.annotations[0];\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1220,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "1c0afd68563ff258",
    "type": "function",
    "z": "0d921b2cdb2f47a8",
    "name": " flow statistics",
    "func": "var list_a = flow.get(\"list_a\");\nvar list_b = flow.get(\"list_b\");\n\nif (msg.payload.filtered_regions) {\n    var set_a_pre = new Set(flow.get(\"list_a\"));\n    var set_b_pre = new Set(flow.get(\"list_b\"));\n    var set_a = new Set(msg.payload.filtered_regions.Region_A);\n    var set_b = new Set(msg.payload.filtered_regions.Region_B);\n\n    var map_all = new Map();\n    for (let id of [...set_a_pre, ...set_a_pre]) {\n        if (!map_all.has(id)) {\n            map_all.set(id, 0);\n        }\n    }\n    for (let [id, misses] of map_all.entries()) {\n        if (!set_a.has(id) && !set_b.has(id)) {\n            misses += 1;\n            map_all.set(id, misses);\n            if (misses >= 10) {\n                map_all.delete(id);\n                if (set_a_pre.has(id)) set_a_pre.delete(id);\n                if (set_b_pre.has(id)) set_b_pre.delete(id);\n            }\n        } else {\n            map_all.set(id, 0); // appear, reset counter\n        }\n    }\n\n    for (let id of set_a_pre) {\n        if (!set_a.has(id) && set_b.has(id)) {\n            set_a_pre.delete(id);\n            flow.set(\"cnt_a2b\", flow.get(\"cnt_a2b\") + 1);\n            node.log(flow.get(\"cnt_a2b\"));\n        }\n    }\n\n    for (let id of set_b_pre) {\n        if (!set_b.has(id) && set_a.has(id)) {\n            set_b_pre.delete(id);\n            flow.set(\"cnt_b2a\", flow.get(\"cnt_b2a\") + 1);\n            node.log(flow.get(\"cnt_b2a\"));\n        }\n    }\n\n    msg.payload.filtered_regions.Region_A.forEach(set_a_pre.add, set_a_pre);\n    msg.payload.filtered_regions.Region_B.forEach(set_b_pre.add, set_b_pre);\n    // set_a_pre.add(msg.payload.filtered_regions.Region_A.slice());\n    // set_b_pre.add(msg.payload.filtered_regions.Region_B.slice());\n    flow.set(\"list_a\", [...set_a_pre]);\n    flow.set(\"list_b\", [...set_b_pre]);\n    // flow.set(\"list_a\", msg.payload.filtered_regions.Region_A.slice());\n    // flow.set(\"list_b\", msg.payload.filtered_regions.Region_B.slice());\n\n    return [{ payload: flow.get(\"cnt_a2b\") }, { payload: flow.get(\"cnt_b2a\") }];\n} else {\n    return [null, null];\n}",
    "outputs": 2,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1240,
    "y": 280,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "1466bddebcba4155",
    "type": "link in",
    "z": "0d921b2cdb2f47a8",
    "name": "link A",
    "links": [
      "54b9a4ed0e9da2db",
      "d4685d2e3ef9a309"
    ],
    "x": 1210,
    "y": 420,
    "wires": [
      [
        "9fca247ed3844e4a"
      ]
    ],
    "l": true
  },
  {
    "id": "9fca247ed3844e4a",
    "type": "msg-speed",
    "z": "0d921b2cdb2f47a8",
    "name": "",
    "frequency": "sec",
    "interval": 1,
    "estimation": false,
    "ignore": false,
    "pauseAtStartup": false,
    "topicDependent": false,
    "x": 1390,
    "y": 420,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "eba60b2edc9f1677",
    "type": "status",
    "z": "0d921b2cdb2f47a8",
    "name": "",
    "scope": [
      "9fca247ed3844e4a"
    ],
    "x": 1420,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "4b0eee312fed3a38",
    "type": "http request",
    "z": "a6ec996dc8d4208d",
    "name": "ASR API Request",
    "method": "POST",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "http://host.docker.internal:9000/asr?encode=true&task=translate&language=en&word_timestamps=false&output=txt",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [
      {
        "keyType": "Content-Type",
        "keyValue": "",
        "valueType": "other",
        "valueValue": "multipart/form-data"
      },
      {
        "keyType": "Accept",
        "keyValue": "",
        "valueType": "other",
        "valueValue": "application/json"
      }
    ],
    "x": 1550,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "16aa2489d166706b",
    "type": "change",
    "z": "a6ec996dc8d4208d",
    "name": "Set payload",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "{     \"audio_file\": {         \"value\": msg.payload,         \"options\": {             \"filename\": \"temp.wav\",             \"contentType\": \"audio/wav\"         }     } }",
        "tot": "jsonata"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1290,
    "y": 400,
    "wires": [
      [
        "4b0eee312fed3a38"
      ]
    ]
  },
  {
    "id": "c80b6a0988e6d049",
    "type": "http in",
    "z": "a6ec996dc8d4208d",
    "name": "",
    "url": "/v2/watcher/talk/audio_stream",
    "method": "post",
    "upload": false,
    "swaggerDoc": "",
    "x": 440,
    "y": 400,
    "wires": [
      [
        "344e40e7a732a989",
        "22818511d293cc9d"
      ]
    ]
  },
  {
    "id": "42e46d7e709e99e9",
    "type": "file",
    "z": "a6ec996dc8d4208d",
    "name": "",
    "filename": "/tmp/stt/audio_stream.wav",
    "filenameType": "str",
    "appendNewline": false,
    "createDir": true,
    "overwriteFile": "true",
    "encoding": "binary",
    "x": 1020,
    "y": 400,
    "wires": [
      [
        "16aa2489d166706b"
      ]
    ]
  },
  {
    "id": "344e40e7a732a989",
    "type": "function",
    "z": "a6ec996dc8d4208d",
    "name": "Create WAV Header",
    "func": "const numChannels = 1; // 单声道\nconst sampleRate = 16000; // 采样率\nconst bitsPerSample = 16; // 每个样本的位数\nconst byteRate = sampleRate * numChannels * bitsPerSample / 8;\nconst blockAlign = numChannels * bitsPerSample / 8;\nconst dataSize = msg.payload.length;\n\n// 创建 WAV 文件头部\nconst header = Buffer.alloc(44);\nheader.write('RIFF', 0); // ChunkID\nheader.writeUInt32LE(36 + dataSize, 4); // ChunkSize\nheader.write('WAVE', 8); // Format\nheader.write('fmt ', 12); // Subchunk1ID\nheader.writeUInt32LE(16, 16); // Subchunk1Size\nheader.writeUInt16LE(1, 20); // AudioFormat (1 = PCM)\nheader.writeUInt16LE(numChannels, 22); // NumChannels\nheader.writeUInt32LE(sampleRate, 24); // SampleRate\nheader.writeUInt32LE(byteRate, 28); // ByteRate\nheader.writeUInt16LE(blockAlign, 32); // BlockAlign\nheader.writeUInt16LE(bitsPerSample, 34); // BitsPerSample\nheader.write('data', 36); // Subchunk2ID\nheader.writeUInt32LE(dataSize, 40); // Subchunk2Size\n\n// 合并头部和音频数据\nmsg.payload = Buffer.concat([header, msg.payload]);\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 740,
    "y": 400,
    "wires": [
      [
        "42e46d7e709e99e9"
      ]
    ]
  },
  {
    "id": "22818511d293cc9d",
    "type": "function",
    "z": "a6ec996dc8d4208d",
    "name": "Build JSON Response",
    "func": "// 获取环境变量的值\nconst screenText = env.get(\"RSP_TEXT\");\n\n// 构建包含音频和 JSON 的响应\nconst jsonResponse = {\n    \"code\": 200,\n    \"msg\": \"\",\n    \"data\": {\n        \"mode\": 0,\n        \"duration\": 1000,\n        \"screen_text\": screenText, // 使用环境变量的值\n        \"stt_result\": \"\",\n        \"task_summary\": {}\n    }\n};\n\n// 将 JSON 转换为 Buffer\nconst jsonBuffer = Buffer.from(JSON.stringify(jsonResponse), 'utf8');\n\n// 特殊分隔符\nconst boundary = Buffer.from('\\n---sensecraftboundary---\\n', 'utf8');\n\n// 将 JSON Buffer 和分隔符存储在 msg 中，以便在文件读取完成后使用\nmsg.jsonBuffer = jsonBuffer;\nmsg.boundary = boundary;\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 740,
    "y": 560,
    "wires": [
      [
        "da1cd537d1a56cc9"
      ]
    ]
  },
  {
    "id": "da1cd537d1a56cc9",
    "type": "function",
    "z": "a6ec996dc8d4208d",
    "name": "Check RSP_AUDIO",
    "func": "const rspAudio = env.get(\"RSP_AUDIO\");\nif (rspAudio) {\n    msg.payload.filename = rspAudio;\n    return [msg, null];\n} else {\n    // Generate silent audio\n    const sampleRate = 16000;\n    const toneDuration = 0.2; // 0.2 second per tone\n    const silenceDuration = 0.1; // 0.1 second of silence between tones\n    const frequency = 440; // A4 note\n    const amplitude = 20000; // Reduced amplitude for 16-bit audio\n\n    const toneSamples = sampleRate * toneDuration;\n    const silenceSamples = sampleRate * silenceDuration;\n    const numTones = 3;\n    const numSamples = numTones * (toneSamples + silenceSamples) - silenceSamples;\n\n    let buffer = Buffer.alloc(numSamples * 2); // 16-bit mono\n\n    // Function to apply Hanning window\n    function hanningWindow(index, totalSamples) {\n        return 0.5 * (1 - Math.cos((2 * Math.PI * index) / (totalSamples - 1)));\n    }\n\n    for (let t = 0; t < numTones; t++) {\n        for (let i = 0; i < toneSamples; i++) {\n            let sampleIndex = t * (toneSamples + silenceSamples) + i;\n            let window = hanningWindow(i, toneSamples);\n            let sample = amplitude * window * Math.sin(2 * Math.PI * frequency * (i / sampleRate));\n            buffer.writeInt16LE(sample, sampleIndex * 2);\n        }\n    }\n\n    msg.payload = buffer;\n    return [null, msg];\n}",
    "outputs": 2,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 980,
    "y": 560,
    "wires": [
      [
        "7c6ac802862984ea"
      ],
      [
        "88564f7ca71a3616"
      ]
    ]
  },
  {
    "id": "7c6ac802862984ea",
    "type": "file in",
    "z": "a6ec996dc8d4208d",
    "name": "Read Audio File",
    "filename": "payload.filename",
    "filenameType": "msg",
    "format": "",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 1260,
    "y": 500,
    "wires": [
      [
        "88564f7ca71a3616"
      ]
    ]
  },
  {
    "id": "88564f7ca71a3616",
    "type": "function",
    "z": "a6ec996dc8d4208d",
    "name": "Combine JSON and Audio",
    "func": "// 读取音频文件内容\nconst audioBuffer = msg.payload;\n\n// 从 msg 中获取之前存储的 JSON Buffer 和分隔符\nconst jsonBuffer = msg.jsonBuffer;\nconst boundary = msg.boundary;\n\n// 生成 HTTP 响应\nmsg.payload = Buffer.concat([jsonBuffer, boundary, audioBuffer]);\nmsg.headers = { 'Content-Type': 'application/octet-stream' };\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1520,
    "y": 580,
    "wires": [
      [
        "3e356d31b1124846"
      ]
    ]
  },
  {
    "id": "3e356d31b1124846",
    "type": "http response",
    "z": "a6ec996dc8d4208d",
    "name": "",
    "statusCode": "200",
    "headers": {},
    "x": 1800,
    "y": 580,
    "wires": []
  },
  {
    "id": "5a75c9e05d170858",
    "type": "http in",
    "z": "336d4af7487f2429",
    "name": "",
    "url": "/v2/watcher/talk/view_task_detail",
    "method": "get",
    "upload": false,
    "swaggerDoc": "",
    "x": 510,
    "y": 660,
    "wires": [
      [
        "8ef38b1bc19a1c21"
      ]
    ]
  },
  {
    "id": "bb5684af2454b9d8",
    "type": "http response",
    "z": "336d4af7487f2429",
    "name": "",
    "statusCode": "200",
    "headers": {},
    "x": 1180,
    "y": 660,
    "wires": []
  },
  {
    "id": "fd41a18cc0ba3963",
    "type": "http in",
    "z": "336d4af7487f2429",
    "name": "",
    "url": "/v1/watcher/vision",
    "method": "post",
    "upload": false,
    "swaggerDoc": "",
    "x": 470,
    "y": 940,
    "wires": [
      [
        "5e72fad9417a86ce"
      ]
    ]
  },
  {
    "id": "5e72fad9417a86ce",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Parse Image",
    "func": "// 解析请求参数\nlet payload = msg.payload;\nlet imgBase64 = payload.img;\n\n// 将 Base64 编码的图像存储到 msg.payload\nmsg.payload = imgBase64;\n\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 730,
    "y": 940,
    "wires": [
      [
        "511a11e641b282fd"
      ]
    ]
  },
  {
    "id": "bd55cc75279cd3fe",
    "type": "http response",
    "z": "336d4af7487f2429",
    "name": "",
    "statusCode": "200",
    "headers": {},
    "x": 1140,
    "y": 1000,
    "wires": []
  },
  {
    "id": "8ef38b1bc19a1c21",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Process Model Content",
    "func": "let silence_duration = parseInt(env.get(\"PIC_DURATION\"), 10);\nsilence_duration = Math.max(silence_duration, 1);\n\nlet model_content = {};\nlet conditions = [];\n\n\nmsg.payload = {\n    \"code\": 200,\n    \"msg\": \"\",\n    \"data\": {\n        \"tl\": {\n            \"tlid\": 1723771099517,\n            \"ctd\": 1723771099517,\n            \"tn\": \"watcher push to talk\",\n            \"type\": 3,\n            \"task_flow\": [\n                {\n                    \"id\": 60516737,\n                    \"type\": \"ai camera\",\n                    \"type_id\": 0,\n                    \"index\": 0,\n                    \"vision\": \"0.0.1\",\n                    \"params\": {\n                        \"model_type\": 0,\n                        \"model\": {}, // 使用读取到的model字段内容或默认值\n                        \"modes\": 1,\n                        \"conditions\": conditions,\n                        \"conditions_combo\": 0,\n                        \"silent_period\": {\n                            \"time_period\": {\n                                \"repeat\": [\n                                    1,\n                                    1,\n                                    1,\n                                    1,\n                                    1,\n                                    1,\n                                    1\n                                ],\n                                \"time_start\": \"00:00:00\",\n                                \"time_end\": \"23:59:59\"\n                            },\n                            \"silence_duration\": silence_duration\n                        },\n                        \"output_type\": 1,\n                        \"shutter\": 0\n                    },\n                    \"wires\": [\n                        [\n                            1582908678\n                        ]\n                    ]\n                },\n                {\n                    \"id\": 1582908678,\n                    \"type\": \"image analyzer\",\n                    \"type_id\": 3,\n                    \"index\": 1,\n                    \"version\": \"0.0.1\",\n                    \"params\": {\n                        \"url\": \"\",\n                        \"header\": \"\",\n                        \"body\": {\n                            \"prompt\": \"\",\n                            \"type\": 1,\n                            \"audio_txt\": \"\"\n                        }\n                    },\n                    \"wires\": []\n                }\n            ]\n        }\n    }\n};\n\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 870,
    "y": 660,
    "wires": [
      [
        "bb5684af2454b9d8",
        "54c1dcecc2df8230"
      ]
    ]
  },
  {
    "id": "511a11e641b282fd",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Build Response",
    "func": "let image = msg.payload;\n\nmsg.payload = {\n    \"code\": 200,\n    \"msg\": \"\",\n    \"data\": {\n        \"state\": 0,// 0 不告警;1 告警\n        \"audio\": \"\",\n        \"img\": \"\",\n        \"res\": \"\"\n    }\n};\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 920,
    "y": 1000,
    "wires": [
      [
        "bd55cc75279cd3fe"
      ]
    ]
  },
  {
    "id": "2a63eacac06cf3b7",
    "type": "http in",
    "z": "336d4af7487f2429",
    "name": "",
    "url": "/v2/watcher/talk/audio_stream",
    "method": "post",
    "upload": false,
    "swaggerDoc": "",
    "x": 500,
    "y": 420,
    "wires": [
      [
        "2b00ec4943d93347"
      ]
    ]
  },
  {
    "id": "2b00ec4943d93347",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Build JSON Response",
    "func": "// 获取环境变量的值\nconst screenText = env.get(\"RSP_TEXT\");\n\n// 构建包含音频和 JSON 的响应\nconst jsonResponse = {\n    \"code\": 200,\n    \"msg\": \"\",\n    \"data\": {\n        \"mode\": 2,\n        \"duration\": 1000,\n        \"screen_text\": screenText, // 使用环境变量的值\n        \"stt_result\": \"\",\n        \"task_summary\": {}\n    }\n};\n\n// 将 JSON 转换为 Buffer\nconst jsonBuffer = Buffer.from(JSON.stringify(jsonResponse), 'utf8');\n\n// 特殊分隔符\nconst boundary = Buffer.from('\\n---sensecraftboundary---\\n', 'utf8');\n\n// 将 JSON Buffer 和分隔符存储在 msg 中，以便在文件读取完成后使用\nmsg.jsonBuffer = jsonBuffer;\nmsg.boundary = boundary;\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 780,
    "y": 420,
    "wires": [
      [
        "98098bcbc41b57bb"
      ]
    ]
  },
  {
    "id": "98098bcbc41b57bb",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Check RSP_AUDIO",
    "func": "const rspAudio = env.get(\"RSP_AUDIO\");\nif (rspAudio) {\n    msg.payload.filename = rspAudio;\n    return [msg, null];\n} else {\n    // Generate silent audio\n    const sampleRate = 16000;\n    const toneDuration = 0.2; // 0.2 second per tone\n    const silenceDuration = 0.1; // 0.1 second of silence between tones\n    const frequency = 440; // A4 note\n    const amplitude = 20000; // Reduced amplitude for 16-bit audio\n\n    const toneSamples = sampleRate * toneDuration;\n    const silenceSamples = sampleRate * silenceDuration;\n    const numTones = 3;\n    const numSamples = numTones * (toneSamples + silenceSamples) - silenceSamples;\n\n    let buffer = Buffer.alloc(numSamples * 2); // 16-bit mono\n\n    // Function to apply Hanning window\n    function hanningWindow(index, totalSamples) {\n        return 0.5 * (1 - Math.cos((2 * Math.PI * index) / (totalSamples - 1)));\n    }\n\n    for (let t = 0; t < numTones; t++) {\n        for (let i = 0; i < toneSamples; i++) {\n            let sampleIndex = t * (toneSamples + silenceSamples) + i;\n            let window = hanningWindow(i, toneSamples);\n            let sample = amplitude * window * Math.sin(2 * Math.PI * frequency * (i / sampleRate));\n            buffer.writeInt16LE(sample, sampleIndex * 2);\n        }\n    }\n\n    msg.payload = buffer;\n    return [null, msg];\n}",
    "outputs": 2,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1020,
    "y": 420,
    "wires": [
      [
        "a31c863abcdce1fa"
      ],
      [
        "1277fe454dd02788"
      ]
    ]
  },
  {
    "id": "a31c863abcdce1fa",
    "type": "file in",
    "z": "336d4af7487f2429",
    "name": "Read Audio File",
    "filename": "payload.filename",
    "filenameType": "msg",
    "format": "",
    "chunk": false,
    "sendError": false,
    "encoding": "none",
    "allProps": false,
    "x": 1300,
    "y": 360,
    "wires": [
      [
        "1277fe454dd02788"
      ]
    ]
  },
  {
    "id": "1277fe454dd02788",
    "type": "function",
    "z": "336d4af7487f2429",
    "name": "Combine JSON and Audio",
    "func": "// 读取音频文件内容\nconst audioBuffer = msg.payload;\n\n// 从 msg 中获取之前存储的 JSON Buffer 和分隔符\nconst jsonBuffer = msg.jsonBuffer;\nconst boundary = msg.boundary;\n\n// 生成 HTTP 响应\nmsg.payload = Buffer.concat([jsonBuffer, boundary, audioBuffer]);\nmsg.headers = { 'Content-Type': 'application/octet-stream' };\n\nreturn msg;\n",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1560,
    "y": 420,
    "wires": [
      [
        "7fd4d8d4464768da"
      ]
    ]
  },
  {
    "id": "7fd4d8d4464768da",
    "type": "http response",
    "z": "336d4af7487f2429",
    "name": "",
    "statusCode": "200",
    "headers": {},
    "x": 1840,
    "y": 420,
    "wires": []
  },
  {
    "id": "54c1dcecc2df8230",
    "type": "debug",
    "z": "336d4af7487f2429",
    "name": "debug 13",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 1180,
    "y": 580,
    "wires": []
  },
  {
    "id": "684df14293772fea",
    "type": "function",
    "z": "c1b434e7ff15727e",
    "name": "Check if the target is detected",
    "func": "if (Array.isArray(msg.payload)) {\n    var length = msg.payload.length;\n    if (length > 1) {\n        msg.payload = 1;\n    } else if (length === 0) {\n        msg.payload = 0;\n    } else {\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = 0;\n}\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 270,
    "y": 80,
    "wires": [
      [
        "e5661c67a0e2a2fd"
      ]
    ]
  },
  {
    "id": "e5661c67a0e2a2fd",
    "type": "switch",
    "z": "c1b434e7ff15727e",
    "name": "yes or no",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "1",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 560,
    "y": 80,
    "wires": [
      [],
      []
    ]
  },
  {
    "id": "9d91c8640849d02b",
    "type": "function",
    "z": "13477c0ac0505b10",
    "name": "Decoder",
    "func": "// Function to check if an object is valid JSON\nfunction isValidJsonObject(obj) {\n    try {\n        JSON.stringify(obj);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n// Check if the payload is a valid JSON string or a JSON object\nif (typeof msg.payload === 'string' && isValidJsonObject(JSON.parse(msg.payload))) {\n    // Parse the JSON message if it's a string\n    msg.payload = JSON.parse(msg.payload);\n} else if (typeof msg.payload === 'object' && isValidJsonObject(msg.payload)) {\n    // Do nothing if it's already a JSON object\n} else {\n    // Ignore invalid JSON strings or objects\n    return [null, null, null, null, null];\n}\n\nlet decoded = msg.payload;\n\nlet positionMsg = null;\nlet textMsg = null;\nlet telemetryMsg = null;\nlet emptyTypeMsg = null;\nlet unknownTypeMsg = null;\n\n// Process different types of messages\nif (decoded.type === \"position\") {\n    if (decoded.payload.latitude_i !== 0 && decoded.payload.longitude_i !== 0) {\n        positionMsg = {\n            payload: {\n                type: \"position\",\n                channel: decoded.channel,\n                from: decoded.from,\n                hop_start: decoded.hop_start,\n                hops_away: decoded.hops_away,\n                id: decoded.id,\n                latitude: decoded.payload.latitude_i,\n                longitude: decoded.payload.longitude_i,\n                PDOP: decoded.payload.PDOP,\n                altitude: decoded.payload.altitude,\n                ground_track: decoded.payload.ground_track,\n                precision_bits: decoded.payload.precision_bits,\n                sats_in_view: decoded.payload.sats_in_view,\n                time: decoded.payload.time,\n                rssi: decoded.rssi,\n                snr: decoded.snr,\n                sender: decoded.sender,\n                timestamp: decoded.timestamp,\n                to: decoded.to\n            }\n        };\n    }\n} else if (decoded.type === \"text\") {\n    textMsg = {\n        payload: {\n            type: \"text\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            text: decoded.payload.text,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"telemetry\") {\n    telemetryMsg = {\n        payload: {\n            type: \"telemetry\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            air_util_tx: decoded.payload.air_util_tx,\n            battery_level: decoded.payload.battery_level,\n            channel_utilization: decoded.payload.channel_utilization,\n            uptime_seconds: decoded.payload.uptime_seconds,\n            voltage: decoded.payload.voltage,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"\") {\n    emptyTypeMsg = {\n        payload: {\n            type: \"\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            rssi: decoded.rssi,\n            sender: decoded.sender,\n            snr: decoded.snr,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else {\n    unknownTypeMsg = {\n        payload: {\n            type: \"unknown\",\n            raw: decoded\n        }\n    };\n}\n\nreturn [positionMsg, textMsg, telemetryMsg, emptyTypeMsg, unknownTypeMsg];\n",
    "outputs": 5,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 160,
    "wires": [
      [
        "231cd3facd735ada"
      ],
      [],
      [],
      [],
      []
    ]
  },
  {
    "id": "3826f8bd4650ff36",
    "type": "mqtt in",
    "z": "13477c0ac0505b10",
    "name": "Subscribe meshtastic topic and receive",
    "topic": "msh/seeed/2/json/#",
    "qos": "0",
    "datatype": "json",
    "broker": "${mqtt-broker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 190,
    "y": 160,
    "wires": [
      [
        "9d91c8640849d02b"
      ]
    ]
  },
  {
    "id": "7470914cd532181c",
    "type": "status",
    "z": "13477c0ac0505b10",
    "name": "",
    "scope": null,
    "x": 660,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "231cd3facd735ada",
    "type": "function",
    "z": "13477c0ac0505b10",
    "name": "tidy msg",
    "func": "let name = msg.payload.from;\nlet nameHex = name.toString(16);\n\nreturn {\n    topic: 'report',\n    payload: {\n        name: name,\n        nameHex: nameHex,\n        latitude: msg.payload.latitude * 0.0000001,\n        longitude: msg.payload.longitude * 0.0000001\n\n    }\n};",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 660,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "42332e6efd57548a",
    "type": "comment",
    "z": "13477c0ac0505b10",
    "name": "On startup",
    "info": "",
    "x": 100,
    "y": 120,
    "wires": []
  },
  {
    "id": "3c958064b5993cea",
    "type": "ui-template",
    "z": "529a178a8fc4fc7a",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "chat ui",
    "order": 2,
    "width": "0",
    "height": "0",
    "head": "",
    "format": "<template>\n  <div class=\"chat-window\" id=\"chat\">\n    <div ref=\"chatList\" class=\"chat-content\" id=\"chat-content\">\n      <div v-for=\"(item, index) in reversedMessages\" :key=\"item.id\" class=\"value-per\"\n        :class=\"{ right: item.sender === '@You' }\">\n        <div class=\"flex\">\n          <div v-html=\"item.image\" class=\"avatar-container\"></div>\n          <div class=\"message-container\">\n            <div>\n              <span class=\"text-caption\">{{ formatTime(item.time) }}</span>\n              <strong class=\"user-name\">{{ item.sender }}</strong>\n            </div>\n            <!-- Adjusted message text to ensure wrapping -->\n            <p class=\"message-text\">{{ item.message }}</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  export default {\n  data() {\n    return {\n      timer: null,\n      inputMessage: \"\",\n    };\n  },\n  computed: {\n    reversedMessages() {\n      return Array.isArray(this.msg.payload) ? [...this.msg.payload] : [];\n    },\n  },\n  methods: {\n    formatTime(timestamp) {\n      const date = new Date(timestamp);\n      return date.toLocaleTimeString();\n    },\n\n    scrollToBottom(elementId) {\n      const domWrapper = document.getElementById(elementId);\n      if (domWrapper) {\n        domWrapper.scrollTop = domWrapper.scrollHeight;\n      }\n    },\n\n    sendMessage() {\n      const messageContent = this.inputMessage.trim();\n      if (messageContent) {\n        this.$emit(\"sendMessage\", messageContent);\n        this.inputMessage = \"\";\n        this.scrollToBottom(\"chat\");\n      }\n    },\n  },\n\n  watch: {\n    msg: {\n      handler(newVal, oldVal) {\n        if (\n          newVal.payload &&\n          newVal.payload.length > (oldVal.payload ? oldVal.payload.length : 0)\n        ) {\n          if (this.timer) clearTimeout(this.timer);\n          this.timer = setTimeout(() => this.scrollToBottom(\"chat\"), 500);\n        }\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n};\n</script>\n\n\n<style scoped>\n  .chat-window {\n    height: 793px;\n    overflow-y: auto;\n    position: relative;\n    border: 1px solid #ddd;\n    padding: 10px;\n    z-index:100;\n  }\n\n  .value-per {\n    display: flex;\n    align-items: flex-start;\n    padding: 10px;\n    border-bottom: 1px dashed #abc;\n  }\n\n  .value-per.right {\n    justify-content: flex-end;\n  }\n\n  .flex {\n    display: flex;\n  }\n\n  .message-container {\n    display: flex;\n    flex-direction: column;\n    max-width: 100%;\n    overflow-wrap: anywhere; /* Ensure text breaks inside the container */\n  }\n\n  .message-text {\n    white-space: normal;        /* Allow wrapping */\n    word-break: break-word;     /* Break words at arbitrary points if needed */\n    overflow-wrap: anywhere;    /* Break long words or continuous text */\n    line-height: 1.5;\n    margin-top: 5px;\n    max-width: 100%;            /* Prevents text from overflowing the container */\n    display: block;\n  }\n\n  .avatar-container {\n    width: 40px;\n    height: 40px;\n    margin-right: 10px;\n  }\n\n  .input-container {\n    display: flex;\n    margin-top: 10px;\n  }\n\n  input {\n    flex-grow: 1;\n    padding: 5px;\n    margin-right: 5px;\n  }\n\n  button {\n    padding: 5px;\n    background-color: #007bff;\n    color: white;\n    border: none;\n    cursor: pointer;\n  }\n\n  button:hover {\n    background-color: #0056b3;\n  }\n</style>\n",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 270,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "4fc2692c4186821c",
    "type": "ui-template",
    "z": "529a178a8fc4fc7a",
    "d": true,
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "chat ui",
    "order": 2,
    "width": "0",
    "height": "0",
    "head": "",
    "format": "<template>\n  <div class=\"chat-window\" id=\"chat\">\n    <div ref=\"chatList\" class=\"chat-content\" id=\"chat-content\">\n      <div v-for=\"(item, index) in reversedMessages\" :key=\"item.id\" class=\"value-per\"\n        :class=\"{ right: item.sender === '@You' }\">\n        <div class=\"flex\">\n          <div v-html=\"item.image\" class=\"avatar-container\"></div>\n          <div>\n            <div style=\"line-height:20px\">\n              <div>\n                <span class=\"text-caption\">{{ formatTime(item.time) }}</span>\n              </div>\n              <div>\n                <strong class=\"user-name\">{{ item.sender }}</strong>\n              </div>\n            </div>\n            <p v-html=\"item.message\" class=\"pre-wrap\"></p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        timer: null,\n      };\n    },\n    computed: {\n      reversedMessages() {\n        return Array.isArray(this.msg.payload) ? [...this.msg.payload] : [];\n      },\n    },\n    methods: {\n      formatTime(timestamp) {\n        const date = new Date(timestamp);\n        return date.toLocaleTimeString();\n      },\n      scrollToBottom(elementId) {\n        const domWrapper = document.getElementById(elementId);\n        const scrollHeight = domWrapper.scrollHeight; // 内容总高度\n        domWrapper.scrollTo(0, scrollHeight + 150);\n\n      },\n    },\n    watch: {\n      msg: {\n        handler(newVal, oldVal) {\n          if (\n            newVal.payload &&\n            newVal.payload.length > (oldVal.payload ? oldVal.payload.length : 0)\n          ) {\n            if (this.timer) clearTimeout(this.timer)\n            this.timer = setTimeout(this.scrollToBottom(\"chat\"), 500)\n          }\n        },\n        deep: true,\n        immediate: true,\n      },\n    },\n    mounted() { },\n    unmounted() {\n      // code here when the component is removed from the Dashboard\n      // i.e. when the user navigates away from the page\n    },\n  };\n</script>\n\n<style scoped>\n  .chat-window {\n    height: 600px;\n    /* Adjust as needed */\n    overflow-y: auto;\n    position: relative;\n  }\n\n  .value-per {\n    display: flex;\n    align-items: flex-start;\n    justify-content: flex-start;\n    line-height: 30px;\n    border-bottom: 1px dashed #abc;\n    padding: 10px;\n  }\n\n  .value-per.right {\n    justify-content: flex-end;\n  }\n\n  .flex {\n    display: flex;\n  }\n\n  .avatar-container {\n    width: 40px;\n    /* Adjust size as needed */\n    height: 40px;\n    /* Adjust size as needed */\n    display: flex;\n    align-items: center;\n    /* Center the avatar vertically */\n  }\n\n  .pre-wrap {\n    white-space: pre-wrap;\n  }\n</style>",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 290,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "792a9f34bd996a0d",
    "type": "link out",
    "z": "951833ec275c67c2",
    "g": "9dfd1352fc8f5514",
    "name": "set worldmap",
    "mode": "link",
    "links": [
      "86cc369d49d63f68"
    ],
    "x": 580,
    "y": 360,
    "wires": [],
    "l": true
  },
  {
    "id": "7311a79049ce08bb",
    "type": "template",
    "z": "951833ec275c67c2",
    "g": "9dfd1352fc8f5514",
    "name": "",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{\n    \"command\": {\n        \"name\": \"Circle5\",\n        \"deleted\": true\n    }\n}",
    "output": "json",
    "x": 390,
    "y": 360,
    "wires": [
      [
        "792a9f34bd996a0d"
      ]
    ]
  },
  {
    "id": "b7d9bbba6ab1b2c2",
    "type": "function",
    "z": "951833ec275c67c2",
    "g": "9dfd1352fc8f5514",
    "name": "update geofence",
    "func": "var payload = msg.payload;\nvar circleMsg = null;\nvar rectangleMsg = null;\nvar polygonMsg = null;\n\n// Parse the incoming payload\ntry {\n    var parsedPayload = JSON.parse(payload);\n} catch (e) {\n    // node.error(\"Invalid JSON payload\", msg);\n    return null;\n}\n\n// Store geofence data in flow context\nif (parsedPayload.type === \"Circle\") {\n    global.set('geofence_geoLat', parsedPayload.lat);\n    global.set('geofence_geoLng', parsedPayload.lon);\n    global.set('geofence_radius', parsedPayload.radius);\n    circleMsg = { \n        payload: parsedPayload \n    };\n    var warnlog = \"Circle geofence set: \" + JSON.stringify(parsedPayload);\n    // node.warn(\"Circle geofence set: \" + JSON.stringify(parsedPayload));\n    node.status({ fill: \"grey\", shape: \"ring\", text: warnlog });\n} else if (parsedPayload.type === \"Rectangle\") {\n    global.set('geofence_geoArea', parsedPayload.area);\n    rectangleMsg = { \n        payload: parsedPayload \n    };\n    var warnlog = \"Rectangle geofence set: \" + JSON.stringify(parsedPayload);\n    // node.warn(\"Rectangle geofence set: \" + JSON.stringify(parsedPayload));\n    node.status({ fill: \"grey\", shape: \"ring\", text: warnlog });\n} else if (parsedPayload.type === \"Polygon\") {\n    global.set('geofence_geoPolygon', parsedPayload.area);\n    polygonMsg = { \n        payload: parsedPayload\n    };\n    var warnlog = \"Polygon geofence set: \" + JSON.stringify(parsedPayload);\n    // node.warn(\"Polygon geofence set: \" + JSON.stringify(parsedPayload));\n    node.status({ fill: \"grey\", shape: \"ring\", text: warnlog });\n}\n\nreturn [circleMsg, rectangleMsg, polygonMsg];\n",
    "outputs": 3,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 570,
    "y": 300,
    "wires": [
      [],
      [],
      []
    ]
  },
  {
    "id": "e1d9d1d5615765de",
    "type": "json",
    "z": "951833ec275c67c2",
    "g": "9dfd1352fc8f5514",
    "name": "",
    "property": "payload",
    "action": "",
    "pretty": false,
    "x": 390,
    "y": 300,
    "wires": [
      [
        "b7d9bbba6ab1b2c2"
      ]
    ]
  },
  {
    "id": "0321fc619fdefe20",
    "type": "worldmap in",
    "z": "951833ec275c67c2",
    "g": "9dfd1352fc8f5514",
    "name": "worldmap geofence event",
    "path": "${webPath}",
    "events": "draw",
    "x": 190,
    "y": 300,
    "wires": [
      [
        "e1d9d1d5615765de",
        "7311a79049ce08bb"
      ]
    ]
  },
  {
    "id": "9eef6878aa2e5901",
    "type": "link out",
    "z": "951833ec275c67c2",
    "g": "c1371c3a2c8d4f9a",
    "name": "set worldmap",
    "mode": "link",
    "links": [
      "86cc369d49d63f68"
    ],
    "x": 860,
    "y": 180,
    "wires": [],
    "l": true
  },
  {
    "id": "86cc369d49d63f68",
    "type": "link in",
    "z": "951833ec275c67c2",
    "g": "28c70b3fb05d3267",
    "name": "set worldmap'",
    "links": [
      "6b8ee725e8d6721c",
      "9eef6878aa2e5901",
      "eeecd4df7a93968f",
      "af8c93719ea1fabf",
      "792a9f34bd996a0d"
    ],
    "x": 350,
    "y": 80,
    "wires": [
      [
        "05bb79f6cfd781f4"
      ]
    ],
    "l": true
  },
  {
    "id": "5c6b04022962467c",
    "type": "worldmap in",
    "z": "951833ec275c67c2",
    "g": "c1371c3a2c8d4f9a",
    "name": "worldmap geofence event",
    "path": "${webPath}",
    "events": "connect",
    "x": 190,
    "y": 180,
    "wires": [
      [
        "bf29b331c7f2a940"
      ]
    ]
  },
  {
    "id": "f1181c566e893035",
    "type": "ui-template",
    "z": "951833ec275c67c2",
    "g": "28c70b3fb05d3267",
    "group": "${Group}",
    "page": "",
    "ui": "",
    "name": "Map ui",
    "order": 1,
    "width": 0,
    "height": 0,
    "head": "",
    "format": "<template>\n   <iframe src=\"/w\" width=\"100%\" height=\"100%\" frameborder=\"0\" loading=\"lazy\" class=\"iframe\" allow=\"geolocation\"></iframe>\n</template>\n\n<style scoped>\n   .iframe {\n      width: 100% !important;\n      height: 100% !important;\n      position: absolute;\n      left: 0;\n      top: 0;\n   }\n</style>",
    "storeOutMessages": true,
    "passthru": false,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 130,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "bf29b331c7f2a940",
    "type": "function",
    "z": "951833ec275c67c2",
    "g": "c1371c3a2c8d4f9a",
    "name": "send map config commands from envs and defaults",
    "func": "return {\n    payload: {\n        \"command\": {\n            // define offline map\n            map: {\n                name: \"SenseCraft Offline Map\",\n                pmtiles: \"/data/files/_geofence/map-\" + env.get(\"offlineMapZoom\") + \".pmtiles\",\n                opt: {\n                    \"attribution\": \"SenseCraft Offline Map\",\n                    \"maxDataZoom\": parseInt(env.get(\"offlineMapZoom\")),\n                    \"maxZoom\": 20,\n                    \"theme\": \"light\"\n                }\n            },\n\n            // use offline map\n            layer: env.get(\"useOfflineMap\") ? \"SenseCraft Offline Map\" : \"Esri Streetmap\",\n\n            // default central and zoom\n            lat: env.get(\"startLatitude\"),\n            lon: env.get(\"startLongitude\"),\n            zoom: env.get(\"zoom\"),\n\n            // adjust map ui\n            showlayer: [\"drawing\", \"tracker\"],\n            ruler: { \"showruler\": false },\n            hiderightclick: true,\n            toptitle: \"SenseCraft Map\",\n            drawcontextmenu: \n                \"<button onclick='editPoly(\\\"geofence\\\");'>Edit points</button>\" +\n                \"<button onclick='editPoly(\\\"geofence\\\", \\\"drag\\\");'>Drag</button>\" +\n                \"<button onclick='editPoly(\\\"geofence\\\", \\\"rot\\\");'>Rotate</button>\" +\n                \"<button onclick='delMarker(\\\"geofence\\\", true);'>Delete</button>\" +\n                \"<button onclick='delMarker(\\\"geofence\\\", true); sendDrawing();'>Set Geofence</button>\"\n        }\n    }\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 540,
    "y": 180,
    "wires": [
      [
        "9eef6878aa2e5901"
      ]
    ]
  },
  {
    "id": "05bb79f6cfd781f4",
    "type": "worldmap",
    "z": "951833ec275c67c2",
    "g": "28c70b3fb05d3267",
    "name": "worldmap",
    "lat": "",
    "lon": "",
    "zoom": "",
    "layer": "EsriC",
    "cluster": "",
    "maxage": "",
    "usermenu": "show",
    "layers": "show",
    "panit": "false",
    "panlock": "false",
    "zoomlock": "false",
    "hiderightclick": "true",
    "coords": "deg",
    "showgrid": "false",
    "showruler": "false",
    "allowFileDrop": "false",
    "path": "${webPath}",
    "overlist": "DR,CO,RA,DN,HM",
    "maplist": "EsriC",
    "mapname": "",
    "mapurl": "",
    "mapopt": "",
    "mapwms": false,
    "x": 500,
    "y": 80,
    "wires": []
  },
  {
    "id": "af4d632bf88b7dfd",
    "type": "status",
    "z": "951833ec275c67c2",
    "name": "",
    "scope": [
      "05bb79f6cfd781f4"
    ],
    "x": 470,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "6b8ee725e8d6721c",
    "type": "link out",
    "z": "951833ec275c67c2",
    "name": "set worldmap",
    "mode": "link",
    "links": [
      "86cc369d49d63f68"
    ],
    "x": 580,
    "y": 480,
    "wires": [],
    "l": true
  },
  {
    "id": "80867da02be95653",
    "type": "template",
    "z": "951833ec275c67c2",
    "name": "payload",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "plain",
    "template": "{\n    \"channel\": 0,\n    \"from\": \"test\",\n    \"hop_start\": 3,\n    \"hops_away\": 0,\n    \"id\": 974060372,\n    \"payload\": {\n        \"PDOP\": 187,\n        \"altitude\": 79,\n        \"ground_speed\": 1,\n        \"ground_track\": 4501000,\n        \"latitude_i\": 225754329,\n        \"longitude_i\": 1139216733,\n        \"precision_bits\": 32,\n        \"sats_in_view\": 8,\n        \"time\": 1720783381\n    },\n    \"rssi\": -40,\n    \"sender\": \"!43562584\",\n    \"snr\": 6.75,\n    \"timestamp\": 1720783378,\n    \"to\": 4294967295,\n    \"type\": \"position\"\n}",
    "output": "json",
    "x": 1180,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "0776c20489fcb7e8",
    "type": "inject",
    "z": "951833ec275c67c2",
    "name": "simulate reported a position",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "x": 980,
    "y": 400,
    "wires": [
      [
        "80867da02be95653"
      ]
    ]
  },
  {
    "id": "95c92d7d45f7d358",
    "type": "inject",
    "z": "951833ec275c67c2",
    "name": "simulate reported a position (outside)",
    "props": [
      {
        "p": "payload"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "{\"channel\":0,\"from\":\"test2\",\"hop_start\":3,\"hops_away\":0,\"id\":974060372,\"payload\":{\"PDOP\":187,\"altitude\":79,\"ground_speed\":1,\"ground_track\":4501000,\"latitude_i\":226064329,\"longitude_i\":1139216733,\"precision_bits\":32,\"sats_in_view\":8,\"time\":1720783381},\"rssi\":-40,\"sender\":\"!43562584\",\"snr\":6.75,\"timestamp\":1720783378,\"to\":4294967295,\"type\":\"position\"}",
    "payloadType": "json",
    "x": 1010,
    "y": 460,
    "wires": [
      []
    ]
  },
  {
    "id": "d1fba09ee796a36a",
    "type": "function",
    "z": "951833ec275c67c2",
    "name": "send a mapping point",
    "func": "let payload = msg.payload;\n\nlet lat = payload.latitude;\nlet lon = payload.longitude;\nlet name = payload.name;\nlet nameHex = payload.nameHex;\n\nmsg = {\n   payload: {\n      action: \"point\",\n      layer: \"traker_layer\",\n      icon: \"car\",\n      name: nameHex,\n      label: nameHex,\n      lat: lat,\n      lon: lon\n   }\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 300,
    "y": 480,
    "wires": [
      [
        "6b8ee725e8d6721c"
      ]
    ]
  },
  {
    "id": "9da9cc49a95f1f28",
    "type": "function",
    "z": "ff55010600100002",
    "name": "Decoder",
    "func": "// Function to check if an object is valid JSON\nfunction isValidJsonObject(obj) {\n    try {\n        JSON.stringify(obj);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n// Check if the payload is a valid JSON string or a JSON object\nif (typeof msg.payload === 'string' && isValidJsonObject(JSON.parse(msg.payload))) {\n    // Parse the JSON message if it's a string\n    msg.payload = JSON.parse(msg.payload);\n} else if (typeof msg.payload === 'object' && isValidJsonObject(msg.payload)) {\n    // Do nothing if it's already a JSON object\n} else {\n    // Ignore invalid JSON strings or objects\n    return [null, null, null, null, null];\n}\n\nlet decoded = msg.payload;\n\nlet positionMsg = null;\nlet textMsg = null;\nlet telemetryMsg = null;\nlet emptyTypeMsg = null;\nlet unknownTypeMsg = null;\n\n// Process different types of messages\nif (decoded.type === \"position\") {\n    if (decoded.payload.latitude_i !== 0 && decoded.payload.longitude_i !== 0) {\n        positionMsg = {\n            payload: {\n                type: \"position\",\n                channel: decoded.channel,\n                from: decoded.from,\n                hop_start: decoded.hop_start,\n                hops_away: decoded.hops_away,\n                id: decoded.id,\n                latitude: decoded.payload.latitude_i,\n                longitude: decoded.payload.longitude_i,\n                PDOP: decoded.payload.PDOP,\n                altitude: decoded.payload.altitude,\n                ground_track: decoded.payload.ground_track,\n                precision_bits: decoded.payload.precision_bits,\n                sats_in_view: decoded.payload.sats_in_view,\n                time: decoded.payload.time,\n                rssi: decoded.rssi,\n                snr: decoded.snr,\n                sender: decoded.sender,\n                timestamp: decoded.timestamp,\n                to: decoded.to\n            }\n        };\n    }\n} else if (decoded.type === \"text\") {\n    textMsg = {\n        payload: {\n            type: \"text\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            text: decoded.payload.text,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"telemetry\") {\n    telemetryMsg = {\n        payload: {\n            type: \"telemetry\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            air_util_tx: decoded.payload.air_util_tx,\n            battery_level: decoded.payload.battery_level,\n            channel_utilization: decoded.payload.channel_utilization,\n            uptime_seconds: decoded.payload.uptime_seconds,\n            voltage: decoded.payload.voltage,\n            sender: decoded.sender,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else if (decoded.type === \"\") {\n    emptyTypeMsg = {\n        payload: {\n            type: \"\",\n            channel: decoded.channel,\n            from: decoded.from,\n            hop_start: decoded.hop_start,\n            hops_away: decoded.hops_away,\n            id: decoded.id,\n            rssi: decoded.rssi,\n            sender: decoded.sender,\n            snr: decoded.snr,\n            timestamp: decoded.timestamp,\n            to: decoded.to\n        }\n    };\n} else {\n    unknownTypeMsg = {\n        payload: {\n            type: \"unknown\",\n            raw: decoded\n        }\n    };\n}\n\nreturn [positionMsg, textMsg, telemetryMsg, emptyTypeMsg, unknownTypeMsg];\n",
    "outputs": 5,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 460,
    "y": 160,
    "wires": [
      [],
      [],
      [
        "c751dff9f403c31b"
      ],
      [],
      []
    ]
  },
  {
    "id": "25ae89ce94e38a1d",
    "type": "mqtt in",
    "z": "ff55010600100002",
    "name": "Subscribe meshtastic topic and receive",
    "topic": "msh/seeed/2/json/#",
    "qos": "0",
    "datatype": "json",
    "broker": "${mqtt-broker}",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 190,
    "y": 160,
    "wires": [
      [
        "9da9cc49a95f1f28"
      ]
    ]
  },
  {
    "id": "cb2302df9f3430d8",
    "type": "status",
    "z": "ff55010600100002",
    "name": "",
    "scope": null,
    "x": 660,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "c751dff9f403c31b",
    "type": "function",
    "z": "ff55010600100002",
    "name": "tidy msg",
    "func": "function formatTimestampInSeconds(timestampInSeconds) {\n  // 将以秒为单位的时间戳转换为毫秒\n  const date = new Date(timestampInSeconds * 1000);\n\n  const year = date.getFullYear();\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const day = date.getDate().toString().padStart(2, '0');\n  const hours = date.getHours().toString().padStart(2, '0');\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n\n  return `${year}/${month}/${day} ${hours}:${minutes}`;\n}\n\n\nconst {sender,battery_level,timestamp}=msg.payload\nlet numberStr = sender.toString();\n\n// 使用 slice 方法获取最后四位\nlet lastFourDigits = numberStr.slice(-4);\nmsg.payload={\n    sender:lastFourDigits,battery_level:battery_level,timestamp:formatTimestampInSeconds(timestamp)\n}\nreturn msg;",
    "outputs": 1,
    "timeout": "",
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 660,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "4e5422b6b02cff02",
    "type": "comment",
    "z": "ff55010600100002",
    "name": "On startup",
    "info": "",
    "x": 100,
    "y": 120,
    "wires": []
  },
  {
    "id": "382d23086ffe0a6b",
    "type": "status",
    "z": "a040f0957f827e96",
    "name": "",
    "scope": null,
    "x": 240,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "e0301cc70665c84c",
    "type": "catch",
    "z": "a040f0957f827e96",
    "name": "",
    "scope": null,
    "uncaught": false,
    "x": 230,
    "y": 420,
    "wires": [
      [
        "bfd201d498a3ff6c"
      ]
    ]
  },
  {
    "id": "bfd201d498a3ff6c",
    "type": "debug",
    "z": "a040f0957f827e96",
    "name": "rs485 light controller - control light",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 550,
    "y": 420,
    "wires": []
  },
  {
    "id": "f54825b3f337b670",
    "type": "modbus-flex-write",
    "z": "a040f0957f827e96",
    "name": "",
    "showStatusActivities": false,
    "showErrors": false,
    "showWarnings": true,
    "server": "${modbus-client}",
    "emptyMsgOnFail": false,
    "keepMsgProperties": false,
    "delayOnStart": false,
    "startDelayTime": "",
    "x": 710,
    "y": 220,
    "wires": [
      [
        "b8eec1357a7762ce"
      ],
      []
    ]
  },
  {
    "id": "10a299ef37e21e10",
    "type": "function",
    "z": "a040f0957f827e96",
    "name": "LIGHT Modbus Address Converter",
    "func": "// Function to normalize the environment variables (convert to lowercase)\nfunction normalizeEnvVar(value) {\n  if (value === true || value === false) {\n    return value;\n  }\n  return value ? value.toLowerCase() : \"\";\n}\n\n// Retrieve and normalize the environment variables\nvar lightColor = normalizeEnvVar(env.get(\"LIGHT_COLOR\"));\nvar lightMode = normalizeEnvVar(env.get(\"LIGHT_MODE\"));\nvar lightType = normalizeEnvVar(env.get(\"PRODUCT_MODEL\"));\n\nvar value = \"\";\n\n// Define the mapping\nif (lightType === \"type_a\") {\n  if (lightMode === \"off\") {\n    value = 0x60;\n  } else if (lightColor === \"red\") {\n    if (lightMode === \"blink\") {\n      value = 0x21;\n    } else if (lightMode === \"flashing\") {\n      value = 0x31;\n    } else if (lightMode === \"on\") {\n      value = 0x11;\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else if (lightColor === \"green\") {\n    if (lightMode === \"blink\") {\n      value = 0x23;\n    } else if (lightMode === \"flashing\") {\n      value = 0x33;\n    } else if (lightMode === \"on\") {\n      value = 0x13;\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else if (lightColor === \"yellow\") {\n    if (lightMode === \"blink\") {\n      value = 0x22;\n    } else if (lightMode === \"flashing\") {\n      value = 0x32;\n    } else if (lightMode === \"on\") {\n      value = 0x12;\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else {\n    node.warn(\"Please check your configuration\");\n  }\n  // Convert the hexadecimal value to decimal\n  var decimalValue = value;\n  msg.payload = {\n    value: decimalValue,\n    fc: 6,\n    unitid: 1,\n    address: 194,\n    quantity: 1, // Number of coils/registers to write (for single coil, it's 1)\n  };\n} else if (lightType === \"type_b\") {\n  if (lightMode === \"off\") {\n    value = 4;\n  } else if (lightColor === \"red\") {\n    if (lightMode === \"on\") {\n      value = 0; // Always_On red light\n    } else if (lightMode === \"blink\") {\n      value = 8; // Blink red light\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else if (lightColor === \"green\") {\n    if (lightMode === \"on\") {\n      value = 1; // Always_On green light\n    } else if (lightMode === \"blink\") {\n      value = 9; // Blink green light\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else if (lightColor === \"blue\") {\n    if (lightMode === \"on\") {\n      value = 2; // Always_On green light\n    } else if (lightMode === \"blink\") {\n      value = 10; // Blink green light\n    } else {\n      node.warn(\"Please check your configuration\");\n    }\n  } else {\n    node.warn(\"Please check your configuration\");\n  }\n\n  // Set the payload for Modbus communication\n  msg.payload = {\n    fc: 5, // Function code for \"Write Single Coil\"\n    unitid: 1, // Modbus Unit ID\n    address: value, // Starting address (adjust based on your setup)\n    quantity: 1, // Number of coils/registers to write (for single coil, it's 1)\n  };\n} else {\n  node.warn(\"Please check your configuration\");\n}\n\n// // Set the output message\n// if (notification) {\n//     msg.payload = notification;\n// } else {\n// }\nreturn msg;\n",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 420,
    "y": 220,
    "wires": [
      [
        "f54825b3f337b670"
      ]
    ]
  },
  {
    "id": "b8eec1357a7762ce",
    "type": "modbus-response",
    "z": "a040f0957f827e96",
    "name": "",
    "registerShowMax": 20,
    "x": 990,
    "y": 220,
    "wires": []
  },
  {
    "id": "b02358e063567ad7",
    "type": "mqtt in",
    "z": "87939573fe60ee41",
    "name": "subscribe mqtt, and receive message",
    "topic": "",
    "qos": "0",
    "datatype": "auto-detect",
    "broker": "ff55020100010001",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 1,
    "x": 710,
    "y": 200,
    "wires": [
      [
        "14f10b58e68c0856"
      ]
    ]
  },
  {
    "id": "3fae7f0293d14e20",
    "type": "inject",
    "z": "87939573fe60ee41",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "x": 210,
    "y": 200,
    "wires": [
      [
        "f7808108311eb02c"
      ]
    ]
  },
  {
    "id": "f7808108311eb02c",
    "type": "function",
    "z": "87939573fe60ee41",
    "name": "Env Function",
    "func": "var applicationId = env.get(\"applicationId\");\nvar deviceId = env.get(\"deviceId\");\nif(!applicationId) {\n    applicationId = env.get(\"SENSECRAFT_MISSION_PACK_CHIRPSTACK_APPID\");\n}\n\nif(!deviceId) {\n    deviceId = env.get(\"SENSECRAFT_MISSION_PACK_DEVICE_ULTRASONIC_DEVEUI\")\n}\n\nmsg.action = 'subscribe'\nmsg.topic = {\n    topic: `application/${applicationId}/device/${deviceId}/event/up`,\n    qos: 0\n}\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 410,
    "y": 200,
    "wires": [
      [
        "b02358e063567ad7"
      ]
    ]
  },
  {
    "id": "14f10b58e68c0856",
    "type": "function",
    "z": "87939573fe60ee41",
    "name": "decode function",
    "func": "// Decode the MQTT payload from ChirpStack, which is Base64 encoded hex data\nvar base64Data = msg.payload.data || \"\";\n// var devEui = msg.payload.deviceInfo.devEui;\nvar bytes = Buffer.from(base64Data, 'base64'); // Decode Base64 string to byte array\nvar port = msg.payload.fPort || 0; // Extract fPort from the message, defaulting to 0 if not present\n\n// Call the decodeUplink function to process the decoded bytes\nmsg = {\n    payload: decodeUplink({bytes: bytes}, port).data\n}\n\n// Return the processed message object\nreturn msg;\n\n/**\n * Main decoder function for uplink messages.\n * Takes in the decoded byte array and processes it into a structured format.\n */\nfunction decodeUplink(input, port) {\n  var bytes = input['bytes'];\n  bytes = bytes2HexString(bytes).toUpperCase(); // Convert byte array to uppercase hex string\n  var result = {\n    'err': 0,\n    'payload': bytes,\n    'valid': true,\n    messages: []\n  };\n  var splitArray = dataSplit(bytes);\n  // data decoder\n  var decoderArray = [];\n  for (var i = 0; i < splitArray.length; i++) {\n    var item = splitArray[i];\n    var dataId = item.dataId;\n    var dataValue = item.dataValue;\n    var messages = dataIdAndDataValueJudge(dataId, dataValue);\n    decoderArray.push(messages);\n  }\n  result.messages = decoderArray;\n  return {\n    data: result\n  };\n}\n\n/**\n * data splits\n * @param bytes\n * @returns {*[]}\n */\nfunction dataSplit(bytes) {\n  var frameArray = [];\n  for (var i = 0; i < bytes.length; i++) {\n    var remainingValue = bytes;\n    var dataId = remainingValue.substring(0, 2);\n    dataId = dataId.toLowerCase();\n    var dataValue = void 0;\n    var dataObj = {};\n    switch (dataId) {\n      case '01':\n      case '20':\n      case '21':\n      case '30':\n      case '31':\n      case '33':\n      case '40':\n      case '41':\n      case '42':\n      case '43':\n      case '44':\n      case '45':\n      case '4a':\n        dataValue = remainingValue.substring(2, 22);\n        bytes = remainingValue.substring(22);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      case '02':\n      case '4b':\n        dataValue = remainingValue.substring(2, 18);\n        bytes = remainingValue.substring(18);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      case '03':\n      case '06':\n        dataValue = remainingValue.substring(2, 4);\n        bytes = remainingValue.substring(4);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      case '05':\n      case '34':\n        dataValue = bytes.substring(2, 10);\n        bytes = remainingValue.substring(10);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      case '04':\n      case '10':\n      case '32':\n      case '35':\n      case '36':\n      case '37':\n      case '38':\n      case '39':\n        dataValue = bytes.substring(2, 20);\n        bytes = remainingValue.substring(20);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      case '4c':\n        dataValue = bytes.substring(2, 14);\n        bytes = remainingValue.substring(14);\n        dataObj = {\n          'dataId': dataId,\n          'dataValue': dataValue\n        };\n        break;\n      default:\n        dataValue = '9';\n        break;\n    }\n    if (dataValue.length < 2) {\n      break;\n    }\n    frameArray.push(dataObj);\n  }\n  return frameArray;\n}\nfunction dataIdAndDataValueJudge(dataId, dataValue) {\n  var messages = [];\n  var temperature;\n  var humidity;\n  var illumination;\n  var uv;\n  var windSpeed;\n  var windDirection;\n  var rainfall;\n  var airPressure;\n  var peakWind;\n  var rainAccumulation;\n  switch (dataId) {\n    case '01':\n      temperature = dataValue.substring(0, 4);\n      humidity = dataValue.substring(4, 6);\n      illumination = dataValue.substring(6, 14);\n      uv = dataValue.substring(14, 16);\n      windSpeed = dataValue.substring(16, 20);\n      messages = [{\n        measurementValue: loraWANV2DataFormat(temperature, 10),\n        measurementId: '4097',\n        type: 'Air Temperature'\n      }, {\n        measurementValue: loraWANV2DataFormat(humidity),\n        measurementId: '4098',\n        type: 'Air Humidity'\n      }, {\n        measurementValue: loraWANV2DataFormat(illumination),\n        measurementId: '4099',\n        type: 'Light Intensity'\n      }, {\n        measurementValue: loraWANV2DataFormat(uv, 10),\n        measurementId: '4190',\n        type: 'UV Index'\n      }, {\n        measurementValue: loraWANV2DataFormat(windSpeed, 10),\n        measurementId: '4105',\n        type: 'Wind Speed'\n      }];\n      break;\n    case '02':\n      windDirection = dataValue.substring(0, 4);\n      rainfall = dataValue.substring(4, 12);\n      airPressure = dataValue.substring(12, 16);\n      messages = [{\n        measurementValue: loraWANV2DataFormat(windDirection),\n        measurementId: '4104',\n        type: 'Wind Direction Sensor'\n      }, {\n        measurementValue: loraWANV2DataFormat(rainfall, 1000),\n        measurementId: '4113',\n        type: 'Rain Gauge'\n      }, {\n        measurementValue: loraWANV2DataFormat(airPressure, 0.1),\n        measurementId: '4101',\n        type: 'Barometric Pressure'\n      }];\n      break;\n    case '03':\n      var Electricity = dataValue;\n      messages = [{\n        'Battery(%)': loraWANV2DataFormat(Electricity)\n      }];\n      break;\n    case '04':\n      var electricityWhether = dataValue.substring(0, 2);\n      var hwv = dataValue.substring(2, 6);\n      var bdv = dataValue.substring(6, 10);\n      var sensorAcquisitionInterval = dataValue.substring(10, 14);\n      var gpsAcquisitionInterval = dataValue.substring(14, 18);\n      messages = [{\n        'Battery(%)': loraWANV2DataFormat(electricityWhether),\n        'Hardware Version': \"\".concat(loraWANV2DataFormat(hwv.substring(0, 2)), \".\").concat(loraWANV2DataFormat(hwv.substring(2, 4))),\n        'Firmware Version': \"\".concat(loraWANV2DataFormat(bdv.substring(0, 2)), \".\").concat(loraWANV2DataFormat(bdv.substring(2, 4))),\n        'measureInterval': parseInt(loraWANV2DataFormat(sensorAcquisitionInterval)) * 60,\n        'gpsInterval': parseInt(loraWANV2DataFormat(gpsAcquisitionInterval)) * 60\n      }];\n      break;\n    case '05':\n      var sensorAcquisitionIntervalFive = dataValue.substring(0, 4);\n      var gpsAcquisitionIntervalFive = dataValue.substring(4, 8);\n      messages = [{\n        'measureInterval': parseInt(loraWANV2DataFormat(sensorAcquisitionIntervalFive)) * 60,\n        'gpsInterval': parseInt(loraWANV2DataFormat(gpsAcquisitionIntervalFive)) * 60\n      }];\n      break;\n    case '06':\n      var errorCode = dataValue;\n      var descZh;\n      switch (errorCode) {\n        case '00':\n          descZh = 'CCL_SENSOR_ERROR_NONE';\n          break;\n        case '01':\n          descZh = 'CCL_SENSOR_NOT_FOUND';\n          break;\n        case '02':\n          descZh = 'CCL_SENSOR_WAKEUP_ERROR';\n          break;\n        case '03':\n          descZh = 'CCL_SENSOR_NOT_RESPONSE';\n          break;\n        case '04':\n          descZh = 'CCL_SENSOR_DATA_EMPTY';\n          break;\n        case '05':\n          descZh = 'CCL_SENSOR_DATA_HEAD_ERROR';\n          break;\n        case '06':\n          descZh = 'CCL_SENSOR_DATA_CRC_ERROR';\n          break;\n        case '07':\n          descZh = 'CCL_SENSOR_DATA_B1_NO_VALID';\n          break;\n        case '08':\n          descZh = 'CCL_SENSOR_DATA_B2_NO_VALID';\n          break;\n        case '09':\n          descZh = 'CCL_SENSOR_RANDOM_NOT_MATCH';\n          break;\n        case '0A':\n          descZh = 'CCL_SENSOR_PUBKEY_SIGN_VERIFY_FAILED';\n          break;\n        case '0B':\n          descZh = 'CCL_SENSOR_DATA_SIGN_VERIFY_FAILED';\n          break;\n        case '0C':\n          descZh = 'CCL_SENSOR_DATA_VALUE_HI';\n          break;\n        case '0D':\n          descZh = 'CCL_SENSOR_DATA_VALUE_LOW';\n          break;\n        case '0E':\n          descZh = 'CCL_SENSOR_DATA_VALUE_MISSED';\n          break;\n        case '0F':\n          descZh = 'CCL_SENSOR_ARG_INVAILD';\n          break;\n        case '10':\n          descZh = 'CCL_SENSOR_RS485_MASTER_BUSY';\n          break;\n        case '11':\n          descZh = 'CCL_SENSOR_RS485_REV_DATA_ERROR';\n          break;\n        case '12':\n          descZh = 'CCL_SENSOR_RS485_REG_MISSED';\n          break;\n        case '13':\n          descZh = 'CCL_SENSOR_RS485_FUN_EXE_ERROR';\n          break;\n        case '14':\n          descZh = 'CCL_SENSOR_RS485_WRITE_STRATEGY_ERROR';\n          break;\n        case '15':\n          descZh = 'CCL_SENSOR_CONFIG_ERROR';\n          break;\n        case 'FF':\n          descZh = 'CCL_SENSOR_DATA_ERROR_UNKONW';\n          break;\n        default:\n          descZh = 'CC_OTHER_FAILED';\n          break;\n      }\n      messages = [{\n        measurementId: '4101',\n        type: 'sensor_error_event',\n        errCode: errorCode,\n        descZh: descZh\n      }];\n      break;\n    case '10':\n      var statusValue = dataValue.substring(0, 2);\n      var _loraWANV2BitDataForm = loraWANV2BitDataFormat(statusValue),\n          status = _loraWANV2BitDataForm.status,\n          type = _loraWANV2BitDataForm.type;\n      var sensecapId = dataValue.substring(2);\n      messages = [{\n        status: status,\n        channelType: type,\n        sensorEui: sensecapId\n      }];\n      break;\n    case '4a':\n      temperature = dataValue.substring(0, 4);\n      humidity = dataValue.substring(4, 6);\n      illumination = dataValue.substring(6, 14);\n      uv = dataValue.substring(14, 16);\n      windSpeed = dataValue.substring(16, 20);\n      messages = [{\n        measurementValue: loraWANV2DataFormat(temperature, 10),\n        measurementId: '4097',\n        type: 'Air Temperature'\n      }, {\n        measurementValue: loraWANV2DataFormat(humidity),\n        measurementId: '4098',\n        type: 'Air Humidity'\n      }, {\n        measurementValue: loraWANV2DataFormat(illumination),\n        measurementId: '4099',\n        type: 'Light Intensity'\n      }, {\n        measurementValue: loraWANV2DataFormat(uv, 10),\n        measurementId: '4190',\n        type: 'UV Index'\n      }, {\n        measurementValue: loraWANV2DataFormat(windSpeed, 10),\n        measurementId: '4105',\n        type: 'Wind Speed'\n      }];\n      break;\n    case '4b':\n      windDirection = dataValue.substring(0, 4);\n      rainfall = dataValue.substring(4, 12);\n      airPressure = dataValue.substring(12, 16);\n      messages = [{\n        measurementValue: loraWANV2DataFormat(windDirection),\n        measurementId: '4104',\n        type: 'Wind Direction Sensor'\n      }, {\n        measurementValue: loraWANV2DataFormat(rainfall, 1000),\n        measurementId: '4113',\n        type: 'Rain Gauge'\n      }, {\n        measurementValue: loraWANV2DataFormat(airPressure, 0.1),\n        measurementId: '4101',\n        type: 'Barometric Pressure'\n      }];\n      break;\n    case '4c':\n      peakWind = dataValue.substring(0, 4);\n      rainAccumulation = dataValue.substring(4, 12);\n      messages = [{\n        measurementValue: loraWANV2DataFormat(peakWind, 10),\n        measurementId: '4191',\n        type: ' Peak Wind Gust'\n      }, {\n        measurementValue: loraWANV2DataFormat(rainAccumulation, 1000),\n        measurementId: '4213',\n        type: 'Rain Accumulation'\n      }];\n      break;\n    default:\n      break;\n  }\n  return messages;\n}\n\n/**\n *\n * data formatting\n * @param str\n * @param divisor\n * @returns {string|number}\n */\nfunction loraWANV2DataFormat(str) {\n  var divisor = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n  var strReverse = bigEndianTransform(str);\n  var str2 = toBinary(strReverse);\n  if (str2.substring(0, 1) === '1') {\n    var arr = str2.split('');\n    var reverseArr = arr.map(function (item) {\n      if (parseInt(item) === 1) {\n        return 0;\n      } else {\n        return 1;\n      }\n    });\n    str2 = parseInt(reverseArr.join(''), 2) + 1;\n    return parseFloat('-' + str2 / divisor);\n  }\n  return parseInt(str2, 2) / divisor;\n}\n\n/**\n * Handling big-endian data formats\n * @param data\n * @returns {*[]}\n */\nfunction bigEndianTransform(data) {\n  var dataArray = [];\n  for (var i = 0; i < data.length; i += 2) {\n    dataArray.push(data.substring(i, i + 2));\n  }\n  // array of hex\n  return dataArray;\n}\n\n/**\n * Convert to an 8-digit binary number with 0s in front of the number\n * @param arr\n * @returns {string}\n */\nfunction toBinary(arr) {\n  var binaryData = arr.map(function (item) {\n    var data = parseInt(item, 16).toString(2);\n    var dataLength = data.length;\n    if (data.length !== 8) {\n      for (var i = 0; i < 8 - dataLength; i++) {\n        data = \"0\" + data;\n      }\n    }\n    return data;\n  });\n  var ret = binaryData.toString().replace(/,/g, '');\n  return ret;\n}\n\n/**\n * sensor\n * @param str\n * @returns {{channel: number, type: number, status: number}}\n */\nfunction loraWANV2BitDataFormat(str) {\n  var strReverse = bigEndianTransform(str);\n  var str2 = toBinary(strReverse);\n  var channel = parseInt(str2.substring(0, 4), 2);\n  var status = parseInt(str2.substring(4, 5), 2);\n  var type = parseInt(str2.substring(5), 2);\n  return {\n    channel: channel,\n    status: status,\n    type: type\n  };\n}\n\n/**\n * channel info\n * @param str\n * @returns {{channelTwo: number, channelOne: number}}\n */\nfunction loraWANV2ChannelBitFormat(str) {\n  var strReverse = bigEndianTransform(str);\n  var str2 = toBinary(strReverse);\n  var one = parseInt(str2.substring(0, 4), 2);\n  var two = parseInt(str2.substring(4, 8), 2);\n  var resultInfo = {\n    one: one,\n    two: two\n  };\n  return resultInfo;\n}\n\n/**\n * data log status bit\n * @param str\n * @returns {{total: number, level: number, isTH: number}}\n */\nfunction loraWANV2DataLogBitFormat(str) {\n  var strReverse = bigEndianTransform(str);\n  var str2 = toBinary(strReverse);\n  var isTH = parseInt(str2.substring(0, 1), 2);\n  var total = parseInt(str2.substring(1, 5), 2);\n  var left = parseInt(str2.substring(5), 2);\n  var resultInfo = {\n    isTH: isTH,\n    total: total,\n    left: left\n  };\n  return resultInfo;\n}\nfunction bytes2HexString(arrBytes) {\n  var str = '';\n  for (var i = 0; i < arrBytes.length; i++) {\n    var tmp;\n    var num = arrBytes[i];\n    if (num < 0) {\n      tmp = (255 + num + 1).toString(16);\n    } else {\n      tmp = num.toString(16);\n    }\n    if (tmp.length === 1) {\n      tmp = '0' + tmp;\n    }\n    str += tmp;\n  }\n  return str;\n}",
    "outputs": 1,
    "timeout": 0,
    "noerr": 17,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1020,
    "y": 200,
    "wires": [
      [
        "ec3b820435e2fb0b"
      ]
    ]
  },
  {
    "id": "ec3b820435e2fb0b",
    "type": "function",
    "z": "87939573fe60ee41",
    "name": "Out Put Function",
    "func": "// Function to process the input payload and output to 10 different outputs\nmsg.payload = msg.payload.messages.flat(); // Flatten the array of messages for easier processing\n\n// Initialize an object to hold the default values for each measurementId\nconst defaultValues = {\n    \"4097\": 0, // Air Temperature\n    \"4098\": 0, // Air Humidity\n    \"4099\": 0, // Light Intensity\n    \"4190\": 0, // UV Index\n    \"4105\": 0, // Wind Speed\n    \"4104\": 0, // Wind Direction Sensor\n    \"4113\": 0, // Rain Gauge\n    \"4101\": 0, // Barometric Pressure\n    \"4191\": 0, // Peak Wind Gust\n    \"4213\": 0  // Rain Accumulation\n};\n\n// Function to create an output message for each measurementId\nfunction createOutputMessages(measurements) {\n    // Create an array of 10 messages, one for each output\n    let outputMessages = new Array(10);\n    for (let i = 0; i < outputMessages.length; i++) {\n        outputMessages[i] = { payload: 0 }; // Initialize with default payload of 0\n    }\n\n    // Iterate over the measurements and assign the correct value to the corresponding output\n    measurements.forEach(measurement => {\n        switch(measurement.measurementId) {\n            case \"4097\": // Air Temperature\n                outputMessages[0].payload = measurement.measurementValue;\n                break;\n            case \"4098\": // Air Humidity\n                outputMessages[1].payload = measurement.measurementValue;\n                break;\n            case \"4099\": // Light Intensity\n                outputMessages[2].payload = measurement.measurementValue;\n                break;\n            case \"4190\": // UV Index\n                outputMessages[3].payload = measurement.measurementValue;\n                break;\n            case \"4105\": // Wind Speed\n                outputMessages[4].payload = measurement.measurementValue;\n                break;\n            case \"4104\": // Wind Direction Sensor\n                outputMessages[5].payload = measurement.measurementValue;\n                break;\n            case \"4113\": // Rain Gauge\n                outputMessages[6].payload = measurement.measurementValue;\n                break;\n            case \"4101\": // Barometric Pressure\n                outputMessages[7].payload = measurement.measurementValue;\n                break;\n            case \"4191\": // Peak Wind Gust\n                outputMessages[8].payload = measurement.measurementValue;\n                break;\n            case \"4213\": // Rain Accumulation\n                outputMessages[9].payload = measurement.measurementValue;\n                break;\n        }\n    });\n\n    return outputMessages;\n}\n\n// Create the output messages with the payload values or default to 0\nlet outputMessages = createOutputMessages(msg.payload);\n\n// Return an array of messages to be sent to the corresponding outputs\nreturn [outputMessages[0], outputMessages[1], outputMessages[2], outputMessages[3], outputMessages[4], outputMessages[5], outputMessages[6], outputMessages[7], outputMessages[8], outputMessages[9]];",
    "outputs": 10,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1250,
    "y": 200,
    "wires": [
      [
        "e12bb2211a7f6fca"
      ],
      [
        "34cce3492350828d"
      ],
      [
        "198b981549e24e66"
      ],
      [
        "7b55c7d2cb434284"
      ],
      [
        "8de14d6b65177d9d"
      ],
      [
        "69f4e1989692a094"
      ],
      [
        "055c24e07b634380"
      ],
      [
        "ca42c6a9bf1dba56"
      ],
      [
        "4c92e3775e098cef"
      ],
      [
        "7fadb56a348d0834"
      ]
    ]
  },
  {
    "id": "e12bb2211a7f6fca",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "temperature",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 80,
    "wires": [
      [
        "33eb74c0b4557601"
      ]
    ]
  },
  {
    "id": "34cce3492350828d",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "humidity",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 120,
    "wires": [
      [
        "a5989be044896ac6"
      ]
    ]
  },
  {
    "id": "198b981549e24e66",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "intensity",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 160,
    "wires": [
      [
        "49e5994cb011441f"
      ]
    ]
  },
  {
    "id": "7b55c7d2cb434284",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "uv",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 200,
    "wires": [
      [
        "6a79458857258288"
      ]
    ]
  },
  {
    "id": "8de14d6b65177d9d",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "windspeed",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 240,
    "wires": [
      [
        "c9e8e69b0e45b601"
      ]
    ]
  },
  {
    "id": "69f4e1989692a094",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "wind_direction",
    "propertyType": "env",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 280,
    "wires": [
      [
        "62bafff00d193ccc"
      ]
    ]
  },
  {
    "id": "055c24e07b634380",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "rain_gauge",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 320,
    "wires": [
      [
        "ceace3ccff89578e"
      ]
    ]
  },
  {
    "id": "33eb74c0b4557601",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "temperature",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "a5989be044896ac6",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "humidity",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "49e5994cb011441f",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "intensity",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "6a79458857258288",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "uv",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "c9e8e69b0e45b601",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "windspeed",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "62bafff00d193ccc",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "wind_direction",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "ceace3ccff89578e",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "rain_gauge",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 320,
    "wires": [
      []
    ]
  },
  {
    "id": "ca42c6a9bf1dba56",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "barometric_pressure",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 360,
    "wires": [
      [
        "1a6345570867ba2d"
      ]
    ]
  },
  {
    "id": "4c92e3775e098cef",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "peak_wind_gust",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 400,
    "wires": [
      [
        "36063877102cf177"
      ]
    ]
  },
  {
    "id": "7fadb56a348d0834",
    "type": "switch",
    "z": "87939573fe60ee41",
    "name": "",
    "property": "rain_accumulation",
    "propertyType": "env",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1530,
    "y": 440,
    "wires": [
      [
        "a5d27fc5ba8e5914"
      ]
    ]
  },
  {
    "id": "1a6345570867ba2d",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "barometric_pressure",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "36063877102cf177",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "peak_wind_gust",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "a5d27fc5ba8e5914",
    "type": "change",
    "z": "87939573fe60ee41",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "rain_accumulation",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1700,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "60b1721c8f2f192f",
    "type": "subflow:8e71ad1d725a1c4b",
    "z": "0659cda55a05f740",
    "g": "ad2e13ab7c986d05",
    "name": "",
    "x": 570,
    "y": 340,
    "wires": [
      [
        "104d0182465308b0"
      ]
    ]
  },
  {
    "id": "104d0182465308b0",
    "type": "ui-led",
    "z": "0659cda55a05f740",
    "g": "ad2e13ab7c986d05",
    "name": "",
    "group": "5290c3946218970d",
    "order": 2,
    "width": "0",
    "height": "0",
    "label": "GEO fence status:     ",
    "labelPlacement": "left",
    "labelAlignment": "flex-start",
    "states": [
      {
        "value": "true",
        "valueType": "bool",
        "color": "#ff0000"
      },
      {
        "value": "false",
        "valueType": "bool",
        "color": "#00ff00"
      }
    ],
    "allowColorForValueInMessage": false,
    "shape": "circle",
    "showBorder": true,
    "showGlow": true,
    "x": 740,
    "y": 340,
    "wires": []
  },
  {
    "id": "50f3808dc27d03ec",
    "type": "ui-button",
    "z": "0659cda55a05f740",
    "g": "0cc6f8f73a498441",
    "group": "5290c3946218970d",
    "name": "",
    "label": "Clear Geofence",
    "order": 3,
    "width": "1",
    "height": "1",
    "emulateClick": true,
    "tooltip": "",
    "color": "",
    "bgcolor": "",
    "className": "",
    "icon": "",
    "iconPosition": "left",
    "payload": "",
    "payloadType": "str",
    "topic": "topic",
    "topicType": "msg",
    "x": 410,
    "y": 440,
    "wires": [
      [
        "f6995bba2807dbcf"
      ]
    ]
  },
  {
    "id": "f6995bba2807dbcf",
    "type": "subflow:864d0ea09f268ade",
    "z": "0659cda55a05f740",
    "g": "0cc6f8f73a498441",
    "name": "",
    "x": 610,
    "y": 440,
    "wires": []
  },
  {
    "id": "d6ae04695590915d",
    "type": "inject",
    "z": "0659cda55a05f740",
    "g": "0cc6f8f73a498441",
    "name": "on startup",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": "0",
    "topic": "",
    "x": 220,
    "y": 440,
    "wires": [
      [
        "50f3808dc27d03ec"
      ]
    ]
  },
  {
    "id": "2c12362a3c3d0eae",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "8251399ab5e97093",
    "name": "Geofence Area",
    "info": "",
    "x": 170,
    "y": 160,
    "wires": []
  },
  {
    "id": "88573d33cfe19edf",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "8251399ab5e97093",
    "name": "v0.0.2",
    "info": "",
    "x": 780,
    "y": 480,
    "wires": [],
    "icon": "font-awesome/fa-exclamation-circle"
  },
  {
    "id": "a56934c807269ea8",
    "type": "subflow:951833ec275c67c2",
    "z": "0659cda55a05f740",
    "g": "e1dc6451e9e339a6",
    "name": "",
    "env": [
      {
        "name": "Group",
        "value": "5290c3946218970d",
        "type": "conf-type"
      },
      {
        "name": "zoom",
        "value": "12",
        "type": "str"
      },
      {
        "name": "useOfflineMap",
        "value": "true",
        "type": "bool"
      },
      {
        "name": "offlineMapZoom",
        "value": "8",
        "type": "str"
      }
    ],
    "x": 670,
    "y": 240,
    "wires": []
  },
  {
    "id": "85f635cb0c722614",
    "type": "subflow:c25ee8e3cadf74f6",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "Temperature",
    "env": [
      {
        "name": "Group",
        "value": "53707ce4f54749e1",
        "type": "conf-type"
      },
      {
        "name": "card_name",
        "value": "Temperature",
        "type": "str"
      },
      {
        "name": "card_position_y",
        "value": "20%",
        "type": "str"
      },
      {
        "name": "card_position_x",
        "value": "49%",
        "type": "str"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": 4,
        "type": "str"
      }
    ],
    "x": 490,
    "y": 760,
    "wires": []
  },
  {
    "id": "e69425b83273e1f9",
    "type": "subflow:c25ee8e3cadf74f6",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "Humidity",
    "env": [
      {
        "name": "Group",
        "value": "53707ce4f54749e1",
        "type": "conf-type"
      },
      {
        "name": "card_name",
        "value": "Humidity",
        "type": "str"
      },
      {
        "name": "card_position_y",
        "value": "20%",
        "type": "str"
      },
      {
        "name": "card_position_x",
        "value": "71%",
        "type": "str"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": 3,
        "type": "str"
      }
    ],
    "x": 480,
    "y": 820,
    "wires": []
  },
  {
    "id": "432ef9ad0794a77a",
    "type": "subflow:c25ee8e3cadf74f6",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "Seismic factor",
    "env": [
      {
        "name": "Group",
        "value": "53707ce4f54749e1",
        "type": "conf-type"
      },
      {
        "name": "card_name",
        "value": "Seismic factor",
        "type": "str"
      },
      {
        "name": "card_unit",
        "value": "%",
        "type": "str"
      },
      {
        "name": "card_position_y",
        "value": "20%",
        "type": "str"
      },
      {
        "name": "card_position_x",
        "value": "27%",
        "type": "str"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": 5,
        "type": "str"
      }
    ],
    "x": 500,
    "y": 700,
    "wires": []
  },
  {
    "id": "b4baf6bb84dd2511",
    "type": "subflow:c25ee8e3cadf74f6",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "Fire factor",
    "env": [
      {
        "name": "Group",
        "value": "53707ce4f54749e1",
        "type": "conf-type"
      },
      {
        "name": "card_name",
        "value": "Fire factor",
        "type": "str"
      },
      {
        "name": "card_unit",
        "value": "%",
        "type": "str"
      },
      {
        "name": "card_position_y",
        "value": "20%",
        "type": "str"
      },
      {
        "name": "card_position_x",
        "value": "5%",
        "type": "str"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": 2,
        "type": "str"
      }
    ],
    "x": 470,
    "y": 640,
    "wires": []
  },
  {
    "id": "36e2137aa6d5fb4f",
    "type": "subflow:f11a6acbc82d2c5c",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      },
      {
        "name": "humidity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "windSpeed",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "precipitation",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "vegetationDensity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fuelMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "soilMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fireRisk",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 190,
    "y": 760,
    "wires": [
      [
        "85f635cb0c722614"
      ]
    ]
  },
  {
    "id": "812ea1fadddc2f43",
    "type": "subflow:f11a6acbc82d2c5c",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      },
      {
        "name": "temperature",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "windSpeed",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "precipitation",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "vegetationDensity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fuelMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "soilMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fireRisk",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 190,
    "y": 820,
    "wires": [
      [
        "e69425b83273e1f9"
      ]
    ]
  },
  {
    "id": "833dfce865b19b2f",
    "type": "subflow:f11a6acbc82d2c5c",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      },
      {
        "name": "temperature",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "humidity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "windSpeed",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "precipitation",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "vegetationDensity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fuelMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "soilMoisture",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 190,
    "y": 640,
    "wires": [
      [
        "b4baf6bb84dd2511"
      ]
    ]
  },
  {
    "id": "13b3a02c6a414d6d",
    "type": "subflow:38e9748a918c1e10",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "",
    "env": [
      {
        "name": "rainfall",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "rockType",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "faultActivity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "slope",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "terrainChange",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "surfaceWaterFlow",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 180,
    "y": 700,
    "wires": [
      [
        "432ef9ad0794a77a"
      ]
    ]
  },
  {
    "id": "a3787b2c45bb09b3",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "More References solution",
    "info": "",
    "x": 210,
    "y": 600,
    "wires": []
  },
  {
    "id": "027cdd18eae2489d",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "v0.0.1",
    "info": "",
    "x": 570,
    "y": 960,
    "wires": [],
    "icon": "font-awesome/fa-exclamation-circle"
  },
  {
    "id": "71f8d5f648c86d9b",
    "type": "ui-text-input",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "group": "04cddd622489bf0a",
    "name": "",
    "label": "Input chat message here",
    "order": 2,
    "width": "3",
    "height": "1",
    "topic": "topic",
    "topicType": "msg",
    "mode": "textarea",
    "tooltip": "",
    "delay": 300,
    "passthru": false,
    "sendOnDelay": false,
    "sendOnBlur": true,
    "sendOnEnter": true,
    "className": "message-input",
    "clearable": true,
    "sendOnClear": true,
    "icon": "",
    "iconPosition": "left",
    "iconInnerPosition": "inside",
    "x": 1050,
    "y": 500,
    "wires": [
      [
        "fc404d18dd19cd6b"
      ]
    ]
  },
  {
    "id": "eb0c56d232605fda",
    "type": "ui-button",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "group": "04cddd622489bf0a",
    "name": "",
    "label": "Send Message",
    "order": 4,
    "width": "0",
    "height": "0",
    "emulateClick": false,
    "tooltip": "",
    "color": "",
    "bgcolor": "",
    "className": "button-box",
    "icon": "",
    "iconPosition": "left",
    "payload": "current_inputtext",
    "payloadType": "flow",
    "topic": "topic",
    "topicType": "msg",
    "x": 1020,
    "y": 560,
    "wires": [
      [
        "837003ff9da67964",
        "5d541ca2b1125fec"
      ]
    ]
  },
  {
    "id": "fc404d18dd19cd6b",
    "type": "change",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "name": "record text to flow",
    "rules": [
      {
        "t": "set",
        "p": "current_inputtext",
        "pt": "flow",
        "to": "payload",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1330,
    "y": 500,
    "wires": [
      []
    ]
  },
  {
    "id": "837003ff9da67964",
    "type": "function",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "name": "wrap chat message",
    "func": "var chatUsername = '@You';\nvar chatMessage = msg.payload;\n\nreturn {\n    topic: chatUsername,\n    payload: chatMessage\n};",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1330,
    "y": 560,
    "wires": [
      [
        "a2439d093ac64042",
        "d674390c2cab0c41"
      ]
    ]
  },
  {
    "id": "a2439d093ac64042",
    "type": "subflow:15e3d881bcd13372",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "name": "meshtastic chat - send message",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 1620,
    "y": 540,
    "wires": []
  },
  {
    "id": "d674390c2cab0c41",
    "type": "link out",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "name": "link A",
    "mode": "link",
    "links": [
      "c72b162dc6f6b02f"
    ],
    "x": 1530,
    "y": 500,
    "wires": [],
    "l": true
  },
  {
    "id": "b377b7368363b941",
    "type": "ui-button",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "group": "04cddd622489bf0a",
    "name": "",
    "label": "Clear Messages",
    "order": 3,
    "width": "0",
    "height": "0",
    "emulateClick": false,
    "tooltip": "",
    "color": "",
    "bgcolor": "",
    "className": "button-box",
    "icon": "",
    "iconPosition": "left",
    "payload": "",
    "payloadType": "str",
    "topic": "topic",
    "topicType": "msg",
    "x": 1040,
    "y": 240,
    "wires": [
      [
        "36d3298bcfa34c87"
      ]
    ]
  },
  {
    "id": "36d3298bcfa34c87",
    "type": "change",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "name": "delete flow.data",
    "rules": [
      {
        "t": "delete",
        "p": "data",
        "pt": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1300,
    "y": 240,
    "wires": [
      [
        "0c10ce89d51a0984"
      ]
    ]
  },
  {
    "id": "a37efe4de95a1802",
    "type": "function",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "name": "handle user chat ui data",
    "func": "// 将用户名转换为十六进制的字符串并截取最后四位\nconst chatUsername = msg.topic;\nconst chatMessage = msg.payload\n\n// ------------------ Generate Avatar -----------------------\n// 获取输入参数\nconst text = chatUsername;\nconst width = 30;\nconst height = 30;\nconst textColor = '#FFFFFF'; // 白色\n\n// 生成基于用户名的深色背景\nfunction stringToColor(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    let color = '#';\n    for (let i = 0; i < 3; i++) {\n        let value = (hash >> (i * 8)) & 0xFF;\n        value = Math.floor(value * 0.6); // 调暗颜色\n        color += ('00' + value.toString(16)).substr(-2);\n    }\n    return color;\n}\n\nconst circleColor = stringToColor(chatUsername);\n\n// 使用HTML和CSS生成头像\nconst avatarHtml = `\n    <div style=\"width: ${width}px; height: ${height}px; border-radius: 50%; background-color: ${circleColor}; display: flex; align-items: center; justify-content: center; color: ${textColor}; font-size: 10px; font-weight: bold;\">\n        ${text}\n    </div>\n`;\n\n// ------------------- Generate chat history list ----------------------\nvar tmp = flow.get('data') || [];\n\ntmp.push({\n    image: avatarHtml,\n    sender: chatUsername,\n    message: chatMessage,\n    time: new Date()\n});\n\nflow.set('data', tmp);\nmsg.payload = tmp;\n\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1270,
    "y": 280,
    "wires": [
      [
        "0c10ce89d51a0984"
      ]
    ]
  },
  {
    "id": "c72b162dc6f6b02f",
    "type": "link in",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "name": "link A'",
    "links": [
      "4764b35399c850f0",
      "d674390c2cab0c41"
    ],
    "x": 1000,
    "y": 280,
    "wires": [
      [
        "a37efe4de95a1802"
      ]
    ],
    "l": true
  },
  {
    "id": "0c10ce89d51a0984",
    "type": "subflow:529a178a8fc4fc7a",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "name": "",
    "env": [
      {
        "name": "Group",
        "value": "04cddd622489bf0a",
        "type": "conf-type"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": "1",
        "type": "str"
      }
    ],
    "x": 1520,
    "y": 260,
    "wires": []
  },
  {
    "id": "ad635efce0e91966",
    "type": "subflow:c331a93ea0d418b4",
    "z": "0659cda55a05f740",
    "g": "ef65ded2e9d4b6d8",
    "name": "meshtastic chat - receive message",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 1080,
    "y": 380,
    "wires": [
      [
        "4764b35399c850f0"
      ]
    ]
  },
  {
    "id": "4764b35399c850f0",
    "type": "link out",
    "z": "0659cda55a05f740",
    "g": "ef65ded2e9d4b6d8",
    "name": "link A",
    "mode": "link",
    "links": [
      "c72b162dc6f6b02f"
    ],
    "x": 1310,
    "y": 380,
    "wires": [],
    "l": true
  },
  {
    "id": "f996c4df6525225c",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "Chat",
    "info": "",
    "x": 970,
    "y": 160,
    "wires": []
  },
  {
    "id": "34c8a12384d94a83",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "v0.0.1",
    "info": "",
    "x": 1730,
    "y": 620,
    "wires": [],
    "icon": "font-awesome/fa-exclamation-circle"
  },
  {
    "id": "2cbd8278a58cc763",
    "type": "subflow:ff55010600100002",
    "z": "0659cda55a05f740",
    "g": "877c275c9c5ce289",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 230,
    "y": 1120,
    "wires": [
      [
        "e6932abd14a69f0b"
      ]
    ]
  },
  {
    "id": "e6932abd14a69f0b",
    "type": "ui-template",
    "z": "0659cda55a05f740",
    "g": "877c275c9c5ce289",
    "group": "ee9ef85c506ffeea",
    "page": "",
    "ui": "",
    "name": "Status Panel",
    "order": 1,
    "width": "2",
    "height": "6",
    "head": "",
    "format": "<template>\n \n\n  <div v-if=\"localData && localData.length > 0\">\n    <p>Devices Count: {{localData.length }}</p>\n    <v-list>\n      <v-list-item\n        v-for=\"(device, index) in localData\"\n        :key=\"index\"\n        class=\"v-list-item--one-line\"\n      >\n        <v-list-item-content>\n          <v-list-item-title>{{ device.sender }}</v-list-item-title>\n          <v-list-item-subtitle>\n            <!-- <v-chip :color=\"device.online ? 'green' : 'red'\" dark>\n              {{ device.online ? 'Online' : 'Offline' }}\n            </v-chip> -->\n            <span style=\"margin-left: 10px;\">Battery: {{ device.battery_level }}%</span>\n            <span style=\"margin-left: 10px;\"> {{ device.timestamp }}</span>\n          </v-list-item-subtitle>\n        </v-list-item-content>\n      </v-list-item>\n    </v-list>\n  </div>\n  <div v-else>\n    <p>No valid devices found</p>\n  </div>\n</template>\n\n<script>\nexport default {\n\n  data(){\n    return {\n      localData: []\n    }\n  },\n  computed: {\n    current(){return this.msg.payload}\n  },\n  methods:{\n     getHistory(){\n        const localKey = 'panel_history_data'\n          try{\n            const l = localStorage.getItem(localKey)\n            if(!l){\n              return []\n            }\n            const oldData = JSON.parse(localStorage.getItem(localKey))\n            if(oldData){\n              console.log(oldData)\n              return oldData\n            }\n            return []\n\n          \n        }catch(err){\n          console.log('error', err)\n        }\n    },\n    \n    updateHistory(){\n        const localKey = 'panel_history_data'\n        const records = {}\n        const newArr = []\n        this.localData.forEach(item => {\n          if(item.sender && records.hasOwnProperty(item.sender)){return}\n          newArr.push(item)\n          records[item.sender] = true\n        })\n        console.log('newArr', )\n        this.localData = [...newArr];\n        localStorage.setItem(localKey, JSON.stringify(this.localData))\n    }\n  },\n  watch:{\n    current: {\n      deep: true,\n      handler: function(value){\n        if(!value){return}\n        this.localData.unshift(value)\n        this.updateHistory()\n\n      }\n    }\n  },\n  mounted(){\n    console.log('this.getHistory', this.getHistory())\n    this.localData = this.getHistory()\n  }\n\n}\n\n</script>\n",
    "storeOutMessages": true,
    "passthru": true,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "status-panel",
    "x": 730,
    "y": 1120,
    "wires": [
      []
    ]
  },
  {
    "id": "794f6f1403b5da46",
    "type": "subflow:13477c0ac0505b10",
    "z": "0659cda55a05f740",
    "g": "e1dc6451e9e339a6",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 280,
    "y": 240,
    "wires": [
      [
        "a56934c807269ea8"
      ]
    ]
  },
  {
    "id": "83a1c4206bdadc28",
    "type": "subflow:13477c0ac0505b10",
    "z": "0659cda55a05f740",
    "g": "ad2e13ab7c986d05",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 280,
    "y": 340,
    "wires": [
      [
        "60b1721c8f2f192f"
      ]
    ]
  },
  {
    "id": "b52c105d3813450f",
    "type": "ui-template",
    "z": "0659cda55a05f740",
    "group": "",
    "page": "f3700c18c351beca",
    "ui": "",
    "name": "",
    "order": 0,
    "width": 0,
    "height": 0,
    "head": "",
    "format": "\n    /* define any styles here - supports raw CSS */\n#nrdb-ui-group-5290c3946218970d  .v-card.v-theme--nrdb.v-card--density-default.v-card--variant-outlined.bg-group-background\n{\n    height: 852px;\n}\n\n#nrdb-ui-group-53707ce4f54749e1 {\n    z-index: 0;\n    position: absolute;\n    top: 914px;\n    width: 1430px;\n}\n\n.v-field__input{\n    opacity: 1;\n    height: 105px;\n}\n\n#nrdb-ui-widget-104d0182465308b0{\n    position: absolute;\n    top: 735px;\n    background: #ffffffcf;\n    left: 926px;\n}\n#nrdb-ui-widget-50f3808dc27d03ec{\n    position: absolute;\n    top: 783px;\n    left: 925px;\n}\n\n#nrdb-ui-widget-50f3808dc27d03ec .v-btn--variant-flat{\n    background-color: rgb(255 239 0);\n    color: rgb(0 0 0);\n    width: 185px;\n}\n\n#nrdb-ui-group-ee9ef85c506ffeea .v-card{\n\n    height: 852px;\n\n}\n\n/* 确保按钮组容器自动换行 */\n#nrdb-ui-widget-ea9c70d40f694a81 .nrdb-ui-button-group-wrapper {\n  display: flex;\n  flex-wrap: wrap; /* 允许按钮自动换行 */\n  justify-content: flex-start; /* 左对齐按钮 */\n  gap: 10px; /* 按钮之间的间距 */\n  padding: 10px;\n  background-color: #f5f5f5;\n  border-radius: 10px;\n  max-width: 100%;\n  overflow: hidden;\n}\n\n/* 样式化按钮，每行显示两个按钮 */\n#nrdb-ui-widget-ea9c70d40f694a81 .v-btn {\n  flex: 1 1 calc(50% - 10px); /* 每行显示两个按钮 */\n  max-width: calc(50% - 10px); /* 确保每行最多显示两个按钮 */\n  min-width: 100px; /* 设置按钮的最小宽度 */\n  height: 50px; /* 设置按钮的高度 */\n  font-size: 16px;\n  margin: 5px 0; /* 按钮上下边距 */\n  border-radius: 8px;\n  text-transform: none;\n  transition: background-color 0.3s, transform 0.2s;\n}\n\n/* 按钮内容对齐 */\n#nrdb-ui-widget-ea9c70d40f694a81 .v-btn__content {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n}\n\n/* Hover 效果 */\n#nrdb-ui-widget-ea9c70d40f694a81 .v-btn:hover {\n  background-color: rgba(0, 123, 255, 0.1);\n  transform: translateY(-2px);\n}\n\n/* 激活按钮的样式 */\n#nrdb-ui-widget-ea9c70d40f694a81 .v-btn--active {\n  background-color: #007bff !important;\n  color: white !important;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n/* 针对小屏幕的响应式调整 */\n@media (max-width: 480px) {\n  #nrdb-ui-widget-ea9c70d40f694a81 .v-btn {\n    flex: 1 1 100%; /* 小屏幕上每行显示一个按钮 */\n    max-width: 100%;\n    height: 40px;\n    font-size: 14px;\n  }\n}\n\n#nrdb-ui-widget-ea9c70d40f694a81 .v-btn-group {\n  display: inline-flex;\n  flex-wrap: wrap;\n  height: 200px;\n  justify-content: center;\n}\n\n/* #nrdb-ui-widget-e6932abd14a69f0b .nrdb-ui-widget{\n    height: 507px !important;\n} */\n\n/* Target the specific div by its ID */\n#nrdb-ui-widget-e6932abd14a69f0b {\n  height: 500px !important; /* Set the height to 500px */\n  overflow-y: auto; /* Enable scrolling if content overflows */\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  padding: 10px;\n  background-color: #f5f5f5;\n  border-radius: 8px;\n}\n\n\n#nrdb-ui-widget-b377b7368363b941 {\n  margin-left: 147px;\n}",
    "storeOutMessages": true,
    "passthru": true,
    "resendOnRefresh": true,
    "templateScope": "page:style",
    "className": "",
    "x": 950,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "becf3cfdcc4ddb21",
    "type": "subflow:f11a6acbc82d2c5c",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      },
      {
        "name": "temperature",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "humidity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "precipitation",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "vegetationDensity",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fuelMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "soilMoisture",
        "type": "bool",
        "value": "false"
      },
      {
        "name": "fireRisk",
        "type": "bool",
        "value": "false"
      }
    ],
    "x": 190,
    "y": 880,
    "wires": [
      [
        "624a0c4e1be347e2"
      ]
    ]
  },
  {
    "id": "624a0c4e1be347e2",
    "type": "subflow:c25ee8e3cadf74f6",
    "z": "0659cda55a05f740",
    "g": "c702fbe05b9afb59",
    "name": "Wind Speed",
    "env": [
      {
        "name": "Group",
        "value": "53707ce4f54749e1",
        "type": "conf-type"
      },
      {
        "name": "card_name",
        "value": "Wind Speed",
        "type": "str"
      },
      {
        "name": "card_unit",
        "value": "%",
        "type": "str"
      },
      {
        "name": "card_position_y",
        "value": "20%",
        "type": "str"
      },
      {
        "name": "card_position_x",
        "value": "90%",
        "type": "str"
      },
      {
        "key": "DB2_SF_ORDER",
        "value": "1",
        "type": "str"
      }
    ],
    "x": 490,
    "y": 880,
    "wires": []
  },
  {
    "id": "5d541ca2b1125fec",
    "type": "change",
    "z": "0659cda55a05f740",
    "g": "8f4e14449f78d9c7",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1340,
    "y": 620,
    "wires": [
      [
        "71f8d5f648c86d9b"
      ]
    ]
  },
  {
    "id": "ea9c70d40f694a81",
    "type": "ui-button-group",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Indicator Light",
    "group": "ee9ef85c506ffeea",
    "order": 2,
    "width": "2",
    "height": "6",
    "label": "Light Control",
    "rounded": true,
    "useThemeColors": true,
    "passthru": true,
    "options": [
      {
        "label": "Red On",
        "icon": "",
        "value": "{\"red\":\"on\"}",
        "valueType": "json",
        "color": "#009933"
      },
      {
        "label": "Red Blink",
        "icon": "",
        "value": "{\"red\":\"blink\"}",
        "valueType": "json",
        "color": "#999999"
      },
      {
        "label": "Green On",
        "icon": "",
        "value": "{\"green\":\"on\"}",
        "valueType": "json",
        "color": "#009999"
      },
      {
        "label": "Green Blink",
        "icon": "",
        "value": "{\"green\":\"blink\"}",
        "valueType": "json",
        "color": "#cccc00"
      },
      {
        "label": "Blue  On",
        "icon": "",
        "value": "{\"blue\":\"on\"}",
        "valueType": "json",
        "color": "#cc6600"
      },
      {
        "label": "Blue  Blink",
        "icon": "",
        "value": "{\"blue\":\"blink\"}",
        "valueType": "json",
        "color": "#99ff66"
      },
      {
        "label": "Light  Off",
        "icon": "",
        "value": "{\"red\":\"off\"}",
        "valueType": "json",
        "color": "#660033"
      }
    ],
    "topic": "topic",
    "topicType": "msg",
    "x": 1240,
    "y": 940,
    "wires": [
      [
        "0101ede081a4c0f8"
      ]
    ]
  },
  {
    "id": "0101ede081a4c0f8",
    "type": "function",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Light ctl function",
    "func": "// Extract key and value from the incoming payload\nconst payload = msg.payload;\nconst key = Object.keys(payload)[0];  // Get the color (e.g., \"red\", \"green\", \"yellow\")\nconst value = payload[key];           // Get the state (e.g., \"on\", \"off\", \"blink\")\n\n// Initialize the output array with 7 null values\nlet outputs = [null, null, null, null, null, null, null];\n\n// Route based on the color and state\nswitch (key) {\n    case \"red\":\n        if (value === \"off\") outputs[0] = { payload: true };\n        else if (value === \"on\") outputs[1] = { payload: true };\n        else if (value === \"blink\") outputs[2] = { payload: true };\n        break;\n    case \"green\":\n        if (value === \"on\") outputs[3] = { payload: true };\n        else if (value === \"blink\") outputs[4] = { payload: true };\n        break;\n    case \"blue\":\n        if (value === \"on\") outputs[5] = { payload: true };\n        else if (value === \"blink\") outputs[6] = { payload: true };\n        break;\n    default:\n        // If the payload doesn't match any expected values, do nothing\n        return null;\n}\n\n// Return the output array to route the message\nreturn outputs;\n",
    "outputs": 7,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1470,
    "y": 940,
    "wires": [
      [
        "d957f1dca8608f37"
      ],
      [
        "34000a572d2865db"
      ],
      [
        "9231025e7e8cc366"
      ],
      [
        "4279d3d0717f8a33"
      ],
      [
        "dc9c32c8cd435f45"
      ],
      [
        "f2c3ad4921b598f8"
      ],
      [
        "d63a6d794598f60f"
      ]
    ]
  },
  {
    "id": "134a0b6660ec4271",
    "type": "inject",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "",
    "props": [
      {
        "p": "payload"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "{\"red\":\"off\"}",
    "payloadType": "json",
    "x": 1010,
    "y": 940,
    "wires": [
      [
        "ea9c70d40f694a81"
      ]
    ]
  },
  {
    "id": "34000a572d2865db",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Red On",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 820,
    "wires": [
      []
    ]
  },
  {
    "id": "9231025e7e8cc366",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Red Blink",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_MODE",
        "value": "blink",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 880,
    "wires": [
      []
    ]
  },
  {
    "id": "4279d3d0717f8a33",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Green On",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_COLOR",
        "value": "green",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 940,
    "wires": [
      []
    ]
  },
  {
    "id": "dc9c32c8cd435f45",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Green Blink",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_MODE",
        "value": "blink",
        "type": "str"
      },
      {
        "name": "LIGHT_COLOR",
        "value": "green",
        "type": "str"
      }
    ],
    "x": 1790,
    "y": 1000,
    "wires": [
      []
    ]
  },
  {
    "id": "f2c3ad4921b598f8",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Blue On",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_COLOR",
        "value": "blue",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 1060,
    "wires": [
      []
    ]
  },
  {
    "id": "d63a6d794598f60f",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Blue Blink",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_MODE",
        "value": "blink",
        "type": "str"
      },
      {
        "name": "LIGHT_COLOR",
        "value": "blue",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 1120,
    "wires": [
      []
    ]
  },
  {
    "id": "d957f1dca8608f37",
    "type": "subflow:a040f0957f827e96",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "Light Off",
    "env": [
      {
        "name": "modbus-client",
        "value": "ff55020100020001",
        "type": "conf-type"
      },
      {
        "name": "PRODUCT_MODEL",
        "value": "type_b",
        "type": "str"
      },
      {
        "name": "LIGHT_MODE",
        "value": "off",
        "type": "str"
      }
    ],
    "x": 1780,
    "y": 760,
    "wires": [
      []
    ]
  },
  {
    "id": "a5e513e1c35b327d",
    "type": "comment",
    "z": "0659cda55a05f740",
    "g": "ad60dd8276ebc91f",
    "name": "485 Light Ctl - v0.01",
    "info": "",
    "x": 1010,
    "y": 740,
    "wires": [],
    "icon": "font-awesome/fa-exclamation-circle"
  },
  {
    "id": "e2036e1f82dc877b",
    "type": "subflow:ff55010600100001",
    "z": "0659cda55a05f740",
    "g": "f11bf0633195afe6",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 1550,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "ca75938e99dccd3f",
    "type": "inject",
    "z": "0659cda55a05f740",
    "g": "b5c67be953f9a256",
    "name": "Clear Message",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "300",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1060,
    "y": 200,
    "wires": [
      [
        "36d3298bcfa34c87"
      ]
    ]
  },
  {
    "id": "886279428c73b85b",
    "type": "inject",
    "z": "83ddd822c5c4b267",
    "name": "",
    "props": [
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "start_conversion",
    "x": 280,
    "y": 40,
    "wires": [
      [
        "e61847fc5c88b3df"
      ]
    ]
  },
  {
    "id": "e61847fc5c88b3df",
    "type": "subflow:cca203ebc25b2ce6",
    "z": "83ddd822c5c4b267",
    "d": true,
    "name": "",
    "env": [
      {
        "name": "url",
        "value": "rtsp://admin:VBQUYH@192.168.120.92:554/h264/ch1/main/av_stream",
        "type": "str"
      },
      {
        "name": "frameRate",
        "value": "1",
        "type": "num"
      },
      {
        "name": "quality",
        "value": "1",
        "type": "str"
      },
      {
        "name": "resolution",
        "value": "320x240",
        "type": "str"
      }
    ],
    "x": 640,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "98140bc009a8360d",
    "type": "delay",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "RateLimit",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "5",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 580,
    "y": 280,
    "wires": [
      [
        "aa441f238241b94c"
      ]
    ]
  },
  {
    "id": "1e9fd3689fd29354",
    "type": "subflow:db0357a026e3fe9d",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "",
    "x": 760,
    "y": 500,
    "wires": [
      [
        "2b37f593d84b3ac1",
        "5538c36c2ef9e75e"
      ],
      [],
      []
    ]
  },
  {
    "id": "e269bd7ca3d5ab90",
    "type": "delay",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "RateLimit",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "5",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 580,
    "y": 500,
    "wires": [
      [
        "1e9fd3689fd29354"
      ]
    ]
  },
  {
    "id": "9ac738c9569d9b32",
    "type": "inject",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "0.2",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 280,
    "y": 400,
    "wires": [
      [
        "45da8c0a04f01cee"
      ]
    ]
  },
  {
    "id": "45da8c0a04f01cee",
    "type": "usbcamera",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "filemode": "0",
    "filename": "image01.jpg",
    "filedefpath": "1",
    "filepath": "",
    "fileformat": "jpeg",
    "resolution": "1",
    "name": "",
    "x": 450,
    "y": 400,
    "wires": [
      [
        "98140bc009a8360d",
        "e269bd7ca3d5ab90"
      ]
    ]
  },
  {
    "id": "4623e0824908287d",
    "type": "ui-template",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "group": "fdc1fcb5b637d024",
    "page": "",
    "ui": "",
    "name": "",
    "order": 2,
    "width": "0",
    "height": "0",
    "head": "",
    "format": "<template>\n    <div>\n        <img :src=\"msg.payload\">\n    </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                count: 0\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n            count: function () {\n                if (this.count % 5 === 0) {\n                    this.send({payload: 'Multiple of 5'})\n                }\n            }\n        },\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n            formattedCount: function () {\n                return this.count + 'Apples'\n            }\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            increase: function () {\n                this.count++\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    img {\n        width: auto !important;\n    max-width: 100% !important;\n    height: 30vh !important;\n    object-fit: cover !important;\n    }\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
    "storeOutMessages": true,
    "passthru": true,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 980,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "aa441f238241b94c",
    "type": "function",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "Video Fucntion",
    "func": "\n msg.payload = `data:image/jpeg;base64,${msg.payload.toString('base64')}`;\n return msg",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 760,
    "y": 280,
    "wires": [
      [
        "4623e0824908287d"
      ]
    ]
  },
  {
    "id": "cadfe4b80da526b4",
    "type": "ui-template",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "group": "fdc1fcb5b637d024",
    "page": "",
    "ui": "",
    "name": "",
    "order": 1,
    "width": "0",
    "height": "0",
    "head": "",
    "format": "<template>\n    <div>\n        <img :src=\"msg.payload\">\n    </div>\n</template>\n\n<script>\n    export default {\n        data() {\n            // define variables available component-wide\n            // (in <template> and component functions)\n            return {\n                count: 0\n            }\n        },\n        watch: {\n            // watch for any changes of \"count\"\n            count: function () {\n                if (this.count % 5 === 0) {\n                    this.send({payload: 'Multiple of 5'})\n                }\n            }\n        },\n        computed: {\n            // automatically compute this variable\n            // whenever VueJS deems appropriate\n            formattedCount: function () {\n                return this.count + 'Apples'\n            }\n        },\n        methods: {\n            // expose a method to our <template> and Vue Application\n            increase: function () {\n                this.count++\n            }\n        },\n        mounted() {\n            // code here when the component is first loaded\n        },\n        unmounted() {\n            // code here when the component is removed from the Dashboard\n            // i.e. when the user navigates away from the page\n        }\n    }\n</script>\n<style>\n    img {\n        width: auto !important;\n    max-width: 100% !important;\n    height: 30vh !important;\n    object-fit: cover !important;\n    }\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>",
    "storeOutMessages": true,
    "passthru": true,
    "resendOnRefresh": true,
    "templateScope": "local",
    "className": "",
    "x": 1180,
    "y": 480,
    "wires": [
      []
    ]
  },
  {
    "id": "2b37f593d84b3ac1",
    "type": "function",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "Object Fucntion",
    "func": "\n msg.payload = `data:image/jpeg;base64,${msg.payload}`;\n return msg",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1000,
    "y": 480,
    "wires": [
      [
        "cadfe4b80da526b4"
      ]
    ]
  },
  {
    "id": "7cb7100889ba7675",
    "type": "ui-template",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "group": "",
    "page": "f3700c18c351beca",
    "ui": "",
    "name": "common-css",
    "order": 0,
    "width": 0,
    "height": 0,
    "head": "",
    "format": " .message-box .nrdb-layout-group--grid {\n    display: flex !important;\n    flex-wrap: wrap !important;\n }\n\n  .message-box .nrdb-layout-group--grid .nrdb-ui-widget {\n    width: 100% !important;\n    margin-bottom: 5px !important;\n }\n\n .message-box .nrdb-layout-group--grid .nrdb-ui-widget.button-box {\n   width: auto !important;\n    margin-left:  10px !important;\n }\n\n .message-box .button-box button {\n   max-width: 200px !important;\n}\n\n.message-box .chat-window {\n   height: 500px !important;\n}\n\n\n .map-box  .nrdb-ui-widget.nrdb-ui-template.status-panel {\n   max-height: 400px !important;\n }\n\n.nrdb-ui-group.in1 {\n   width: 100% !important;\n   top: 800px !important;\n}\n\n.map-box .v-card.bg-group-background {\n   height: 800px !important;\n\n}",
    "storeOutMessages": true,
    "passthru": true,
    "resendOnRefresh": true,
    "templateScope": "page:style",
    "className": "",
    "x": 650,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "5538c36c2ef9e75e",
    "type": "switch",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 970,
    "y": 580,
    "wires": [
      [
        "0f889c1d5c1b3de8"
      ]
    ]
  },
  {
    "id": "18d28b01e018585f",
    "type": "subflow:15e3d881bcd13372",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "",
    "env": [
      {
        "name": "mqtt-broker",
        "value": "ff55020100010001",
        "type": "conf-type"
      }
    ],
    "x": 1080,
    "y": 660,
    "wires": []
  },
  {
    "id": "0f889c1d5c1b3de8",
    "type": "function",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "Warn message",
    "func": "msg.payload=\"A person has been detected in the surveillance video.\"\nreturn msg;",
    "outputs": 1,
    "timeout": 0,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1180,
    "y": 580,
    "wires": [
      [
        "18d28b01e018585f"
      ]
    ]
  },
  {
    "id": "6fdf3f5248a1c18e",
    "type": "inject",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 270,
    "y": 220,
    "wires": [
      [
        "34620f9085de7037"
      ]
    ]
  },
  {
    "id": "34620f9085de7037",
    "type": "usbcamera",
    "z": "83ddd822c5c4b267",
    "g": "3ef9216a78268b39",
    "filemode": "1",
    "filename": "image01.jpg",
    "filedefpath": "1",
    "filepath": "",
    "fileformat": "jpeg",
    "resolution": "1",
    "name": "",
    "x": 450,
    "y": 220,
    "wires": [
      []
    ]
  }
]
